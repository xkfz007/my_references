<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FFmpeg: ffserver.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FFmpeg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ffserver.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ffserver_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) 2000, 2001, 2002 Fabrice Bellard</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * @file</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * multiple format streaming server based on the FFmpeg libraries</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;config.h&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#if !HAVE_CLOSESOCKET</span></div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">   28</a></span>&#160;<span class="preprocessor">#define closesocket close</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avformat_8h.html">libavformat/avformat.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/* FIXME: those are internal headers, ffserver _really_ shouldn&#39;t use them */</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rtpproto_8h.html">libavformat/rtpproto.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rtsp_8h.html">libavformat/rtsp.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avio__internal_8h.html">libavformat/avio_internal.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libavformat_2internal_8h.html">libavformat/internal.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avstring_8h.html">libavutil/avstring.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lfg_8h.html">libavutil/lfg.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dict_8h.html">libavutil/dict.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="intreadwrite_8h.html">libavutil/intreadwrite.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mathematics_8h.html">libavutil/mathematics.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="random__seed_8h.html">libavutil/random_seed.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rational_8h.html">libavutil/rational.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="parseutils_8h.html">libavutil/parseutils.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opt_8h.html">libavutil/opt.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="time_8h.html">libavutil/time.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;stdarg.h&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#if HAVE_UNISTD_H</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#if HAVE_POLL_H</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;poll.h&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="time_8h.html">time.h</a>&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cmdutils_8h.html">cmdutils.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ffserver__config_8h.html">ffserver_config.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="ffserver_8c.html#af9cf34e0db252791157d1860a412381a">   69</a></span>&#160;<span class="preprocessor">#define PATH_LENGTH 1024</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a01a73e823e0892841a4fd2f900b85688">   71</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="ffserver_8c.html#a01a73e823e0892841a4fd2f900b85688">program_name</a>[] = <span class="stringliteral">&quot;ffserver&quot;</span>;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="ffserver_8c.html#adb047c8ef284577de88f3a64fe7638e0">   72</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#adb047c8ef284577de88f3a64fe7638e0">program_birth_year</a> = 2000;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="ffserver_8c.html#affee77914991e4f6048c708556a7edbe">   74</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structOptionDef.html">OptionDef</a> <a class="code" href="ffserver_8c.html#affee77914991e4f6048c708556a7edbe">options</a>[];</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811">   76</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811">HTTPState</a> {</div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">   77</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a>,</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">   78</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>,</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">   79</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a>,</div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">   80</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>,          <span class="comment">/* sending TCP or UDP data */</span></div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">   81</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>,</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">   82</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a>,</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">   83</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a>,          <span class="comment">/* wait for data from the feed */</span></div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">   84</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a>,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">   86</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a>,</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">   87</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">RTSPSTATE_SEND_REPLY</a>,</div><div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">   88</a></span>&#160;    <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">RTSPSTATE_SEND_PACKET</a>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;};</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a217f01fda38731495d208caf539ac9b5">   91</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="ffserver_8c.html#a217f01fda38731495d208caf539ac9b5">http_state</a>[] = {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="stringliteral">&quot;HTTP_WAIT_REQUEST&quot;</span>,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="stringliteral">&quot;HTTP_SEND_HEADER&quot;</span>,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="stringliteral">&quot;SEND_DATA_HEADER&quot;</span>,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="stringliteral">&quot;SEND_DATA&quot;</span>,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="stringliteral">&quot;SEND_DATA_TRAILER&quot;</span>,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="stringliteral">&quot;RECEIVE_DATA&quot;</span>,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="stringliteral">&quot;WAIT_FEED&quot;</span>,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="stringliteral">&quot;READY&quot;</span>,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="stringliteral">&quot;RTSP_WAIT_REQUEST&quot;</span>,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="stringliteral">&quot;RTSP_SEND_REPLY&quot;</span>,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="stringliteral">&quot;RTSP_SEND_PACKET&quot;</span>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ad09de9db7e8c9fd03d27c7cd8b0d9506">  107</a></span>&#160;<span class="preprocessor">#define IOBUFFER_INIT_SIZE 8192</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">/* timeouts are in ms */</span></div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a8a43d39903bea9a3f2ec7fc04ec9e22f">  110</a></span>&#160;<span class="preprocessor">#define HTTP_REQUEST_TIMEOUT (15 * 1000)</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aff9f9c16aa064caf50db45ce1f0935fb">  111</a></span>&#160;<span class="preprocessor">#define RTSP_REQUEST_TIMEOUT (3600 * 24 * 1000)</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a8b06d2e9648501088d9fcc2b3c714690">  113</a></span>&#160;<span class="preprocessor">#define SYNC_TIMEOUT (10 * 1000)</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="structRTSPActionServerSetup.html">  115</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structRTSPActionServerSetup.html">RTSPActionServerSetup</a> {</div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="structRTSPActionServerSetup.html#aab0be1e2a5d7348cb5067d039720889a">  116</a></span>&#160;    uint32_t <a class="code" href="structRTSPActionServerSetup.html#aab0be1e2a5d7348cb5067d039720889a">ipaddr</a>;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="structRTSPActionServerSetup.html#a14885bbb5fed2664d57f9755cb495671">  117</a></span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structRTSPActionServerSetup.html#a14885bbb5fed2664d57f9755cb495671">transport_option</a>[512];</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;} <a class="code" href="structRTSPActionServerSetup.html">RTSPActionServerSetup</a>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="structDataRateData.html">  120</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">  121</a></span>&#160;    int64_t count1, <a class="code" href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">count2</a>;</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">  122</a></span>&#160;    int64_t time1, <a class="code" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">time2</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;} <a class="code" href="structDataRateData.html">DataRateData</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/* context associated with one connection */</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="structHTTPContext.html">  126</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structHTTPContext.html">HTTPContext</a> {</div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">  127</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811">HTTPState</a> <a class="code" href="checkasm_8c.html#a615e09de8eb27f4c0e37e10a1f25f4e3">state</a>;</div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">  128</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>; <span class="comment">/* socket file descriptor */</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">  129</a></span>&#160;    <span class="keyword">struct </span>sockaddr_in from_addr; <span class="comment">/* origin */</span></div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">  130</a></span>&#160;    <span class="keyword">struct </span>pollfd *<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>; <span class="comment">/* used when polling */</span></div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a1cec3e1451132c3f49007d5808abc353">  131</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a1cec3e1451132c3f49007d5808abc353">timeout</a>;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">  132</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, *buffer_end;</div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">  133</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a>;</div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">  134</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a>;</div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a38c9f77110165c3599dba255c7dca51e">  135</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a38c9f77110165c3599dba255c7dca51e">chunked_encoding</a>;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">  136</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a>;               <span class="comment">/* 0 if it needs to be read */</span></div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">  137</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">  138</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">got_key_frame</a>; <span class="comment">/* stream 0 =&gt; 1, stream 1 =&gt; 2, stream 2=&gt; 4 */</span></div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">  139</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">/* feed input */</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">  141</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">/* input format handling */</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">  143</a></span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>;</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">  144</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">start_time</a>;            <span class="comment">/* In milliseconds - this wraps fairly often */</span></div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">  145</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a>;            <span class="comment">/* initial pts value */</span></div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">  146</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">cur_pts</a>;             <span class="comment">/* current pts value from the stream in us */</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="structHTTPContext.html#adbaee6660773715d28aca88435aa3cfd">  147</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#adbaee6660773715d28aca88435aa3cfd">cur_frame_duration</a>;  <span class="comment">/* duration of the current frame in us */</span></div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">  148</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">cur_frame_bytes</a>;       <span class="comment">/* output frame size, needed to compute</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">                                  the time at which we send each</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                                  packet */</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">  151</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">pts_stream_index</a>;        <span class="comment">/* stream we choose as clock reference */</span></div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a0697dd8d28e7ef182771de82aab0f4ec">  152</a></span>&#160;    int64_t <a class="code" href="structHTTPContext.html#a0697dd8d28e7ef182771de82aab0f4ec">cur_clock</a>;           <span class="comment">/* current clock reference value in us */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">/* output format handling */</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">  154</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structFFServerStream.html">FFServerStream</a> *<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">/* -1 is invalid stream */</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">  156</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[<a class="code" href="ffserver__config_8h.html#ace3cff8e1bc22621b52b908e98344ecd">FFSERVER_MAX_STREAMS</a>]; <span class="comment">/* index of streams in the feed */</span></div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">  157</a></span>&#160;    <span class="keywordtype">int</span> switch_feed_streams[<a class="code" href="ffserver__config_8h.html#ace3cff8e1bc22621b52b908e98344ecd">FFSERVER_MAX_STREAMS</a>]; <span class="comment">/* index of streams in the feed */</span></div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">  158</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">switch_pending</a>;</div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">  159</a></span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>; <span class="comment">/* instance of FFServerStream for one user */</span></div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">  160</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">last_packet_sent</a>; <span class="comment">/* true if last data packet was sent */</span></div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a89912854b28f50bd3989f3a65b7fbe80">  161</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a89912854b28f50bd3989f3a65b7fbe80">suppress_log</a>;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">  162</a></span>&#160;    <a class="code" href="structDataRateData.html">DataRateData</a> <a class="code" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">datarate</a>;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">  163</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">wmp_client_id</a>;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">  164</a></span>&#160;    <span class="keywordtype">char</span> protocol[16];</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">  165</a></span>&#160;    <span class="keywordtype">char</span> method[16];</div><div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">  166</a></span>&#160;    <span class="keywordtype">char</span> url[128];</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a949c5b0457e2473d40df89d10149d059">  167</a></span>&#160;    <span class="keywordtype">char</span> clean_url[128*7];</div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">  168</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">  169</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">  170</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>; <span class="comment">/* if true, the stream is packetized */</span></div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">  171</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a>; <span class="comment">/* current stream for output in state machine */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">/* RTSP state specific */</span></div><div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">  174</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>; <span class="comment">/* XXX: use that in all the code */</span></div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">  175</a></span>&#160;    <a class="code" href="structAVIOContext.html">AVIOContext</a> *<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>;</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">  176</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">seq</a>; <span class="comment">/* RTSP sequence number */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">/* RTP state specific */</span></div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">  179</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02e">RTSPLowerTransport</a> rtp_protocol;</div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">  180</a></span>&#160;    <span class="keywordtype">char</span> session_id[32]; <span class="comment">/* session id */</span></div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">  181</a></span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *rtp_ctx[<a class="code" href="ffserver__config_8h.html#ace3cff8e1bc22621b52b908e98344ecd">FFSERVER_MAX_STREAMS</a>];</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">/* RTP/UDP specific */</span></div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">  184</a></span>&#160;    <a class="code" href="structURLContext.html">URLContext</a> *rtp_handles[<a class="code" href="ffserver__config_8h.html#ace3cff8e1bc22621b52b908e98344ecd">FFSERVER_MAX_STREAMS</a>];</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">/* RTP/TCP specific */</span></div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">  187</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a>;</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">  188</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>, *<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a>, *<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;} <a class="code" href="structHTTPContext.html">HTTPContext</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">  191</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aae68dc67f55217c97f8adcbfa6af4f0b">  193</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structFFServerConfig.html">FFServerConfig</a> <a class="code" href="ffserver_8c.html#aae68dc67f55217c97f8adcbfa6af4f0b">config</a> = {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    .<a class="code" href="structFFServerConfig.html#a981210a0cd86d965b5f67ecf9c8a7fb1">nb_max_http_connections</a> = 2000,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    .nb_max_connections = 5,</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    .max_bandwidth = 1000,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    .use_defaults = 1,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;};</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">new_connection</a>(<span class="keywordtype">int</span> server_fd, <span class="keywordtype">int</span> is_rtsp);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">/* HTTP handling */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a9ec5b67aac81069b275ba1dc603c2f11">handle_connection</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab2aa1638f0a0799f8a4a1890a264bd44">print_stream_params</a>(<a class="code" href="structAVIOContext.html">AVIOContext</a> *<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <a class="code" href="structFFServerStream.html">FFServerStream</a> *<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#abfee149d261eace9ff0d19f72bff6d3c">compute_status</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *info);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a544a9b399c7d51e7be4c5eb6617d133b">http_parse_request</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a1b57987e51dcc22329e90bb2750d07e9">http_send_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a40262be785bc90444c79e1145cc6f5c9">http_start_receive_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a570f1c612dfbaf3f3deb08f746fdc86b">http_receive_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/* RTSP handling */</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a0c6e9b96e64d7424a4c1ec2b78c1294f">rtsp_parse_request</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab75d5af2efd73e7eee5692f8ce05ee70">rtsp_cmd_describe</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a76b437eb4da461b2522b89d18a95fea6">rtsp_cmd_options</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#adf12d52e6e8b868b43c702c20c9616d3">rtsp_cmd_setup</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                           <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#afb075e5c5d72162a0be32aaab4383b74">rtsp_cmd_play</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                          <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a">rtsp_cmd_interrupt</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                               <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h, <span class="keywordtype">int</span> pause_only);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/* SDP handling */</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4">prepare_sdp_description</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> **pbuffer,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                   <span class="keyword">struct</span> in_addr my_ip);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/* RTP handling */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keyword">static</span> <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b">rtp_new_connection</a>(<span class="keyword">struct</span> sockaddr_in *<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                       <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                       <span class="keyword">enum</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02e">RTSPLowerTransport</a> <a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0">rtp_new_av_stream</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                             <span class="keywordtype">int</span> stream_index, <span class="keyword">struct</span> sockaddr_in *dest_addr,</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                             <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">/* utils */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="ffserver_8c.html#a7516b6423158baece9632d7274f381fa">htmlencode</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a>, <span class="keywordtype">char</span> **dest);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a> (<span class="keywordtype">char</span> *<a class="code" href="seek_8c.html#a5819dbc2d305e99e930c734a0d28bc3b">buffer</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *entity);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#abdf71fb497c71e9f55df5fd7541bff22">check_codec_match</a>(<a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *ccf, <a class="code" href="structAVStream.html">AVStream</a> *ccs, <span class="keywordtype">int</span> stream);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">  241</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a9b94fed195a0fde46da68d2d0034ecbe">  243</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a9b94fed195a0fde46da68d2d0034ecbe">no_launch</a>;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">  244</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">need_to_start_children</a>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/* maximum number of simultaneous HTTP connections */</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">  247</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">  249</a></span>&#160;<span class="keyword">static</span> uint64_t <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">/* Making this global saves on passing it around everywhere */</span></div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">  252</a></span>&#160;<span class="keyword">static</span> int64_t <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a97de50e0209c967af29fbc038a788bc1">  254</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structAVLFG.html">AVLFG</a> <a class="code" href="ffserver_8c.html#a97de50e0209c967af29fbc038a788bc1">random_state</a>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">  256</a></span>&#160;<span class="keyword">static</span> FILE *<a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">  258</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(<a class="code" href="structAVStream.html">AVStream</a> *st, <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *lst)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="group__lavc__core.html#gaf869d0829ed607cec3a4a02a1c7026b3">avcodec_free_context</a>(&amp;st-&gt;codec);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="group__lavc__core.html#ga950c8da55b8112077e640b6a0cb8cf36">avcodec_parameters_free</a>(&amp;st-&gt;<a class="code" href="structAVStream.html#a12826d21779289356722971d362c583c">codecpar</a>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="preprocessor">#define COPY(a) st-&gt;a = lst-&gt;a;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(<span class="keywordtype">id</span>)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(codec)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(codecpar)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(time_base)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(pts_wrap_bits)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(sample_aspect_ratio)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a>(recommended_encoder_configuration)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">  273</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a> (<span class="keywordtype">char</span> *<a class="code" href="seek_8c.html#a5819dbc2d305e99e930c734a0d28bc3b">buffer</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *entity) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (!buffer || !entity)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">while</span> (*entity)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        *buffer++ = *entity++;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"> * Substitutes known conflicting chars on a text string with</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"> * their corresponding HTML entities.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> * Returns the number of bytes in the &#39;encoded&#39; representation</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"> * not including the terminating NUL.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7516b6423158baece9632d7274f381fa">  287</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="ffserver_8c.html#a7516b6423158baece9632d7274f381fa">htmlencode</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a>, <span class="keywordtype">char</span> **dest) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *amp = <span class="stringliteral">&quot;&amp;amp;&quot;</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *lt  = <span class="stringliteral">&quot;&amp;lt;&quot;</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *gt  = <span class="stringliteral">&quot;&amp;gt;&quot;</span>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#a8fc0b8ec0a1ff0e9ffb827a29083d895">start</a>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="tests_2des_8c.html#ae9a986282b2908caa6e018751ead8ade">tmp</a>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">size_t</span> final_size = 0;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (!src)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    start = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/* Compute needed dest size */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">while</span> (*src != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">switch</span>(*src) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordflow">case</span> 38: <span class="comment">/* &amp; */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                final_size += 5;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">case</span> 60: <span class="comment">/* &lt; */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">case</span> 62: <span class="comment">/* &gt; */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                final_size += 4;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                final_size++;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        src++;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    src = <a class="code" href="avisynth__c_8h.html#a8fc0b8ec0a1ff0e9ffb827a29083d895">start</a>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    *dest = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(final_size + 1);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (!*dest)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">/* Build dest */</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    tmp = *dest;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">while</span> (*src != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">switch</span>(*src) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">case</span> 38: <span class="comment">/* &amp; */</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <a class="code" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a> (tmp, amp);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                tmp += 5;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">case</span> 60: <span class="comment">/* &lt; */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <a class="code" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a> (tmp, lt);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                tmp += 4;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="keywordflow">case</span> 62: <span class="comment">/* &gt; */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <a class="code" href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a> (tmp, gt);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                tmp += 4;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                *tmp = *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                tmp += 1;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        src++;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    *tmp = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">return</span> final_size;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">  348</a></span>&#160;<span class="keyword">static</span> int64_t <a class="code" href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">ffm_read_write_index</a>(<span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;{</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[8];</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (lseek(fd, 8, SEEK_SET) &lt; 0)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EIO);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (read(fd, buf, 8) != 8)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EIO);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="avr32_2intreadwrite_8h.html#ad3c990d78933aafd8096a21f01c19051">AV_RB64</a>(buf);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a07e9012a2339f51b3d2337cd8d99afc8">  359</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a07e9012a2339f51b3d2337cd8d99afc8">ffm_write_write_index</a>(<span class="keywordtype">int</span> <a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, int64_t pos)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;{</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[8];</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;8;i++)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        buf[i] = (pos &gt;&gt; (56 - i * 8)) &amp; 0xff;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (lseek(fd, 8, SEEK_SET) &lt; 0)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">goto</span> bail_eio;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span> (write(fd, buf, 8) != 8)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">goto</span> bail_eio;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> 8;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;bail_eio:</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EIO);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a761ae4333dbc5c2431a984cfc6b35b64">  377</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a761ae4333dbc5c2431a984cfc6b35b64">ffm_set_write_index</a>(<a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>, int64_t pos,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                int64_t file_size)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="group__opt__set__funcs.html#ga3adf7185c21cc080890a5ec02c2e56b2">av_opt_set_int</a>(s, <span class="stringliteral">&quot;server_attached&quot;</span>, 1, <a class="code" href="group__avoptions.html#ga25801ba4fc9b5313eb33ec84e082dd72">AV_OPT_SEARCH_CHILDREN</a>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="group__opt__set__funcs.html#ga3adf7185c21cc080890a5ec02c2e56b2">av_opt_set_int</a>(s, <span class="stringliteral">&quot;ffm_write_index&quot;</span>, pos, <a class="code" href="group__avoptions.html#ga25801ba4fc9b5313eb33ec84e082dd72">AV_OPT_SEARCH_CHILDREN</a>);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="group__opt__set__funcs.html#ga3adf7185c21cc080890a5ec02c2e56b2">av_opt_set_int</a>(s, <span class="stringliteral">&quot;ffm_file_size&quot;</span>, file_size, <a class="code" href="group__avoptions.html#ga25801ba4fc9b5313eb33ec84e082dd72">AV_OPT_SEARCH_CHILDREN</a>);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="ffserver_8c.html#af301f17ab4a386346807e0a0f8324bc2">  385</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="ffserver_8c.html#af301f17ab4a386346807e0a0f8324bc2">ctime1</a>(<span class="keywordtype">char</span> *buf2, <span class="keywordtype">size_t</span> buf_size)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    time_t ti;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    ti = time(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    p = ctime(&amp;ti);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (!p || !*p) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        *buf2 = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">return</span> buf2;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(buf2, p, buf_size);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    p = buf2 + strlen(buf2) - 1;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">return</span> buf2;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a5df0188dbb90aa694f85e5440113559a">  403</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a5df0188dbb90aa694f85e5440113559a">http_vlog</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#a868274bcce53dba81808c75d008593b4">fmt</a>, va_list vargs)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;{</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> print_prefix = 1;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[32];</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a>)</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span> (print_prefix) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <a class="code" href="ffserver_8c.html#af301f17ab4a386346807e0a0f8324bc2">ctime1</a>(buf, <span class="keyword">sizeof</span>(buf));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        fprintf(<a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a>, <span class="stringliteral">&quot;%s &quot;</span>, buf);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    print_prefix = strstr(fmt, <span class="stringliteral">&quot;\n&quot;</span>) != <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    vfprintf(<a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a>, fmt, vargs);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    fflush(<a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#ifdef __GNUC__</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;__attribute__ ((<a class="code" href="tests_2movenc_8c.html#a6bd2bb5fcc7628a640958994a22f997c">format</a> (printf, 1, 2)))</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00423"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">  423</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#a868274bcce53dba81808c75d008593b4">fmt</a>, ...)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;{</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    va_list vargs;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    va_start(vargs, fmt);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="ffserver_8c.html#a5df0188dbb90aa694f85e5440113559a">http_vlog</a>(fmt, vargs);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    va_end(vargs);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="ffserver_8c.html#abe8f2ce62bfb5e7a38d71406625c1dd0">  431</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#abe8f2ce62bfb5e7a38d71406625c1dd0">http_av_log</a>(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">int</span> <a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#a868274bcce53dba81808c75d008593b4">fmt</a>, va_list vargs)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;{</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> print_prefix = 1;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="structAVClass.html">AVClass</a> *avc = ptr ? *(<a class="code" href="structAVClass.html">AVClass</a>**)ptr : <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (level &gt; <a class="code" href="group__lavu__log.html#gae8ada5cc5722548d8698650b05207904">av_log_get_level</a>())</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (print_prefix &amp;&amp; avc)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;[%s @ %p]&quot;</span>, avc-&gt;<a class="code" href="structAVClass.html#ad763b2e6a0846234a165e74574a550bd">item_name</a>(ptr), ptr);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    print_prefix = strstr(fmt, <span class="stringliteral">&quot;\n&quot;</span>) != <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="ffserver_8c.html#a5df0188dbb90aa694f85e5440113559a">http_vlog</a>(fmt, vargs);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a523a367664093b066749a911db8a615e">  443</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a523a367664093b066749a911db8a615e">log_connection</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;{</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a89912854b28f50bd3989f3a65b7fbe80">suppress_log</a>)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%s - - [%s] \&quot;%s %s\&quot; %d %&quot;</span>PRId64<span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;             inet_ntoa(c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>.sin_addr), c-&gt;<a class="code" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">method</a>, c-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;             c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, (c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> ? c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> : 200), c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">  453</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">update_datarate</a>(<a class="code" href="structDataRateData.html">DataRateData</a> *drd, int64_t <a class="code" href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a>)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (!drd-&gt;<a class="code" href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">time1</a> &amp;&amp; !drd-&gt;<a class="code" href="structDataRateData.html#a3ce9871bbc95ef8f0a988253cde02843">count1</a>) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">time1</a> = drd-&gt;<a class="code" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">time2</a> = <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#a3ce9871bbc95ef8f0a988253cde02843">count1</a> = drd-&gt;<a class="code" href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">count2</a> = <a class="code" href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> - drd-&gt;<a class="code" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">time2</a> &gt; 5000) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">time1</a> = drd-&gt;<a class="code" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">time2</a>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#a3ce9871bbc95ef8f0a988253cde02843">count1</a> = drd-&gt;<a class="code" href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">count2</a>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">time2</a> = <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        drd-&gt;<a class="code" href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">count2</a> = <a class="code" href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/* In bytes per second */</span></div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a716ffa43b588f6944a24f595d0bdc406">  467</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a716ffa43b588f6944a24f595d0bdc406">compute_datarate</a>(<a class="code" href="structDataRateData.html">DataRateData</a> *drd, int64_t <a class="code" href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a>)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> == drd-&gt;<a class="code" href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">time1</a>)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> ((count - drd-&gt;<a class="code" href="structDataRateData.html#a3ce9871bbc95ef8f0a988253cde02843">count1</a>) * 1000) / (<a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> - drd-&gt;<a class="code" href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">time1</a>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a3f68f47e66dc1934aff0bbdaab8ce5c1">  476</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a3f68f47e66dc1934aff0bbdaab8ce5c1">start_children</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *feed)</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;{</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordtype">char</span> *pathname;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">char</span> *slash;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">size_t</span> cmd_length;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a9b94fed195a0fde46da68d2d0034ecbe">no_launch</a>)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    cmd_length = strlen(<a class="code" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">   /**</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">    * FIXME: WIP Safeguard. Remove after clearing all harcoded</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">    * &#39;1024&#39; path lengths</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (cmd_length &gt; <a class="code" href="ffserver_8c.html#af9cf34e0db252791157d1860a412381a">PATH_LENGTH</a> - 1) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not start children. Command line: &#39;%s&#39; exceeds &quot;</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    <span class="stringliteral">&quot;path length limit (%d)\n&quot;</span>, <a class="code" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a>, <a class="code" href="ffserver_8c.html#af9cf34e0db252791157d1860a412381a">PATH_LENGTH</a>);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    pathname = <a class="code" href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a> (<a class="code" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a>);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (!pathname) {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not allocate memory for children cmd line\n&quot;</span>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="comment">/* replace &quot;ffserver&quot; with &quot;ffmpeg&quot; in the path of current</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">    * program. Ignore user provided path */</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    slash = strrchr(pathname, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (!slash)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        slash = pathname;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        slash++;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    strcpy(slash, <span class="stringliteral">&quot;ffmpeg&quot;</span>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">for</span> (; feed; feed = feed-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">if</span> (!feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a> || feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a>)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        feed-&gt;<a class="code" href="structFFServerStream.html#a72fea57e6b6d4dd2aac2a815ada63bd2">pid_start</a> = time(0);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a> = fork();</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a> &lt; 0) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Unable to create children: %s\n&quot;</span>, strerror(errno));</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a> (pathname);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            exit(EXIT_FAILURE);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a>)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="comment">/* In child */</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Launch command line: &quot;</span>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%s &quot;</span>, pathname);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">for</span> (i = 1; feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a>[i] &amp;&amp; feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a>[i][0]; i++)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%s &quot;</span>, feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a>[i]);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">for</span> (i = 3; i &lt; 256; i++)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            close(i);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span> (!config.<a class="code" href="structFFServerConfig.html#a82fc4d3aca083cbfc5d972ff8c52f892">debug</a>) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">if</span> (!freopen(<span class="stringliteral">&quot;/dev/null&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>, stdin))</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;failed to redirect STDIN to /dev/null\n;&quot;</span>);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordflow">if</span> (!freopen(<span class="stringliteral">&quot;/dev/null&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>, stdout))</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;failed to redirect STDOUT to /dev/null\n;&quot;</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="keywordflow">if</span> (!freopen(<span class="stringliteral">&quot;/dev/null&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>, stderr))</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;failed to redirect STDERR to /dev/null\n;&quot;</span>);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        signal(SIGPIPE, SIG_DFL);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        execvp(pathname, feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a> (pathname);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        _exit(1);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a> (pathname);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">/* open a listening socket */</span></div><div class="line"><a name="l00560"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a91950b6611fc92f92cafe221d4d39a23">  560</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a91950b6611fc92f92cafe221d4d39a23">socket_open_listen</a>(<span class="keyword">struct</span> sockaddr_in *my_addr)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;{</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordtype">int</span> server_fd, <a class="code" href="tests_2des_8c.html#ae9a986282b2908caa6e018751ead8ade">tmp</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    server_fd = socket(AF_INET,SOCK_STREAM,0);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (server_fd &lt; 0) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        perror (<span class="stringliteral">&quot;socket&quot;</span>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    tmp = 1;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &amp;tmp, <span class="keyword">sizeof</span>(tmp)))</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;setsockopt SO_REUSEADDR failed\n&quot;</span>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    my_addr-&gt;sin_family = AF_INET;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (bind (server_fd, (<span class="keyword">struct</span> sockaddr *) my_addr, <span class="keyword">sizeof</span> (*my_addr)) &lt; 0) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordtype">char</span> bindmsg[32];</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(bindmsg, <span class="keyword">sizeof</span>(bindmsg), <span class="stringliteral">&quot;bind(port %d)&quot;</span>,</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                 ntohs(my_addr-&gt;sin_port));</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        perror (bindmsg);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structHTTPContext.html#a49b179f529c77c6df7a1bf00347f2fa0">listen</a> (server_fd, 5) &lt; 0) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        perror (<span class="stringliteral">&quot;listen&quot;</span>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a24d04e29f579c954b882070912b75fa8">ff_socket_nonblock</a>(server_fd, 1) &lt; 0)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;ff_socket_nonblock failed\n&quot;</span>);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">return</span> server_fd;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">closesocket</a>(server_fd);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">/* start all multicast streams */</span></div><div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ae4816b6ec3780edf8e6cba537c0fa5ec">  599</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ae4816b6ec3780edf8e6cba537c0fa5ec">start_multicast</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;{</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>[32];</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtp_c;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keyword">struct </span>sockaddr_in dest_addr = {0};</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">int</span> default_port, stream_index;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> random0, random1;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    default_port = 6000;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="structFFServerStream.html#ac5b11b67652163181e8efd7c7a17a298">is_multicast</a>)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        random0 = <a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(&amp;random_state);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        random1 = <a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(&amp;random_state);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="comment">/* open the RTP connection */</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(session_id, <span class="keyword">sizeof</span>(session_id), <span class="stringliteral">&quot;%08x%08x&quot;</span>, random0, random1);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">/* choose a port if none given */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">multicast_port</a> == 0) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            stream-&gt;<a class="code" href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">multicast_port</a> = default_port;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            default_port += 100;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        dest_addr.sin_family = AF_INET;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        dest_addr.sin_addr = stream-&gt;<a class="code" href="structFFServerStream.html#a47a664cde8fc184519b309e41fe6dc84">multicast_ip</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        dest_addr.sin_port = htons(stream-&gt;<a class="code" href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">multicast_port</a>);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        rtp_c = <a class="code" href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b">rtp_new_connection</a>(&amp;dest_addr, stream, session_id,</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                   <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea89dd2ec02679eec3d7de20a8aa33f022">RTSP_LOWER_TRANSPORT_UDP_MULTICAST</a>);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">if</span> (!rtp_c)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(rtp_c, <span class="stringliteral">&quot;&quot;</span>) &lt; 0) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open input stream for stream &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                     stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="comment">/* open each RTP stream */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">for</span>(stream_index = 0; stream_index &lt; stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            stream_index++) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            dest_addr.sin_port = htons(stream-&gt;<a class="code" href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">multicast_port</a> +</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                       2 * stream_index);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0">rtp_new_av_stream</a>(rtp_c, stream_index, &amp;dest_addr, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &gt;= 0)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open output stream &#39;%s/streamid=%d&#39;\n&quot;</span>,</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                     stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, stream_index);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            exit(1);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">/* main loop of the HTTP server */</span></div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a14234b6e4169d7035d9b2fd05597e6ec">  659</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a14234b6e4169d7035d9b2fd05597e6ec">http_server</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;{</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordtype">int</span> server_fd = 0, rtsp_server_fd = 0;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordtype">int</span> ret, delay;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keyword">struct </span>pollfd *poll_table, *poll_entry;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>, *c_next;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    poll_table = <a class="code" href="group__lavu__mem__funcs.html#gae0443f550815c80af42c5ae967351433">av_mallocz_array</a>(config.<a class="code" href="structFFServerConfig.html#a981210a0cd86d965b5f67ecf9c8a7fb1">nb_max_http_connections</a> + 2,</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                  <span class="keyword">sizeof</span>(*poll_table));</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span>(!poll_table) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Impossible to allocate a poll table handling %d &quot;</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                 <span class="stringliteral">&quot;connections.\n&quot;</span>, config.<a class="code" href="structFFServerConfig.html#a981210a0cd86d965b5f67ecf9c8a7fb1">nb_max_http_connections</a>);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">if</span> (config.<a class="code" href="structFFServerConfig.html#a346baa4f155cbd05c492bede2e01919f">http_addr</a>.sin_port) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        server_fd = <a class="code" href="ffserver_8c.html#a91950b6611fc92f92cafe221d4d39a23">socket_open_listen</a>(&amp;config.<a class="code" href="structFFServerConfig.html#a346baa4f155cbd05c492bede2e01919f">http_addr</a>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> (server_fd &lt; 0)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">goto</span> quit;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (config.<a class="code" href="structFFServerConfig.html#ad1fe0423f113886e101ec5f804bb5ef3">rtsp_addr</a>.sin_port) {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        rtsp_server_fd = <a class="code" href="ffserver_8c.html#a91950b6611fc92f92cafe221d4d39a23">socket_open_listen</a>(&amp;config.<a class="code" href="structFFServerConfig.html#ad1fe0423f113886e101ec5f804bb5ef3">rtsp_addr</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span> (rtsp_server_fd &lt; 0) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <a class="code" href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">closesocket</a>(server_fd);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordflow">goto</span> quit;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">if</span> (!rtsp_server_fd &amp;&amp; !server_fd) {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;HTTP and RTSP disabled.\n&quot;</span>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">goto</span> quit;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;FFserver started.\n&quot;</span>);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <a class="code" href="ffserver_8c.html#a3f68f47e66dc1934aff0bbdaab8ce5c1">start_children</a>(config.<a class="code" href="structFFServerConfig.html#aa363e6ef1fb0c3d45e4b05657ed751d6">first_feed</a>);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="ffserver_8c.html#ae4816b6ec3780edf8e6cba537c0fa5ec">start_multicast</a>();</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        poll_entry = poll_table;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span> (server_fd) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            poll_entry-&gt;fd = server_fd;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            poll_entry-&gt;events = POLLIN;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            poll_entry++;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (rtsp_server_fd) {</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            poll_entry-&gt;fd = rtsp_server_fd;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            poll_entry-&gt;events = POLLIN;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            poll_entry++;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="comment">/* wait for events on each HTTP handle */</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        c = <a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        delay = 1000;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">while</span> (c) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            fd = c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a>) {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>:</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">RTSPSTATE_SEND_REPLY</a>:</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">RTSPSTATE_SEND_PACKET</a>:</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = poll_entry;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                poll_entry-&gt;fd = fd;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                poll_entry-&gt;events = POLLOUT;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                poll_entry++;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a>:</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>:</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>:</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                    <span class="comment">/* for TCP, we output as much as we can</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">                     * (may need to put a limit) */</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = poll_entry;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    poll_entry-&gt;fd = fd;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                    poll_entry-&gt;events = POLLOUT;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    poll_entry++;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    <span class="comment">/* when ffserver is doing the timing, we work by</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">                     * looking at which packet needs to be sent every</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">                     * 10 ms (one tick wait XXX: 10 ms assumed) */</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    <span class="keywordflow">if</span> (delay &gt; 10)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        delay = 10;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a>:</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a>:</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a>:</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a>:</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="comment">/* need to catch errors */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = poll_entry;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                poll_entry-&gt;fd = fd;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                poll_entry-&gt;events = POLLIN;<span class="comment">/* Maybe this will work */</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                poll_entry++;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            c = c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="comment">/* wait for an event on one connection. We poll at least every</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">         * second to handle timeouts */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">do</span> {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            ret = poll(poll_table, poll_entry - poll_table, delay);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="keywordflow">if</span> (ret &lt; 0 &amp;&amp; <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR)) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <span class="keywordflow">goto</span> quit;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        } <span class="keywordflow">while</span> (ret &lt; 0);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> = <a class="code" href="time_8c.html#aebf7f9c94187487c31d26fa3da816468">av_gettime</a>() / 1000;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">need_to_start_children</a>) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <a class="code" href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">need_to_start_children</a> = 0;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <a class="code" href="ffserver_8c.html#a3f68f47e66dc1934aff0bbdaab8ce5c1">start_children</a>(config.<a class="code" href="structFFServerConfig.html#aa363e6ef1fb0c3d45e4b05657ed751d6">first_feed</a>);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        }</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="comment">/* now handle the events */</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">for</span>(c = first_http_ctx; <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>; c = c_next) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            c_next = c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a9ec5b67aac81069b275ba1dc603c2f11">handle_connection</a>(c) &lt; 0) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                <a class="code" href="ffserver_8c.html#a523a367664093b066749a911db8a615e">log_connection</a>(c);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                <span class="comment">/* close and free the connection */</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>(c);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        poll_entry = poll_table;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">if</span> (server_fd) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="comment">/* new HTTP connection request ? */</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <span class="keywordflow">if</span> (poll_entry-&gt;revents &amp; POLLIN)</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                <a class="code" href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">new_connection</a>(server_fd, 0);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            poll_entry++;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (rtsp_server_fd) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="comment">/* new RTSP connection request ? */</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">if</span> (poll_entry-&gt;revents &amp; POLLIN)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                <a class="code" href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">new_connection</a>(rtsp_server_fd, 1);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;quit:</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(poll_table);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;}</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">/* start waiting for a new HTTP/RTSP request */</span></div><div class="line"><a name="l00809"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ad3bea3b94289e908d655569f284c1543">  809</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ad3bea3b94289e908d655569f284c1543">start_wait_request</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keywordtype">int</span> is_rtsp)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;{</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> + c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a> - 1; <span class="comment">/* leave room for &#39;\0&#39; */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = is_rtsp ? <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a> : <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a>;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a1cec3e1451132c3f49007d5808abc353">timeout</a> = <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> +</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                 (is_rtsp ? <a class="code" href="ffserver_8c.html#aff9f9c16aa064caf50db45ce1f0935fb">RTSP_REQUEST_TIMEOUT</a> : <a class="code" href="ffserver_8c.html#a8a43d39903bea9a3f2ec7fc04ec9e22f">HTTP_REQUEST_TIMEOUT</a>);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="ffserver_8c.html#abbd688d540cfa9f4915db086ad4786e1">  819</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#abbd688d540cfa9f4915db086ad4786e1">http_send_too_busy_reply</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;{</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="seek_8c.html#a5819dbc2d305e99e930c734a0d28bc3b">buffer</a>[400];</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> = <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buffer, <span class="keyword">sizeof</span>(buffer),</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                       <span class="stringliteral">&quot;HTTP/1.0 503 Server too busy\r\n&quot;</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                       <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                       <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                       <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                       <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Too busy&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\r\n&quot;</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                       <span class="stringliteral">&quot;&lt;p&gt;The server is too busy to serve your request at &quot;</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                       <span class="stringliteral">&quot;this time.&lt;/p&gt;\r\n&quot;</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                       <span class="stringliteral">&quot;&lt;p&gt;The number of current connections is %u, and this &quot;</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                       <span class="stringliteral">&quot;exceeds the limit of %u.&lt;/p&gt;\r\n&quot;</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                       <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                       <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>, config.<a class="code" href="structFFServerConfig.html#ad17ba4b42d4a451f2e08042fb57b1ce4">nb_max_connections</a>);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(len &lt; <span class="keyword">sizeof</span>(buffer));</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">if</span> (send(fd, buffer, len, 0) &lt; len)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;               <span class="stringliteral">&quot;Could not send too-busy reply, send() failed\n&quot;</span>);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">  841</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">new_connection</a>(<span class="keywordtype">int</span> server_fd, <span class="keywordtype">int</span> is_rtsp)</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;{</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keyword">struct </span>sockaddr_in from_addr;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    socklen_t <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *c = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    len = <span class="keyword">sizeof</span>(from_addr);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    fd = accept(server_fd, (<span class="keyword">struct</span> sockaddr *)&amp;from_addr,</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                &amp;len);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;error during accept %s\n&quot;</span>, strerror(errno));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a24d04e29f579c954b882070912b75fa8">ff_socket_nonblock</a>(fd, 1) &lt; 0)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;ff_socket_nonblock failed\n&quot;</span>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a> &gt;= config.<a class="code" href="structFFServerConfig.html#ad17ba4b42d4a451f2e08042fb57b1ce4">nb_max_connections</a>) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <a class="code" href="ffserver_8c.html#abbd688d540cfa9f4915db086ad4786e1">http_send_too_busy_reply</a>(fd);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">/* add a new connection */</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    c = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="structHTTPContext.html">HTTPContext</a>));</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (!c)</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a> = fd;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a> = from_addr;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a> = <a class="code" href="ffserver_8c.html#ad09de9db7e8c9fd03d27c7cd8b0d9506">IOBUFFER_INIT_SIZE</a>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a> = <a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    first_http_ctx = <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>++;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="ffserver_8c.html#ad3bea3b94289e908d655569f284c1543">start_wait_request</a>(c, is_rtsp);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(c);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    }</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">closesocket</a>(fd);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;}</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">  892</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;{</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> **cp, *<a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordtype">int</span> i, <a class="code" href="ffprobe_8c.html#ad5b72470d5d57d39c02421b54a92c065">nb_streams</a>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="structAVStream.html">AVStream</a> *st;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="comment">/* remove connection from list */</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    cp = &amp;<a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">while</span> (*cp) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        c1 = *cp;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span> (c1 == c)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            *cp = c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            cp = &amp;c1-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">/* remove references, if any (XXX: do it faster) */</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">for</span>(c1 = first_http_ctx; <a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>; c1 = c1-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a> == c)</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            c1-&gt;<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="comment">/* remove connection associated resources */</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a> &gt;= 0)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <a class="code" href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">closesocket</a>(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="comment">/* close each frame parser */</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>;i++) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            st = c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i];</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <span class="keywordflow">if</span> (st-&gt;codec-&gt;codec)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <a class="code" href="group__lavc__core.html#gaf4daa92361efb3523ef5afeb0b54077f">avcodec_close</a>(st-&gt;codec);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">/* free RTP output streams if any */</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    nb_streams = 0;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        nb_streams = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="ffprobe_8c.html#ad5b72470d5d57d39c02421b54a92c065">nb_streams</a>;i++) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        ctx = c-&gt;<a class="code" href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">rtp_ctx</a>[i];</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">if</span> (ctx) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <a class="code" href="group__lavf__encoding.html#ga7f14007e7dc8f481f054b21614dfec13">av_write_trailer</a>(ctx);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <a class="code" href="group__lavu__dict.html#ga1bafd682b1fbb90e48a4cc3814b820f7">av_dict_free</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">metadata</a>);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[0]);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;ctx);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <a class="code" href="avio_8c.html#a894b202e9a254d9136a9233a894ba26e">ffurl_close</a>(c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[i]);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    ctx = c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (ctx) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">last_packet_sent</a> &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>) {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="comment">/* prepare header */</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">if</span> (ctx-&gt;<a class="code" href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">oformat</a> &amp;&amp; <a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>) &gt;= 0) {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                <a class="code" href="group__lavf__encoding.html#ga7f14007e7dc8f481f054b21614dfec13">av_write_trailer</a>(ctx);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;ctx-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>; i++)</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i]);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#ac4c0777e54085af2f3f1b27130e2b21b">priv_data</a>);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> &amp;&amp; !c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a> &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a> == <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6">STREAM_TYPE_LIVE</a>)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a> -= c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">bandwidth</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">/* signal that there is no feed if we are the feeder socket */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a> &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">feed_opened</a> = 0;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        close(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(c);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>--;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;}</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a9ec5b67aac81069b275ba1dc603c2f11">  977</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a9ec5b67aac81069b275ba1dc603c2f11">handle_connection</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;{</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, ret;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *ptr;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a>) {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a>:</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a>:</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="comment">/* timeout ? */</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">if</span> ((c-&gt;<a class="code" href="structHTTPContext.html#a1cec3e1451132c3f49007d5808abc353">timeout</a> - <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>) &lt; 0)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP))</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="comment">/* no need to read if no events */</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLIN))</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="comment">/* read the data */</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    read_loop:</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> (!(len = recv(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, 1, 0)))</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR))</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="comment">/* search for end of request. */</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        ptr = c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">if</span> ((ptr &gt;= c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> + 2 &amp;&amp; !memcmp(ptr-2, <span class="stringliteral">&quot;\n\n&quot;</span>, 2)) ||</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            (ptr &gt;= c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> + 4 &amp;&amp; !memcmp(ptr-4, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>, 4))) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment">/* request found : parse it and reply */</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a>)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                ret = <a class="code" href="ffserver_8c.html#a544a9b399c7d51e7be4c5eb6617d133b">http_parse_request</a>(c);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                ret = <a class="code" href="ffserver_8c.html#a0c6e9b96e64d7424a4c1ec2b78c1294f">rtsp_parse_request</a>(c);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="keywordflow">if</span> (ret &lt; 0)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ptr &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <span class="comment">/* request too long: cannot do anything */</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">goto</span> read_loop;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>:</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP))</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="comment">/* no need to write if no events */</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLOUT))</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        len = send(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, 0);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR)) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a0de593e16d5b06909c196ab0e0217940">bytes_served</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="comment">/* if error, exit */</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a>)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="comment">/* all the buffer was sent : synchronize to the incoming</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">             * stream */</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>:</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a>:</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>:</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="comment">/* for packetized output, we consider we can always write (the</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">         * input streams set the speed). It may be better to verify</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">         * that we do not rely too much on the kernel queues */</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>) {</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP))</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            <span class="comment">/* no need to read if no events */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLOUT))</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        }</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a1b57987e51dcc22329e90bb2750d07e9">http_send_data</a>(c) &lt; 0)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <span class="comment">/* close connection if trailer sent */</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>)</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="comment">/* Check if it is a single jpeg frame 123 */</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af772429e4e2d59bd252da47e8783de57">single_frame</a> &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> &gt; c-&gt;<a class="code" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">cur_frame_bytes</a> &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">cur_frame_bytes</a> &gt; 0) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>(c);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a>:</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="comment">/* no need to read if no events */</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP))</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLIN))</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a570f1c612dfbaf3f3deb08f746fdc86b">http_receive_data</a>(c) &lt; 0)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a>:</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">/* no need to read if no events */</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLIN | POLLERR | POLLHUP))</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="comment">/* nothing to do, we&#39;ll be waken up by incoming feed packets */</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">RTSPSTATE_SEND_REPLY</a>:</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP))</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="comment">/* no need to write if no events */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLOUT))</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        len = send(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, 0);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR)) {</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>) {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <span class="comment">/* all the buffer was sent : wait for a new request */</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <a class="code" href="ffserver_8c.html#ad3bea3b94289e908d655569f284c1543">start_wait_request</a>(c, 1);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">RTSPSTATE_SEND_PACKET</a>:</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; (POLLERR | POLLHUP)) {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        }</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="comment">/* no need to write if no events */</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a>-&gt;revents &amp; POLLOUT))</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        len = send(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a>,</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a>, 0);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR)) {</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                <span class="comment">/* error : close connection */</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a>) {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="comment">/* all the buffer was sent : wait for a new request */</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a>;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a>:</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment">/* nothing to do */</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>:</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;}</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"><a class="line" href="ffserver_8c.html#adf7a872163b061adbe0f46216c88496b"> 1158</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#adf7a872163b061adbe0f46216c88496b">extract_rates</a>(<span class="keywordtype">char</span> *<a class="code" href="avresample_8c.html#a93e9c44560169ed9b03a575e07aad136">rates</a>, <span class="keywordtype">int</span> ratelen, <span class="keyword">const</span> <span class="keywordtype">char</span> *request)</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;{</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordflow">for</span> (p = request; *p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span>; ) {</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(p, <span class="stringliteral">&quot;Pragma:&quot;</span>, 7) == 0) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *q = p + 7;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            <span class="keywordflow">while</span> (*q &amp;&amp; *q != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; <a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*q))</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                q++;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(q, <span class="stringliteral">&quot;stream-switch-entry=&quot;</span>, 20) == 0) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                <span class="keywordtype">int</span> stream_no;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                <span class="keywordtype">int</span> rate_no;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                q += 20;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                memset(rates, 0xff, ratelen);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                    <span class="keywordflow">while</span> (*q &amp;&amp; *q != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; *q != <span class="charliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                        q++;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                    <span class="keywordflow">if</span> (sscanf(q, <span class="stringliteral">&quot;:%d:%d&quot;</span>, &amp;stream_no, &amp;rate_no) != 2)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                    stream_no--;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                    <span class="keywordflow">if</span> (stream_no &lt; ratelen &amp;&amp; stream_no &gt;= 0)</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                        rates[stream_no] = rate_no;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                    <span class="keywordflow">while</span> (*q &amp;&amp; *q != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; !<a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*q))</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                        q++;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        p = strchr(p, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">if</span> (!p)</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        p++;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a656a0fa8e963645d63ea987b3c4d6028"> 1205</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a656a0fa8e963645d63ea987b3c4d6028">find_stream_in_feed</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *feed, <a class="code" href="structAVCodecParameters.html">AVCodecParameters</a> *codec,</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                               <span class="keywordtype">int</span> bit_rate)</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;{</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordtype">int</span> best_bitrate = 100000000;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordtype">int</span> best = -1;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; i++) {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <a class="code" href="structAVCodecParameters.html">AVCodecParameters</a> *feed_codec = feed-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="keywordflow">if</span> (feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a9f76f2475ef24ff4c9771dd53072d040">codec_id</a> != codec-&gt;<a class="code" href="structAVCodecParameters.html#a9f76f2475ef24ff4c9771dd53072d040">codec_id</a> ||</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#abfc9b0aa975206f7e77a125e6b78536e">sample_rate</a> != codec-&gt;<a class="code" href="structAVCodecParameters.html#abfc9b0aa975206f7e77a125e6b78536e">sample_rate</a> ||</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a51639f88aef9f4f283f538a0c033fbb8">width</a> != codec-&gt;<a class="code" href="structAVCodecParameters.html#a51639f88aef9f4f283f538a0c033fbb8">width</a> ||</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a1ec57ee84f19cf65d00eaa4d2a2253ce">height</a> != codec-&gt;<a class="code" href="structAVCodecParameters.html#a1ec57ee84f19cf65d00eaa4d2a2253ce">height</a>)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="comment">/* Potential stream */</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="comment">/* We want the fastest stream less than bit_rate, or the slowest</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">         * faster than bit_rate</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">if</span> (feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a> &lt;= bit_rate) {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            <span class="keywordflow">if</span> (best_bitrate &gt; bit_rate ||</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a> &gt; best_bitrate) {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                best_bitrate = feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                best = i;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;            }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keywordflow">if</span> (feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a> &lt; best_bitrate) {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            best_bitrate = feed_codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            best = i;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    }</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">return</span> best;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;}</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0192bce4ac95e6e4688d0f2799d34b82"> 1243</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a0192bce4ac95e6e4688d0f2799d34b82">modify_current_stream</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keywordtype">char</span> *<a class="code" href="avresample_8c.html#a93e9c44560169ed9b03a575e07aad136">rates</a>)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;{</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *req = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordtype">int</span> action_required = 0;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">/* Not much we can do for a feed */</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span> (!req-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; req-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; i++) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        <a class="code" href="structAVCodecParameters.html">AVCodecParameters</a> *codec = req-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">switch</span>(rates[i]) {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = req-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[i];</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = <a class="code" href="ffserver_8c.html#a656a0fa8e963645d63ea987b3c4d6028">find_stream_in_feed</a>(req-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>, codec, codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a> / 2);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                <span class="comment">/* Wants off or slow */</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = <a class="code" href="ffserver_8c.html#a656a0fa8e963645d63ea987b3c4d6028">find_stream_in_feed</a>(req-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>, codec, codec-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a> / 4);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="preprocessor">#ifdef WANTS_OFF</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                <span class="comment">/* This doesn&#39;t work well when it turns off the only stream! */</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = -2;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>[i] = -2;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        }</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] &gt;= 0 &amp;&amp;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] != c-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>[i]) {</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            action_required = 1;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">return</span> action_required;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;}</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a"> 1283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(<span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>, <span class="keywordtype">int</span> buf_size, <span class="keyword">const</span> <span class="keywordtype">char</span> **pp)</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;{</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordtype">char</span> *q;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#define SPACE_CHARS &quot; \t\r\n&quot;</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    p = *pp;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    p += strspn(p, <a class="code" href="ffserver_8c.html#aa4f848c169b0eb413afcdf35a1201af3">SPACE_CHARS</a>);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    q = <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*p) &amp;&amp; *p != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="keywordflow">if</span> ((q - buf) &lt; buf_size - 1)</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            *q++ = *p;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        p++;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span> (buf_size &gt; 0)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        *q = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    *pp = p;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;}</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0d6c59fca9d2b7d2ee11be5596f94075"> 1303</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a>* <a class="code" href="ffserver_8c.html#a0d6c59fca9d2b7d2ee11be5596f94075">parse_dynamic_acl</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream,</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                                               <a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;{</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    FILE* f;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structline.html">line</a>[1024];</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordtype">char</span>  cmd[1024];</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *acl = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordtype">int</span> line_num = 0;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    f = fopen(stream-&gt;<a class="code" href="structFFServerStream.html#ab53c91a45d13b50b16af8519c457bf0c">dynamic_acl</a>, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">if</span> (!f) {</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        perror(stream-&gt;<a class="code" href="structFFServerStream.html#ab53c91a45d13b50b16af8519c457bf0c">dynamic_acl</a>);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    acl = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a>));</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">if</span> (!acl) {</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        fclose(f);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="comment">/* Build ACL */</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), f)) {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        line_num++;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        p = line;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*p))</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            p++;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span> || *p == <span class="charliteral">&#39;#&#39;</span>)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <a class="code" href="ffserver__config_8c.html#a43fc93241b7167a490acaf8873c8e8f2">ffserver_get_arg</a>(cmd, <span class="keyword">sizeof</span>(cmd), &amp;p);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="group__lavu__string.html#ga4c60b7d4ce023a6466bc033e31c5349c">av_strcasecmp</a>(cmd, <span class="stringliteral">&quot;ACL&quot;</span>))</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <a class="code" href="ffserver__config_8c.html#a29467cf0c665b465567563f880d2dc25">ffserver_parse_acl_row</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, acl, p, stream-&gt;<a class="code" href="structFFServerStream.html#ab53c91a45d13b50b16af8519c457bf0c">dynamic_acl</a>,</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                   line_num);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    }</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    fclose(f);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="keywordflow">return</span> acl;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;}</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a672971a0dbaa82d6938a25fbf3109481"> 1344</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a672971a0dbaa82d6938a25fbf3109481">free_acl_list</a>(<a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *in_acl)</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;{</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *pacl, *pacl2;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    pacl = in_acl;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">while</span>(pacl) {</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        pacl2 = pacl;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        pacl = pacl-&gt;<a class="code" href="structFFServerIPAddressACL.html#af5838674c8df1f690b1db328e5556fa0">next</a>;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(pacl2);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;}</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a6bbb8cc55551404552deb7e6d2ca7ad1"> 1356</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a6bbb8cc55551404552deb7e6d2ca7ad1">validate_acl_list</a>(<a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *in_acl, <a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;{</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keyword">enum</span> <a class="code" href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1">FFServerIPAddressAction</a> last_action = <a class="code" href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1aceaadb5d0eb1670f28ee24b81d672ee4">IP_DENY</a>;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *acl;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keyword">struct </span>in_addr *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a> = &amp;c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>.sin_addr;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> src_addr = src-&gt;s_addr;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordflow">for</span> (acl = in_acl; acl; acl = acl-&gt;<a class="code" href="structFFServerIPAddressACL.html#af5838674c8df1f690b1db328e5556fa0">next</a>) {</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordflow">if</span> (src_addr &gt;= acl-&gt;<a class="code" href="structFFServerIPAddressACL.html#a61cf4b39e0ee09fe6350acf374d7df41">first</a>.s_addr &amp;&amp; src_addr &lt;= acl-&gt;last.s_addr)</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            <span class="keywordflow">return</span> (acl-&gt;<a class="code" href="structFFServerIPAddressACL.html#acef0e4a596da963ec6d0267950bc522b">action</a> == <a class="code" href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1af6012797550aa8c1ebdf9fd44518bd2d">IP_ALLOW</a>) ? 1 : 0;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        last_action = acl-&gt;<a class="code" href="structFFServerIPAddressACL.html#acef0e4a596da963ec6d0267950bc522b">action</a>;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    }</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="comment">/* Nothing matched, so return not the last action */</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">return</span> (last_action == <a class="code" href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1aceaadb5d0eb1670f28ee24b81d672ee4">IP_DENY</a>) ? 1 : 0;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;}</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a527c7910002d011eb71174bdc34cdb7e"> 1373</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a527c7910002d011eb71174bdc34cdb7e">validate_acl</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream, <a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;{</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <a class="code" href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a> *acl;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="comment">/* if stream-&gt;acl is null validate_acl_list will return 1 */</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    ret = <a class="code" href="ffserver_8c.html#a6bbb8cc55551404552deb7e6d2ca7ad1">validate_acl_list</a>(stream-&gt;<a class="code" href="structFFServerStream.html#af3418f7b448566b89bd4945c00027a2a">acl</a>, c);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#ab53c91a45d13b50b16af8519c457bf0c">dynamic_acl</a>[0]) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        acl = <a class="code" href="ffserver_8c.html#a0d6c59fca9d2b7d2ee11be5596f94075">parse_dynamic_acl</a>(stream, c);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        ret = <a class="code" href="ffserver_8c.html#a6bbb8cc55551404552deb7e6d2ca7ad1">validate_acl_list</a>(acl, c);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <a class="code" href="ffserver_8c.html#a672971a0dbaa82d6938a25fbf3109481">free_acl_list</a>(acl);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    }</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;}</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"> * compute the real filename of a file by matching it without its</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment"> * extensions to all the stream&#39;s filenames</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab82b7e387408431911358bfd3e068338"> 1394</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab82b7e387408431911358bfd3e068338">compute_real_filename</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> max_size)</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;{</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordtype">char</span> file1[1024];</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordtype">char</span> file2[1024];</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(file1, filename, <span class="keyword">sizeof</span>(file1));</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    p = strrchr(file1, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (p)</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(file2, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, <span class="keyword">sizeof</span>(file2));</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        p = strrchr(file2, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="keywordflow">if</span> (p)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keywordflow">if</span> (!strcmp(file1, file2)) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(filename, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, max_size);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        }</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;}</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1"> 1417</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1">RedirType</a> {</div><div class="line"><a name="l01418"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6"> 1418</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6">REDIR_NONE</a>,</div><div class="line"><a name="l01419"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c"> 1419</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c">REDIR_ASX</a>,</div><div class="line"><a name="l01420"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064"> 1420</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064">REDIR_RAM</a>,</div><div class="line"><a name="l01421"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a"> 1421</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a">REDIR_ASF</a>,</div><div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1"> 1422</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1">REDIR_RTSP</a>,</div><div class="line"><a name="l01423"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757"> 1423</a></span>&#160;    <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757">REDIR_SDP</a>,</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;};</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">/* parse HTTP request and prepare header */</span></div><div class="line"><a name="l01427"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a544a9b399c7d51e7be4c5eb6617d133b"> 1427</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a544a9b399c7d51e7be4c5eb6617d133b">http_parse_request</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;{</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordtype">char</span> *p1;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keyword">enum</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1">RedirType</a> redir_type;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordtype">char</span> cmd[32];</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordtype">char</span> info[1024], filename[1024];</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordtype">char</span> url[1024], *q;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordtype">char</span> protocol[32];</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordtype">char</span> msg[1024];</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordtype">char</span> *encoded_msg = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *mime_type;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordtype">char</span> ratebuf[32];</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *useragent = 0;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    p = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(cmd, <span class="keyword">sizeof</span>(cmd), &amp;p);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">method</a>, cmd, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">method</a>));</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;GET&quot;</span>))</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a> = 0;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;POST&quot;</span>))</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a> = 1;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(url, <span class="keyword">sizeof</span>(url), &amp;p);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>, url, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>));</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(protocol, <span class="keyword">sizeof</span>(protocol), (<span class="keyword">const</span> <span class="keywordtype">char</span> **)&amp;p);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">if</span> (strcmp(protocol, <span class="stringliteral">&quot;HTTP/1.0&quot;</span>) &amp;&amp; strcmp(protocol, <span class="stringliteral">&quot;HTTP/1.1&quot;</span>))</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, protocol, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>));</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">if</span> (config.<a class="code" href="structFFServerConfig.html#a82fc4d3aca083cbfc5d972ff8c52f892">debug</a>)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%s - - New connection: %s %s\n&quot;</span>,</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                 inet_ntoa(c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>.sin_addr), cmd, url);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="comment">/* find the filename and the optional info string in the request */</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    p1 = strchr(url, <span class="charliteral">&#39;?&#39;</span>);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keywordflow">if</span> (p1) {</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(info, p1, <span class="keyword">sizeof</span>(info));</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        *p1 = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        info[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(filename, url + ((*url == <span class="charliteral">&#39;/&#39;</span>) ? 1 : 0), <span class="keyword">sizeof</span>(filename)-1);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordflow">for</span> (p = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>; *p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span>; ) {</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(p, <span class="stringliteral">&quot;User-Agent:&quot;</span>, 11) == 0) {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            useragent = p + 11;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            <span class="keywordflow">if</span> (*useragent &amp;&amp; *useragent != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; <a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*useragent))</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                useragent++;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        }</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        p = strchr(p, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> (!p)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        p++;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6">REDIR_NONE</a>;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a>(filename, <span class="stringliteral">&quot;asx&quot;</span>)) {</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c">REDIR_ASX</a>;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        filename[strlen(filename)-1] = <span class="charliteral">&#39;f&#39;</span>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a>(filename, <span class="stringliteral">&quot;asf&quot;</span>) &amp;&amp;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        (!useragent || <a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(useragent, <span class="stringliteral">&quot;NSPlayer&quot;</span>, 8))) {</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="comment">/* if this isn&#39;t WMP or lookalike, return the redirector file */</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a">REDIR_ASF</a>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a>(filename, <span class="stringliteral">&quot;rpm,ram&quot;</span>)) {</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064">REDIR_RAM</a>;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        strcpy(filename + strlen(filename)-2, <span class="stringliteral">&quot;m&quot;</span>);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a>(filename, <span class="stringliteral">&quot;rtsp&quot;</span>)) {</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1">REDIR_RTSP</a>;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <a class="code" href="ffserver_8c.html#ab82b7e387408431911358bfd3e068338">compute_real_filename</a>(filename, <span class="keyword">sizeof</span>(filename) - 1);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a>(filename, <span class="stringliteral">&quot;sdp&quot;</span>)) {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        redir_type = <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757">REDIR_SDP</a>;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <a class="code" href="ffserver_8c.html#ab82b7e387408431911358bfd3e068338">compute_real_filename</a>(filename, <span class="keyword">sizeof</span>(filename) - 1);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    }</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="comment">/* &quot;redirect&quot; request to index.html */</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">if</span> (!strlen(filename))</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(filename, <span class="stringliteral">&quot;index.html&quot;</span>, <span class="keyword">sizeof</span>(filename) - 1);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">while</span> (stream) {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="keywordflow">if</span> (!strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, filename) &amp;&amp; <a class="code" href="ffserver_8c.html#a527c7910002d011eb71174bdc34cdb7e">validate_acl</a>(stream, c))</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span> (!stream) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;File &#39;%s&#39; not found&quot;</span>, url);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;File &#39;%s&#39; not found\n&quot;</span>, url);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> = stream;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    memcpy(c-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>, stream-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>));</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    memset(c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>, -1, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>));</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a> == <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedaca9fe53fa0bd0aa649c700996e7fda22">STREAM_TYPE_REDIRECT</a>) {</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 301;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        q = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                      <span class="stringliteral">&quot;HTTP/1.0 301 Moved\r\n&quot;</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                      <span class="stringliteral">&quot;Location: %s\r\n&quot;</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                      <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                      <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                      <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                      <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Moved&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\r\n&quot;</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                      <span class="stringliteral">&quot;You should be &lt;a href=\&quot;%s\&quot;&gt;redirected&lt;/a&gt;.\r\n&quot;</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                      <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>,</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                 stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        q += strlen(q);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="comment">/* prepare output buffer */</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = q;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    }</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="comment">/* If this is WMP, get the rate information */</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#adf7a872163b061adbe0f46216c88496b">extract_rates</a>(ratebuf, <span class="keyword">sizeof</span>(ratebuf), c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>)) {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a0192bce4ac95e6e4688d0f2799d34b82">modify_current_stream</a>(c, ratebuf)) {</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(c-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>); i++) {</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] &gt;= 0)</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = -1;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            }</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    }</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a> == 0 &amp;&amp; stream-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a> == <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6">STREAM_TYPE_LIVE</a>)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a> += stream-&gt;<a class="code" href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">bandwidth</a>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="comment">/* If already streaming this feed, do not let another feeder start */</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">feed_opened</a>) {</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;This feed is already being received.&quot;</span>);</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Feed &#39;%s&#39; already being received\n&quot;</span>, stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a> == 0 &amp;&amp; config.<a class="code" href="structFFServerConfig.html#ad98d9708e0015939419e1581bd10367c">max_bandwidth</a> &lt; <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a>) {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 503;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        q = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                      <span class="stringliteral">&quot;HTTP/1.0 503 Server too busy\r\n&quot;</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                      <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                      <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                      <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                      <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Too busy&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\r\n&quot;</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                      <span class="stringliteral">&quot;&lt;p&gt;The server is too busy to serve your request at &quot;</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                      <span class="stringliteral">&quot;this time.&lt;/p&gt;\r\n&quot;</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                      <span class="stringliteral">&quot;&lt;p&gt;The bandwidth being served (including your stream) &quot;</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                      <span class="stringliteral">&quot;is %&quot;</span>PRIu64<span class="stringliteral">&quot;kbit/s, and this exceeds the limit of &quot;</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                      <span class="stringliteral">&quot;%&quot;</span>PRIu64<span class="stringliteral">&quot;kbit/s.&lt;/p&gt;\r\n&quot;</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                      <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>,</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                 <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a>, config.<a class="code" href="structFFServerConfig.html#ad98d9708e0015939419e1581bd10367c">max_bandwidth</a>);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        q += strlen(q);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="comment">/* prepare output buffer */</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = q;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    }</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordflow">if</span> (redir_type != <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6">REDIR_NONE</a>) {</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *hostinfo = 0;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="keywordflow">for</span> (p = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>; *p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span>; ) {</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(p, <span class="stringliteral">&quot;Host:&quot;</span>, 5) == 0) {</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                hostinfo = p + 5;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            p = strchr(p, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            <span class="keywordflow">if</span> (!p)</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            p++;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        }</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">if</span> (hostinfo) {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            <span class="keywordtype">char</span> *eoh;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keywordtype">char</span> hostbuf[260];</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a>(*hostinfo))</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                hostinfo++;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            eoh = strchr(hostinfo, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            <span class="keywordflow">if</span> (eoh) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                <span class="keywordflow">if</span> (eoh[-1] == <span class="charliteral">&#39;\r&#39;</span>)</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                    eoh--;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                <span class="keywordflow">if</span> (eoh - hostinfo &lt; <span class="keyword">sizeof</span>(hostbuf) - 1) {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                    memcpy(hostbuf, hostinfo, eoh - hostinfo);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                    hostbuf[eoh - hostinfo] = 0;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 200;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                    q = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                    <span class="keywordflow">switch</span>(redir_type) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c">REDIR_ASX</a>:</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                                      <span class="stringliteral">&quot;HTTP/1.0 200 ASX Follows\r\n&quot;</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                                      <span class="stringliteral">&quot;Content-type: video/x-ms-asf\r\n&quot;</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                      <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                                      <span class="stringliteral">&quot;&lt;ASX Version=\&quot;3\&quot;&gt;\r\n&quot;</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                                      <span class="comment">//&quot;&lt;!-- Autogenerated by ffserver --&gt;\r\n&quot;</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                                      <span class="stringliteral">&quot;&lt;ENTRY&gt;&lt;REF HREF=\&quot;http://%s/%s%s\&quot;/&gt;&lt;/ENTRY&gt;\r\n&quot;</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                                      <span class="stringliteral">&quot;&lt;/ASX&gt;\r\n&quot;</span>, hostbuf, filename, info);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                        q += strlen(q);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064">REDIR_RAM</a>:</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                                      <span class="stringliteral">&quot;HTTP/1.0 200 RAM Follows\r\n&quot;</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                                      <span class="stringliteral">&quot;Content-type: audio/x-pn-realaudio\r\n&quot;</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                      <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                                      <span class="stringliteral">&quot;# Autogenerated by ffserver\r\n&quot;</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                      <span class="stringliteral">&quot;http://%s/%s%s\r\n&quot;</span>, hostbuf, filename, info);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                        q += strlen(q);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a">REDIR_ASF</a>:</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                                      <span class="stringliteral">&quot;HTTP/1.0 200 ASF Redirect follows\r\n&quot;</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                      <span class="stringliteral">&quot;Content-type: video/x-ms-asf\r\n&quot;</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                                      <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                                      <span class="stringliteral">&quot;[Reference]\r\n&quot;</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                                      <span class="stringliteral">&quot;Ref1=http://%s/%s%s\r\n&quot;</span>, hostbuf, filename, info);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                        q += strlen(q);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1">REDIR_RTSP</a>:</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                        {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                            <span class="keywordtype">char</span> hostname[256], *p;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                            <span class="comment">/* extract only hostname */</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                            <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(hostname, hostbuf, <span class="keyword">sizeof</span>(hostname));</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                            p = strrchr(hostname, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                            <span class="keywordflow">if</span> (p)</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                                *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                          <span class="stringliteral">&quot;HTTP/1.0 200 RTSP Redirect follows\r\n&quot;</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                                          <span class="comment">/* XXX: incorrect MIME type ? */</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                          <span class="stringliteral">&quot;Content-type: application/x-rtsp\r\n&quot;</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                                          <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                                          <span class="stringliteral">&quot;rtsp://%s:%d/%s\r\n&quot;</span>, hostname, ntohs(config.<a class="code" href="structFFServerConfig.html#ad1fe0423f113886e101ec5f804bb5ef3">rtsp_addr</a>.sin_port), filename);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                            q += strlen(q);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                        }</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757">REDIR_SDP</a>:</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                        {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                            <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *sdp_data;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                            <span class="keywordtype">int</span> sdp_data_size;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                            socklen_t <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                            <span class="keyword">struct </span>sockaddr_in my_addr;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                                          <span class="stringliteral">&quot;HTTP/1.0 200 OK\r\n&quot;</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                                          <span class="stringliteral">&quot;Content-type: application/sdp\r\n&quot;</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                                          <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                            q += strlen(q);</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                            len = <span class="keyword">sizeof</span>(my_addr);</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                            <span class="comment">/* XXX: Should probably fail? */</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                            <span class="keywordflow">if</span> (getsockname(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, (<span class="keyword">struct</span> sockaddr *)&amp;my_addr, &amp;len))</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;getsockname() failed\n&quot;</span>);</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                            <span class="comment">/* XXX: should use a dynamic buffer */</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                            sdp_data_size = <a class="code" href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4">prepare_sdp_description</a>(stream,</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                                                                    &amp;sdp_data,</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                                                                    my_addr.sin_addr);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                            <span class="keywordflow">if</span> (sdp_data_size &gt; 0) {</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                                memcpy(q, sdp_data, sdp_data_size);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                                q += sdp_data_size;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                                *q = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                                <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;sdp_data);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                            }</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                        }</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                        abort();</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                    }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                    <span class="comment">/* prepare output buffer */</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = q;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                }</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            }</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;ASX/RAM file not handled&quot;</span>);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    }</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    stream-&gt;<a class="code" href="structFFServerStream.html#aa049e9b3a7bf9a67855234e2adc5b558">conns_served</a>++;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="comment">/* XXX: add there authenticate and IP match */</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">post</a>) {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="comment">/* if post, it means a feed is being sent */</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="structFFServerStream.html#a4bfb8bcea84925fa69c1ce4ee61a7b15">is_feed</a>) {</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            <span class="comment">/* However it might be a status report from WMP! Let us log the</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">             * data as it might come handy one day. */</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *logline = 0;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            <span class="keywordtype">int</span> client_id = 0;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            <span class="keywordflow">for</span> (p = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>; *p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span>; ) {</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(p, <span class="stringliteral">&quot;Pragma: log-line=&quot;</span>, 17) == 0) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                    logline = p;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a>(p, <span class="stringliteral">&quot;Pragma: client-id=&quot;</span>, 18) == 0)</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                    client_id = strtol(p + 18, 0, 10);</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                p = strchr(p, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                <span class="keywordflow">if</span> (!p)</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                p++;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            }</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;            <span class="keywordflow">if</span> (logline) {</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                <span class="keywordtype">char</span> *eol = strchr(logline, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                logline += 17;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                <span class="keywordflow">if</span> (eol) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                    <span class="keywordflow">if</span> (eol[-1] == <span class="charliteral">&#39;\r&#39;</span>)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                        eol--;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%.*s\n&quot;</span>, (<span class="keywordtype">int</span>) (eol - logline), logline);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a89912854b28f50bd3989f3a65b7fbe80">suppress_log</a> = 1;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                }</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;\nGot request:\n%s\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <span class="keywordflow">if</span> (client_id &amp;&amp; <a class="code" href="ffserver_8c.html#adf7a872163b061adbe0f46216c88496b">extract_rates</a>(ratebuf, <span class="keyword">sizeof</span>(ratebuf), c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>)) {</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                <a class="code" href="structHTTPContext.html">HTTPContext</a> *wmpc;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                <span class="comment">/* Now we have to find the client_id */</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                <span class="keywordflow">for</span> (wmpc = first_http_ctx; wmpc; wmpc = wmpc-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>) {</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                    <span class="keywordflow">if</span> (wmpc-&gt;<a class="code" href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">wmp_client_id</a> == client_id)</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                }</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                <span class="keywordflow">if</span> (wmpc &amp;&amp; <a class="code" href="ffserver_8c.html#a0192bce4ac95e6e4688d0f2799d34b82">modify_current_stream</a>(wmpc, ratebuf))</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                    wmpc-&gt;<a class="code" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">switch_pending</a> = 1;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            }</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;POST command not handled&quot;</span>);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> = 0;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        }</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a40262be785bc90444c79e1145cc6f5c9">http_start_receive_data</a>(c) &lt; 0) {</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;could not open feed&quot;</span>);</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        }</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 0;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a>;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    }</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">if</span> (strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a> + strlen(stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>) - 4, <span class="stringliteral">&quot;.asf&quot;</span>) == 0)</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;\nGot request:\n%s\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a> == <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedaa890cebbee43177f8b3a00e97c6d5e21">STREAM_TYPE_STATUS</a>)</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="keywordflow">goto</span> send_status;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="comment">/* open input stream */</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(c, info) &lt; 0) {</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;Input stream corresponding to &#39;%s&#39; not found&quot;</span>, url);</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keywordflow">goto</span> send_error;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    }</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">/* prepare HTTP header */</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>[0] = 0;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>, <span class="stringliteral">&quot;HTTP/1.0 200 OK\r\n&quot;</span>);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    mime_type = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ad94e0c8bd362cb9ffbfc44514481fc75">mime_type</a>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">if</span> (!mime_type)</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        mime_type = <span class="stringliteral">&quot;application/x-octet-stream&quot;</span>;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <a class="code" href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>, <span class="stringliteral">&quot;Pragma: no-cache\r\n&quot;</span>);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="comment">/* for asf, we need extra headers */</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">if</span> (!strcmp(c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>,<span class="stringliteral">&quot;asf_stream&quot;</span>)) {</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        <span class="comment">/* Need to allocate a client id */</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">wmp_client_id</a> = <a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(&amp;random_state);</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <a class="code" href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>, <span class="stringliteral">&quot;Server: Cougar 4.1.0.3923\r\nCache-Control: no-cache\r\nPragma: client-id=%d\r\nPragma: features=\&quot;broadcast\&quot;\r\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">wmp_client_id</a>);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    }</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <a class="code" href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>, <span class="stringliteral">&quot;Content-Type: %s\r\n&quot;</span>, mime_type);</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <a class="code" href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    q = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> + strlen(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="comment">/* prepare output buffer */</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 0;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = q;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160; send_error:</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 404;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    q = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ffserver_8c.html#a7516b6423158baece9632d7274f381fa">htmlencode</a>(msg, &amp;encoded_msg)) {</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not encode filename &#39;%s&#39; as HTML\n&quot;</span>, msg);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    }</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>,</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                  <span class="stringliteral">&quot;HTTP/1.0 404 Not Found\r\n&quot;</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                  <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                  <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                  <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                  <span class="stringliteral">&quot;&lt;html&gt;\n&quot;</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                  <span class="stringliteral">&quot;&lt;head&gt;\n&quot;</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                  <span class="stringliteral">&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;\n&quot;</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                  <span class="stringliteral">&quot;&lt;title&gt;404 Not Found&lt;/title&gt;\n&quot;</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                  <span class="stringliteral">&quot;&lt;/head&gt;\n&quot;</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                  <span class="stringliteral">&quot;&lt;body&gt;%s&lt;/body&gt;\n&quot;</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                  <span class="stringliteral">&quot;&lt;/html&gt;\n&quot;</span>, encoded_msg? encoded_msg : <span class="stringliteral">&quot;File not found&quot;</span>);</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    q += strlen(q);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="comment">/* prepare output buffer */</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = q;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;encoded_msg);</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160; send_status:</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <a class="code" href="ffserver_8c.html#abfee149d261eace9ff0d19f72bff6d3c">compute_status</a>(c);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">/* horrible: we use this value to avoid</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">     * going to the send data state */</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">http_error</a> = 200;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a>;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;}</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8"> 1868</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a>(<a class="code" href="structAVIOContext.html">AVIOContext</a> *pb, int64_t <a class="code" href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a>)</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;{</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="checkasm_8c.html#ac07eab03049dcbd3490f72576f5a34d2">suffix</a>[] = <span class="stringliteral">&quot; kMGTP&quot;</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">for</span> (s = suffix; count &gt;= 100000 &amp;&amp; s[1]; count /= 1000, s++);</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;%&quot;</span>PRId64<span class="stringliteral">&quot;%c&quot;</span>, count, *s);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;}</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab2aa1638f0a0799f8a4a1890a264bd44"> 1878</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab2aa1638f0a0799f8a4a1890a264bd44">print_stream_params</a>(<a class="code" href="structAVIOContext.html">AVIOContext</a> *pb, <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream)</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;{</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordtype">int</span> i, stream_no;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *type = <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordtype">char</span> parameters[64];</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *st;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <a class="code" href="structAVCodec.html">AVCodec</a> *codec;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    stream_no = stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Stream&lt;th&gt;&quot;</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                    <span class="stringliteral">&quot;type&lt;th&gt;kbit/s&lt;th&gt;codec&lt;th&gt;&quot;</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                    <span class="stringliteral">&quot;Parameters\n&quot;</span>);</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; stream_no; i++) {</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        st = stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        codec = <a class="code" href="group__lavc__encoding.html#ga9f820c481615c3a02d0407bac0bdbf25">avcodec_find_encoder</a>(st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a9f76f2475ef24ff4c9771dd53072d040">codec_id</a>);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        parameters[0] = 0;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        <span class="keywordflow">switch</span>(st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">codec_type</a>) {</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a>:</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            type = <span class="stringliteral">&quot;audio&quot;</span>;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(parameters, <span class="keyword">sizeof</span>(parameters), <span class="stringliteral">&quot;%d channel(s), %d Hz&quot;</span>,</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                     st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a4d418b807283607a231d2d8cdf559f00">channels</a>, st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#abfc9b0aa975206f7e77a125e6b78536e">sample_rate</a>);</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>:</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;            type = <span class="stringliteral">&quot;video&quot;</span>;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(parameters, <span class="keyword">sizeof</span>(parameters),</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                     <span class="stringliteral">&quot;%dx%d, q=%d-%d, fps=%d&quot;</span>, st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a51639f88aef9f4f283f538a0c033fbb8">width</a>,</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                     st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a1ec57ee84f19cf65d00eaa4d2a2253ce">height</a>, st-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>, st-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#ab015db3b7fcd227193a7c17283914187">qmax</a>,</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                     st-&gt;<a class="code" href="structLayeredAVStream.html#a500d718ddfcb6ad593c6342c0b1f6b4d">time_base</a>.<a class="code" href="structAVRational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> / st-&gt;<a class="code" href="structLayeredAVStream.html#a500d718ddfcb6ad593c6342c0b1f6b4d">time_base</a>.<a class="code" href="structAVRational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;            abort();</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        }</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;%d&lt;td&gt;%s&lt;td&gt;%&quot;</span>PRId64</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                        <span class="stringliteral">&quot;&lt;td&gt;%s&lt;td&gt;%s\n&quot;</span>,</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                    i, type, (int64_t)st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>/1000,</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                    codec ? codec-&gt;<a class="code" href="structAVCodec.html#ad3daa3e729850b573c139a83be8938ca">name</a> : <span class="stringliteral">&quot;&quot;</span>, parameters);</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;     }</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;     <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;}</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aa63c8f34642944df3d8c55b153ba37e4"> 1924</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#aa63c8f34642944df3d8c55b153ba37e4">clean_html</a>(<span class="keywordtype">char</span> *clean, <span class="keywordtype">int</span> clean_len, <span class="keywordtype">char</span> *dirty)</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;{</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordtype">int</span> i, o;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">for</span> (o = i = 0; o+10 &lt; clean_len &amp;&amp; dirty[i];) {</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> = strspn(dirty+i, <span class="stringliteral">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$-_.+!*(),?/ :;%&quot;</span>);</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="keywordflow">if</span> (len) {</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            <span class="keywordflow">if</span> (o + len &gt;= clean_len)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;            memcpy(clean + o, dirty + i, len);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            i += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            o += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            <span class="keywordtype">int</span> c = dirty[i++];</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            <span class="keywordflow">switch</span> (c) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            <span class="keywordflow">case</span>  <span class="charliteral">&#39;&amp;&#39;</span>: <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;amp;&quot;</span>  , clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            <span class="keywordflow">case</span>  <span class="charliteral">&#39;&lt;&#39;</span>: <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;lt;&quot;</span>   , clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keywordflow">case</span>  <span class="charliteral">&#39;&gt;&#39;</span>: <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;gt;&quot;</span>   , clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;\&#39;&#39;</span>: <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;apos;&quot;</span> , clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;\&quot;&#39;</span>: <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;quot;&quot;</span> , clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;            <span class="keywordflow">default</span>:   <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(clean+o, <span class="stringliteral">&quot;&amp;#9785;&quot;</span>, clean_len - o); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;            }</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;            o += strlen(clean+o);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        }</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    }</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    clean[o] = 0;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;}</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"><a class="line" href="ffserver_8c.html#abfee149d261eace9ff0d19f72bff6d3c"> 1952</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#abfee149d261eace9ff0d19f72bff6d3c">compute_status</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;{</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    time_t ti;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordtype">int</span> i, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <a class="code" href="structAVIOContext.html">AVIOContext</a> *pb;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;pb) &lt; 0) {</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        <span class="comment">/* XXX: return an error ? */</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    }</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;HTTP/1.0 200 OK\r\n&quot;</span>);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span>);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Pragma: no-cache\r\n&quot;</span>);</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span>);</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;%s Status&lt;/title&gt;\n&quot;</span>, <a class="code" href="ffserver_8c.html#a01a73e823e0892841a4fd2f900b85688">program_name</a>);</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>[0])</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;link rel=\&quot;shortcut icon\&quot; href=\&quot;%s\&quot;&gt;\n&quot;</span>,</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;/head&gt;\n&lt;body&gt;&quot;</span>);</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;h1&gt;%s Status&lt;/h1&gt;\n&quot;</span>, <a class="code" href="ffserver_8c.html#a01a73e823e0892841a4fd2f900b85688">program_name</a>);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="comment">/* format status */</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;h2&gt;Available Streams&lt;/h2&gt;\n&quot;</span>);</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;table&gt;\n&quot;</span>);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Path&lt;th&gt;Served&lt;br&gt;Conns&lt;th&gt;&lt;br&gt;bytes&lt;th&gt;Format&lt;th&gt;Bit rate&lt;br&gt;kbit/s&lt;th&gt;Video&lt;br&gt;kbit/s&lt;th&gt;&lt;br&gt;Codec&lt;th&gt;Audio&lt;br&gt;kbit/s&lt;th&gt;&lt;br&gt;Codec&lt;th&gt;Feed\n&quot;</span>);</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="keywordflow">while</span> (stream) {</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        <span class="keywordtype">char</span> sfilename[1024];</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="keywordtype">char</span> *eosf;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> == stream) {</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        }</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(sfilename, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, <span class="keyword">sizeof</span>(sfilename) - 10);</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        eosf = sfilename + strlen(sfilename);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="keywordflow">if</span> (eosf - sfilename &gt;= 4) {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            <span class="keywordflow">if</span> (strcmp(eosf - 4, <span class="stringliteral">&quot;.asf&quot;</span>) == 0)</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                strcpy(eosf - 4, <span class="stringliteral">&quot;.asx&quot;</span>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(eosf - 3, <span class="stringliteral">&quot;.rm&quot;</span>) == 0)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                strcpy(eosf - 3, <span class="stringliteral">&quot;.ram&quot;</span>);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a> &amp;&amp; !strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>, <span class="stringliteral">&quot;rtp&quot;</span>)) {</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                <span class="comment">/* generate a sample RTSP director if</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">                 * unicast. Generate an SDP redirector if</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">                 * multicast */</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                eosf = strrchr(sfilename, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                <span class="keywordflow">if</span> (!eosf)</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                    eosf = sfilename + strlen(sfilename);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#ac5b11b67652163181e8efd7c7a17a298">is_multicast</a>)</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                    strcpy(eosf, <span class="stringliteral">&quot;.sdp&quot;</span>);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                    strcpy(eosf, <span class="stringliteral">&quot;.rtsp&quot;</span>);</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            }</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        }</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;/%s\&quot;&gt;%s&lt;/a&gt; &quot;</span>,</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                    sfilename, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt; %d &lt;td&gt; &quot;</span>,</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                    stream-&gt;<a class="code" href="structFFServerStream.html#aa049e9b3a7bf9a67855234e2adc5b558">conns_served</a>);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="comment">// TODO: Investigate if we can make http bitexact so it always produces the same count of bytes</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <span class="keywordflow">if</span> (!config.<a class="code" href="structFFServerConfig.html#a7eb4fd1f323d7e89beaa039a548656d7">bitexact</a>)</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            <a class="code" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a>(pb, stream-&gt;<a class="code" href="structFFServerStream.html#a0de593e16d5b06909c196ab0e0217940">bytes_served</a>);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <span class="keywordflow">switch</span>(stream-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a>) {</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6">STREAM_TYPE_LIVE</a>: {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            <span class="keywordtype">int</span> audio_bit_rate = 0;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            <span class="keywordtype">int</span> video_bit_rate = 0;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ffplay_8c.html#a765905fd1694893cf8523999e58c88c6">audio_codec_name</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ffplay_8c.html#a591a324cad0ca94e4a84dbdf229e5a02">video_codec_name</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *audio_codec_name_extra = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *video_codec_name_extra = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            <span class="keywordflow">for</span>(i=0;i&lt;stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *st = stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                <a class="code" href="structAVCodec.html">AVCodec</a> *codec = <a class="code" href="group__lavc__encoding.html#ga9f820c481615c3a02d0407bac0bdbf25">avcodec_find_encoder</a>(st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a9f76f2475ef24ff4c9771dd53072d040">codec_id</a>);</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                <span class="keywordflow">switch</span>(st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">codec_type</a>) {</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a>:</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                    audio_bit_rate += st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                    <span class="keywordflow">if</span> (codec) {</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                        <span class="keywordflow">if</span> (*audio_codec_name)</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                            audio_codec_name_extra = <span class="stringliteral">&quot;...&quot;</span>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                        audio_codec_name = codec-&gt;<a class="code" href="structAVCodec.html#ad3daa3e729850b573c139a83be8938ca">name</a>;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                    }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>:</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                    video_bit_rate += st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                    <span class="keywordflow">if</span> (codec) {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                        <span class="keywordflow">if</span> (*video_codec_name)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                            video_codec_name_extra = <span class="stringliteral">&quot;...&quot;</span>;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                        video_codec_name = codec-&gt;<a class="code" href="structAVCodec.html#ad3daa3e729850b573c139a83be8938ca">name</a>;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                    }</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ae3df4d77c6908fb626293c2fed215d52">AVMEDIA_TYPE_DATA</a>:</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                    video_bit_rate += st-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                    abort();</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                }</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            }</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt; %s &lt;td&gt; %d &lt;td&gt; %d &lt;td&gt; %s %s &lt;td&gt; &quot;</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                            <span class="stringliteral">&quot;%d &lt;td&gt; %s %s&quot;</span>,</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                        stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>, stream-&gt;<a class="code" href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">bandwidth</a>,</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                        video_bit_rate / 1000, video_codec_name,</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                        video_codec_name_extra, audio_bit_rate / 1000,</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                        audio_codec_name, audio_codec_name_extra);</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt;%s&quot;</span>, stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt;%s&quot;</span>, stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        }</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt; - &lt;td&gt; - &quot;</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                            <span class="stringliteral">&quot;&lt;td&gt; - &lt;td&gt;&lt;td&gt; - &lt;td&gt;\n&quot;</span>);</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        }</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">while</span> (stream) {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> != stream) {</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        }</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;h2&gt;Feed %s&lt;/h2&gt;&quot;</span>, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a>) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Running as pid %&quot;</span>PRId64<span class="stringliteral">&quot;.\n&quot;</span>, (int64_t) stream-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a>);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="preprocessor">#if defined(linux)</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            {</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                FILE *pid_stat;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                <span class="keywordtype">char</span> ps_cmd[64];</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                <span class="comment">/* This is somewhat linux specific I guess */</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ps_cmd, <span class="keyword">sizeof</span>(ps_cmd),</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                         <span class="stringliteral">&quot;ps -o \&quot;%%cpu,cputime\&quot; --no-headers %&quot;</span>PRId64<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                         (int64_t) stream-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a>);</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                 pid_stat = popen(ps_cmd, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                 <span class="keywordflow">if</span> (pid_stat) {</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                     <span class="keywordtype">char</span> cpuperc[10];</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                     <span class="keywordtype">char</span> cpuused[64];</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                     <span class="keywordflow">if</span> (fscanf(pid_stat, <span class="stringliteral">&quot;%9s %63s&quot;</span>, cpuperc, cpuused) == 2) {</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                         <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Currently using %s%% of the cpu. &quot;</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                         <span class="stringliteral">&quot;Total time used %s.\n&quot;</span>,</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                                     cpuperc, cpuused);</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                     }</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                     fclose(pid_stat);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                 }</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            }</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;p&gt;&quot;</span>);</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <a class="code" href="ffserver_8c.html#ab2aa1638f0a0799f8a4a1890a264bd44">print_stream_params</a>(pb, stream);</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    }</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="comment">/* connection status */</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;h2&gt;Connection Status&lt;/h2&gt;\n&quot;</span>);</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Number of connections: %d / %d&lt;br&gt;\n&quot;</span>,</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>, config.<a class="code" href="structFFServerConfig.html#ad17ba4b42d4a451f2e08042fb57b1ce4">nb_max_connections</a>);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;Bandwidth in use: %&quot;</span>PRIu64<span class="stringliteral">&quot;k / %&quot;</span>PRIu64<span class="stringliteral">&quot;k&lt;br&gt;\n&quot;</span>,</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a>, config.<a class="code" href="structFFServerConfig.html#ad98d9708e0015939419e1581bd10367c">max_bandwidth</a>);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;table&gt;\n&quot;</span>);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;#&lt;th&gt;File&lt;th&gt;IP&lt;th&gt;URL&lt;th&gt;Proto&lt;th&gt;State&lt;th&gt;Target &quot;</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                    <span class="stringliteral">&quot;bit/s&lt;th&gt;Actual bit/s&lt;th&gt;Bytes transferred\n&quot;</span>);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    c1 = <a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    i = 0;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">while</span> (c1) {</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        <span class="keywordtype">int</span> bitrate;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        <span class="keywordtype">int</span> j;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        bitrate = 0;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>) {</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt; c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; j++) {</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                <span class="keywordflow">if</span> (!c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                    bitrate += c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[j]-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>[j] &gt;= 0)</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                    bitrate += c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[c1-&gt;<a class="code" href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">feed_streams</a>[j]]-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">bit_rate</a>;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            }</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        }</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        i++;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        p = inet_ntoa(c1-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>.sin_addr);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        <a class="code" href="ffserver_8c.html#aa63c8f34642944df3d8c55b153ba37e4">clean_html</a>(c1-&gt;<a class="code" href="structHTTPContext.html#a949c5b0457e2473d40df89d10149d059">clean_url</a>, <span class="keyword">sizeof</span>(c1-&gt;<a class="code" href="structHTTPContext.html#a949c5b0457e2473d40df89d10149d059">clean_url</a>), c1-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>);</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;b&gt;%d&lt;/b&gt;&lt;td&gt;%s%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&quot;</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                        <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>,</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                    i, c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> ? c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                    c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a> ? <span class="stringliteral">&quot;(input)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                    p,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                    c1-&gt;<a class="code" href="structHTTPContext.html#a949c5b0457e2473d40df89d10149d059">clean_url</a>,</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                    c1-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, <a class="code" href="ffserver_8c.html#a217f01fda38731495d208caf539ac9b5">http_state</a>[c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a>]);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        <a class="code" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a>(pb, bitrate);</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        <a class="code" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a>(pb, <a class="code" href="ffserver_8c.html#a716ffa43b588f6944a24f595d0bdc406">compute_datarate</a>(&amp;c1-&gt;<a class="code" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">datarate</a>, c1-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>) * 8);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <a class="code" href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a>(pb, c1-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        c1 = c1-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    }</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">if</span> (!config.<a class="code" href="structFFServerConfig.html#a7eb4fd1f323d7e89beaa039a548656d7">bitexact</a>) {</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        <span class="comment">/* date */</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        ti = time(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        p = ctime(&amp;ti);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;hr&gt;Generated at %s&quot;</span>, p);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    }</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(pb, <span class="stringliteral">&quot;&lt;/body&gt;\n&lt;/html&gt;\n&quot;</span>);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    len = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(pb, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a> + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;}</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"><a class="line" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9"> 2189</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *info)</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;{</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[128];</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="ffplay_8c.html#a5ad4c812a5f4896f57511a05a3207999">input_filename</a>[1024];</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keywordtype">int</span> buf_size, i, ret;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    int64_t stream_pos;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="comment">/* find file name */</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>) {</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        strcpy(input_filename, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        buf_size = <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <span class="comment">/* compute position (absolute time) */</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="parseutils_8c.html#ad97f06e907c14c253c2bf3e775f51ccb">av_find_info_tag</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;date&quot;</span>, info)) {</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            <span class="keywordflow">if</span> ((ret = <a class="code" href="parseutils_8c.html#a98590feafe82e074f61f38c8faaa4cef">av_parse_time</a>(&amp;stream_pos, buf, 0)) &lt; 0) {</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Invalid date specification &#39;%s&#39; for stream\n&quot;</span>, buf);</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;            }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parseutils_8c.html#ad97f06e907c14c253c2bf3e775f51ccb">av_find_info_tag</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;buffer&quot;</span>, info)) {</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            <span class="keywordtype">int</span> prebuffer = strtol(buf, 0, 10);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            stream_pos = <a class="code" href="time_8c.html#aebf7f9c94187487c31d26fa3da816468">av_gettime</a>() - prebuffer * (int64_t)1000000;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        } <span class="keywordflow">else</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            stream_pos = <a class="code" href="time_8c.html#aebf7f9c94187487c31d26fa3da816468">av_gettime</a>() - c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aef71658a7dac7f836a6bb13383913ebe">prebuffer</a> * (int64_t)1000;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        strcpy(input_filename, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        buf_size = 0;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="comment">/* compute position (relative time) */</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="parseutils_8c.html#ad97f06e907c14c253c2bf3e775f51ccb">av_find_info_tag</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;date&quot;</span>, info)) {</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            <span class="keywordflow">if</span> ((ret = <a class="code" href="parseutils_8c.html#a98590feafe82e074f61f38c8faaa4cef">av_parse_time</a>(&amp;stream_pos, buf, 1)) &lt; 0) {</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Invalid date specification &#39;%s&#39; for stream\n&quot;</span>, buf);</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            }</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        } <span class="keywordflow">else</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            stream_pos = 0;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">if</span> (!input_filename[0]) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;No filename was specified for stream\n&quot;</span>);</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINVAL);</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    }</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="comment">/* open stream */</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    ret = <a class="code" href="group__lavf__decoding.html#ga31d601155e9035d5b0e7efedc894ee49">avformat_open_input</a>(&amp;s, input_filename, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aaf39d9bebde7e936e4dd23428d6581c7">ifmt</a>,</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                              &amp;c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a53df34afe0a8459d3ab3664816d0b8d7">in_opts</a>);</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open input &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                 input_filename, <a class="code" href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a>(ret));</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    }</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="comment">/* set buffer size */</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="keywordflow">if</span> (buf_size &gt; 0) {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        ret = <a class="code" href="avio__internal_8h.html#a64d46fddfb5ef6745e46078b69517506">ffio_set_buf_size</a>(s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, buf_size);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Failed to set buffer size\n&quot;</span>);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    }</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    s-&gt;<a class="code" href="structAVFormatContext.html#a32379cc371463b235d54235d4af06a15">flags</a> |= <a class="code" href="avformat_8h.html#a69e2c8bc119c0245ff6092f9db4d12ae">AVFMT_FLAG_GENPTS</a>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a> = <a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    <span class="keywordflow">if</span> (strcmp(s-&gt;<a class="code" href="structAVFormatContext.html#a78efc5a53c21c8d81197445207ac4374">iformat</a>-&gt;<a class="code" href="structAVInputFormat.html#a850db3eb225e22b64f3304d72134ca0c">name</a>, <span class="stringliteral">&quot;ffm&quot;</span>) &amp;&amp;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        (ret = <a class="code" href="group__lavf__decoding.html#gad42172e27cddafb81096939783b157bb">avformat_find_stream_info</a>(c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) &lt; 0) {</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not find stream info for input &#39;%s&#39;\n&quot;</span>, input_filename);</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;s);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    }</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="comment">/* choose stream as clock source (we favor the video stream if</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">     * present) for packet sending */</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">pts_stream_index</a> = 0;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">pts_stream_index</a> == 0 &amp;&amp;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">codec_type</a> == <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>) {</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">pts_stream_index</a> = i;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        }</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    }</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#a78efc5a53c21c8d81197445207ac4374">iformat</a>-&gt;<a class="code" href="structAVInputFormat.html#a04a3b9ba459666bdb43628c472fa29bf">read_seek</a>)</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <a class="code" href="group__lavf__decoding.html#gaa23f7619d8d4ea0857065d9979c75ac8">av_seek_frame</a>(c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>, -1, stream_pos, 0);</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    <span class="comment">/* set the start time (needed for maxtime and RTP packet timing) */</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">start_time</a> = <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a> = <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;}</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment">/* return the server clock (in us) */</span></div><div class="line"><a name="l02275"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab8f12a8f07b794e584b9ae26f465aa48"> 2275</a></span>&#160;<span class="keyword">static</span> int64_t <a class="code" href="ffserver_8c.html#ab8f12a8f07b794e584b9ae26f465aa48">get_server_clock</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;{</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="comment">/* compute current pts value from system time */</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> - c-&gt;<a class="code" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">start_time</a>) * 1000;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;}</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="comment">/* return the estimated time (in us) at which the current packet must be sent */</span></div><div class="line"><a name="l02282"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0b30b5730bee0712936099a3865688aa"> 2282</a></span>&#160;<span class="keyword">static</span> int64_t <a class="code" href="ffserver_8c.html#a0b30b5730bee0712936099a3865688aa">get_packet_send_clock</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;{</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordtype">int</span> bytes_left, bytes_sent, frame_bytes;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    frame_bytes = c-&gt;<a class="code" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">cur_frame_bytes</a>;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="keywordflow">if</span> (frame_bytes &lt;= 0)</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="keywordflow">return</span> c-&gt;<a class="code" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">cur_pts</a>;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    bytes_left = c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    bytes_sent = frame_bytes - bytes_left;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="keywordflow">return</span> c-&gt;<a class="code" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">cur_pts</a> + (c-&gt;<a class="code" href="structHTTPContext.html#adbaee6660773715d28aca88435aa3cfd">cur_frame_duration</a> * bytes_sent) / frame_bytes;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;}</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div><div class="line"><a name="l02296"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a7331da272261ee3cca96d5a325fc652d"> 2296</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a7331da272261ee3cca96d5a325fc652d">http_prepare_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;{</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="keywordtype">int</span> i, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, ret;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a>) {</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a>:</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        ctx = <a class="code" href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a>();</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <span class="keywordflow">if</span> (!ctx)</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(ENOMEM);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        <a class="code" href="group__lavu__dict.html#ga59a6372b124b306e3a2233723c5cdc78">av_dict_copy</a>(&amp;(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">metadata</a>), c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aea1b9572fd252c90117af69c2ef73878">metadata</a>, 0);</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;            <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a>;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <a class="code" href="structAVStream.html">AVStream</a> *st = <a class="code" href="group__lavf__core.html#gadcb0fd3e507d9b58fe78f61f8ad39827">avformat_new_stream</a>(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <span class="keywordflow">if</span> (!st)</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(ENOMEM);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            <span class="comment">/* if file or feed, then just take streams from FFServerStream</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment">             * struct */</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> ||</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> == c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                src = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                src = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[i]];</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i], src); <span class="comment">//TODO we no longer copy st-&gt;internal, does this matter?</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(!c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i]-&gt;<a class="code" href="structAVStream.html#a61b61b0d009be377ebcfdc30ea053d27">priv_data</a>);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;            <span class="keywordflow">if</span> (src-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga17ae68044f725fd5ba26c54162b96490">AV_CODEC_FLAG_BITEXACT</a>)</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a32379cc371463b235d54235d4af06a15">flags</a> |= <a class="code" href="avformat_8h.html#a2fa1d95841e62af509ba733a11c1b25b">AVFMT_FLAG_BITEXACT</a>;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        }</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="comment">/* set output format parameters */</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">oformat</a> = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a> == c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>);</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">got_key_frame</a> = 0;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        <span class="comment">/* prepare header and save header data in a stream */</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>) &lt; 0) {</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;            <span class="comment">/* XXX: potential leak */</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;        }</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>-&gt;<a class="code" href="structAVIOContext.html#a0e3c41c290b38923880b9cccb669bf78">seekable</a> = 0;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">         * HACK to avoid MPEG-PS muxer to spit many underflow errors</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">         * Default value from FFmpeg</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">         * Try to set it using configuration option</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a58422ed3d461b3440a15cf057ac5f5b7">max_delay</a> = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(0.7*<a class="code" href="group__lavu__time.html#gaa11ed202b70e1f52bac809811a910e2a">AV_TIME_BASE</a>);</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <span class="keywordflow">if</span> ((ret = <a class="code" href="group__lavf__encoding.html#ga18b7b10bb5b94c4842de18166bc677cb">avformat_write_header</a>(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) &lt; 0) {</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error writing output header for stream &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                     c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, <a class="code" href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a>(ret));</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        }</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        <a class="code" href="group__lavu__dict.html#ga1bafd682b1fbb90e48a4cc3814b820f7">av_dict_free</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">metadata</a>);</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;        len = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>;</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a> + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">last_packet_sent</a> = 0;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>:</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        <span class="comment">/* find a new packet */</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        <span class="comment">/* read a packet from the input stream */</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;            <a class="code" href="ffserver_8c.html#a761ae4333dbc5c2431a984cfc6b35b64">ffm_set_write_index</a>(c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>,</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a>,</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                                c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a>);</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6f8a4ad039a1231d8733d884e790615d">max_time</a> &amp;&amp;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6f8a4ad039a1231d8733d884e790615d">max_time</a> + c-&gt;<a class="code" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">start_time</a> - <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a> &lt; 0)</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;            <span class="comment">/* We have timed out */</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;            <a class="code" href="structAVPacket.html">AVPacket</a> <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        redo:</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            ret = <a class="code" href="group__lavf__decoding.html#ga4fdb3084415a82e3810de6ee60e46a61">av_read_frame</a>(c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>, &amp;pkt);</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;            <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>) {</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                    <span class="comment">/* if coming from feed, it means we reached the end of the</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">                     * ffm file, so must wait for more data */</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a>;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                    <span class="keywordflow">return</span> 1; <span class="comment">/* state changed */</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                }</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                <span class="keywordflow">if</span> (ret == <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN)) {</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                    <span class="comment">/* input not ready, come back later */</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                }</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#aafcd72e0dd1230e5d125d8f3bd0cfa89">loop</a>) {</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                    <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>);</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(c, <span class="stringliteral">&quot;&quot;</span>) &lt; 0)</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                        <span class="keywordflow">goto</span> no_loop;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                    <span class="keywordflow">goto</span> redo;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    no_loop:</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                        <span class="comment">/* must send trailer now because EOF or error */</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                }</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                <span class="keywordtype">int</span> source_index = pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                <span class="comment">/* update first pts if needed */</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a> == <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a> &amp;&amp; pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> != <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>) {</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a>, c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>]-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>, <a class="code" href="group__lavu__time.html#gafd07a13a4ddaa6015275cad6022d9ee3">AV_TIME_BASE_Q</a>);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">start_time</a> = <a class="code" href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a>;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                }</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                <span class="comment">/* send it to the appropriate stream */</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>) {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                    <span class="comment">/* if coming from a feed, select the right stream */</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">switch_pending</a>) {</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                        c-&gt;<a class="code" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">switch_pending</a> = 0;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                        <span class="keywordflow">for</span>(i=0;i&lt;c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] == pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>)</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                                <span class="keywordflow">if</span> (pkt.<a class="code" href="structAVPacket.html#a437be96a9da675f12caa228a9c81bd82">flags</a> &amp; <a class="code" href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a>)</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                                    c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] = -1;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">switch_feed_streams</a>[i] &gt;= 0)</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                                c-&gt;<a class="code" href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">switch_pending</a> = 1;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                        }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                    }</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                    <span class="keywordflow">for</span>(i=0;i&lt;c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[i] == pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>) {</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                            <a class="code" href="structAVStream.html">AVStream</a> *st = c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[source_index];</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                            pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a> = i;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                            <span class="keywordflow">if</span> (pkt.<a class="code" href="structAVPacket.html#a437be96a9da675f12caa228a9c81bd82">flags</a> &amp; <a class="code" href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a> &amp;&amp;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                                (st-&gt;<a class="code" href="structAVStream.html#a12826d21779289356722971d362c583c">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">codec_type</a> == <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a> ||</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                                 c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a> == 1))</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                                c-&gt;<a class="code" href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">got_key_frame</a> = 1;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                            <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#adf75ac96109bb80f844282ebd58b0c76">send_on_key</a> || c-&gt;<a class="code" href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">got_key_frame</a>)</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                                <span class="keywordflow">goto</span> send_it;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                        }</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                    }</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                    <a class="code" href="structAVStream.html">AVStream</a> *ist, *ost;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                send_it:</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                    ist = c-&gt;<a class="code" href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">fmt_in</a>-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[source_index];</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                    <span class="comment">/* specific handling for RTP: we use several</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="comment">                     * output streams (one for each RTP connection).</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment">                     * XXX: need more abstract handling */</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>) {</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                        <span class="comment">/* compute send time and duration */</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                        <span class="keywordflow">if</span> (pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> != <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>) {</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                            c-&gt;<a class="code" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">cur_pts</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a>, ist-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>, <a class="code" href="group__lavu__time.html#gafd07a13a4ddaa6015275cad6022d9ee3">AV_TIME_BASE_Q</a>);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                            c-&gt;<a class="code" href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">cur_pts</a> -= c-&gt;<a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a>;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                        }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                        c-&gt;<a class="code" href="structHTTPContext.html#adbaee6660773715d28aca88435aa3cfd">cur_frame_duration</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a622e758be29fd500aed0ffdc069550f7">duration</a>, ist-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>, <a class="code" href="group__lavu__time.html#gafd07a13a4ddaa6015275cad6022d9ee3">AV_TIME_BASE_Q</a>);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                        <span class="comment">/* find RTP context */</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                        c-&gt;<a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a> = pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                        ctx = c-&gt;<a class="code" href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">rtp_ctx</a>[c-&gt;<a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a>];</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                        <span class="keywordflow">if</span>(!ctx) {</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                            <a class="code" href="group__lavc__packet.html#ga63d5a489b419bd5d45cfd09091cbcbc2">av_packet_unref</a>(&amp;pkt);</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                        }</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                        <span class="comment">/* only one stream per RTP connection */</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                        pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a> = 0;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                        ctx = c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                        <span class="comment">/* Fudge here */</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                    }</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>) {</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                        <span class="keywordtype">int</span> max_packet_size;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a> == <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>)</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                            max_packet_size = <a class="code" href="rtsp_8h.html#a53132bb0c530c18c36fc96f3acece4f0">RTSP_TCP_MAX_PACKET_SIZE</a>;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                            max_packet_size = c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[c-&gt;<a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a>]-&gt;<a class="code" href="structURLContext.html#a929b2b6f142d146ff2df0970839d78ae">max_packet_size</a>;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                        ret = <a class="code" href="avio__internal_8h.html#aa743cd8e9a78aae3c1774cc8eba565cc">ffio_open_dyn_packet_buf</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>,</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                                                       max_packet_size);</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                    } <span class="keywordflow">else</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                        ret = <a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>);</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                    <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                        <span class="comment">/* XXX: potential leak */</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                    }</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                    ost = ctx-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[pkt.<a class="code" href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">stream_index</a>];</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                    ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>-&gt;<a class="code" href="structAVIOContext.html#a0e3c41c290b38923880b9cccb669bf78">seekable</a> = 0;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                    <span class="keywordflow">if</span> (pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> != <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>)</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                        pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a>, ist-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>,</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                                               ost-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>);</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                    <span class="keywordflow">if</span> (pkt.<a class="code" href="structAVPacket.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a> != <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>)</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                        pkt.<a class="code" href="structAVPacket.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a>, ist-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>,</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                                               ost-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>);</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                    pkt.<a class="code" href="structAVPacket.html#a622e758be29fd500aed0ffdc069550f7">duration</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(pkt.<a class="code" href="structAVPacket.html#a622e758be29fd500aed0ffdc069550f7">duration</a>, ist-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>,</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                                                ost-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>);</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                    <span class="keywordflow">if</span> ((ret = <a class="code" href="group__lavf__encoding.html#gaa85cc1774f18f306cd20a40fc50d0b36">av_write_frame</a>(ctx, &amp;pkt)) &lt; 0) {</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error writing frame to output for stream &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                                 c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, <a class="code" href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a>(ret));</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                        c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                    }</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                    len = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                    ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">cur_frame_bytes</a> = <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a> + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                    <span class="keywordflow">if</span> (len == 0) {</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                        <a class="code" href="group__lavc__packet.html#ga63d5a489b419bd5d45cfd09091cbcbc2">av_packet_unref</a>(&amp;pkt);</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                        <span class="keywordflow">goto</span> redo;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                    }</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                }</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                <a class="code" href="group__lavc__packet.html#ga63d5a489b419bd5d45cfd09091cbcbc2">av_packet_unref</a>(&amp;pkt);</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            }</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>:</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="comment">/* last packet test ? */</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">last_packet_sent</a> || c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>)</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        ctx = c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <span class="comment">/* prepare header */</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>) &lt; 0) {</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            <span class="comment">/* XXX: potential leak */</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        }</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">pfmt_ctx</a>-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>-&gt;<a class="code" href="structAVIOContext.html#a0e3c41c290b38923880b9cccb669bf78">seekable</a> = 0;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        <a class="code" href="group__lavf__encoding.html#ga7f14007e7dc8f481f054b21614dfec13">av_write_trailer</a>(ctx);</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        len = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a> + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">last_packet_sent</a> = 1;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;}</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="comment">/* should convert the format at the same time */</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="comment">/* send data starting at c-&gt;buffer_ptr to the output connection</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="comment"> * (either UDP or TCP)</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02536"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a1b57987e51dcc22329e90bb2750d07e9"> 2536</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a1b57987e51dcc22329e90bb2750d07e9">http_send_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;{</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, ret;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>) {</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            ret = <a class="code" href="ffserver_8c.html#a7331da272261ee3cca96d5a325fc652d">http_prepare_data</a>(c);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            <span class="keywordflow">if</span> (ret &lt; 0)</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret)</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                <span class="comment">/* state change requested */</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a>) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                <span class="comment">/* RTP data output */</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                len = c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                <span class="keywordflow">if</span> (len &lt; 4) {</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                    <span class="comment">/* fail safe - should never happen */</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                fail1:</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                }</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                len = (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[0] &lt;&lt; 24) |</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                    (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[1] &lt;&lt; 16) |</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                    (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[2] &lt;&lt; 8) |</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                    (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[3]);</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                <span class="keywordflow">if</span> (len &gt; (c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>))</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                    <span class="keywordflow">goto</span> fail1;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                <span class="keywordflow">if</span> ((<a class="code" href="ffserver_8c.html#a0b30b5730bee0712936099a3865688aa">get_packet_send_clock</a>(c) - <a class="code" href="ffserver_8c.html#ab8f12a8f07b794e584b9ae26f465aa48">get_server_clock</a>(c)) &gt; 0) {</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                    <span class="comment">/* nothing to send yet: we can wait */</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                }</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                <a class="code" href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">update_datarate</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">datarate</a>, c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>);</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a0de593e16d5b06909c196ab0e0217940">bytes_served</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a> == <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                    <span class="comment">/* RTP packets are sent inside the RTSP TCP connection */</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                    <a class="code" href="structAVIOContext.html">AVIOContext</a> *pb;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                    <span class="keywordtype">int</span> interleaved_index, <a class="code" href="twinvq__data_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>[4];</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtsp_c;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                    rtsp_c = c-&gt;<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a>;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                    <span class="comment">/* if no RTSP connection left, error */</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                    <span class="keywordflow">if</span> (!rtsp_c)</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                    <span class="comment">/* if already sending something, then wait. */</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                    <span class="keywordflow">if</span> (rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a>)</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;pb) &lt; 0)</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                        <span class="keywordflow">goto</span> fail1;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                    interleaved_index = c-&gt;<a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a> * 2;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                    <span class="comment">/* RTCP packets are sent at odd indexes */</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[1] == 200)</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                        interleaved_index++;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                    <span class="comment">/* write RTSP TCP header */</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                    header[0] = <span class="charliteral">&#39;$&#39;</span>;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                    header[1] = interleaved_index;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                    header[2] = len &gt;&gt; 8;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                    header[3] = <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                    <a class="code" href="avio_8h.html#acc3626afc6aa3964b75d02811457164e">avio_write</a>(pb, header, 4);</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                    <span class="comment">/* write RTP packet data */</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += 4;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                    <a class="code" href="avio_8h.html#acc3626afc6aa3964b75d02811457164e">avio_write</a>(pb, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, len);</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                    size = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(pb, &amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;                    <span class="comment">/* prepare asynchronous TCP sending */</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                    rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                    rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a> + <a class="code" href="twinvq__data_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                    <span class="comment">/* send everything we can NOW */</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                    len = send(rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a>,</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                               rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a> - rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a>, 0);</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                    <span class="keywordflow">if</span> (len &gt; 0)</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                        rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                    <span class="keywordflow">if</span> (rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">packet_buffer_ptr</a> &lt; rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">packet_buffer_end</a>) {</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                        <span class="comment">/* if we could not send all the data, we will</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment">                         * send it later, so a new state is needed to</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">                         * &quot;lock&quot; the RTSP TCP connection */</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                        rtsp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">RTSPSTATE_SEND_PACKET</a>;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                    } <span class="keywordflow">else</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                        <span class="comment">/* all data has been sent */</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">packet_buffer</a>);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                    <span class="comment">/* send RTP packet directly in UDP */</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += 4;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                    <a class="code" href="avio_8c.html#ac1d123f423ddc77939136919c75f44ba">ffurl_write</a>(c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[c-&gt;<a class="code" href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">packet_stream_index</a>],</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                                c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, len);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                    <span class="comment">/* here we continue as we can send several packets</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment">                     * per 10 ms slot */</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                }</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                <span class="comment">/* TCP data output */</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                len = send(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>,</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                           c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, 0);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;                        <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR))</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                        <span class="comment">/* error : close connection */</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                }</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                <a class="code" href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">update_datarate</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">datarate</a>, c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a0de593e16d5b06909c196ab0e0217940">bytes_served</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;            }</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        }</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    } <span class="comment">/* for(;;) */</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;}</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a40262be785bc90444c79e1145cc6f5c9"> 2657</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a40262be785bc90444c79e1145cc6f5c9">http_start_receive_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;{</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    int64_t ret64;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">feed_opened</a>) {</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Stream feed &#39;%s&#39; was not opened\n&quot;</span>,</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                 c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINVAL);</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    }</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="comment">/* Don&#39;t permit writing to this one */</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a38cbc874e9f67c090ce9df4788aa7ea3">readonly</a>) {</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Cannot write to read-only file &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                 c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINVAL);</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    }</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="comment">/* open feed */</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    fd = open(c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, O_RDWR);</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        ret = <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(errno);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open feed file &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                 c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, strerror(errno));</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a> = fd;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af1c8eb978faf3a104d136e643fb59c68">truncate</a>) {</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        <span class="comment">/* truncate feed file */</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <a class="code" href="ffserver_8c.html#a07e9012a2339f51b3d2337cd8d99afc8">ffm_write_write_index</a>(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>, <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Truncating feed file &#39;%s&#39;\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="keywordflow">if</span> (ftruncate(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>, <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>) &lt; 0) {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;            ret = <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(errno);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error truncating feed file &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                     c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, strerror(errno));</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        }</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        ret64 = <a class="code" href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">ffm_read_write_index</a>(fd);</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        <span class="keywordflow">if</span> (ret64 &lt; 0) {</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error reading write index from feed file &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                     c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, strerror(errno));</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            <span class="keywordflow">return</span> ret64;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        }</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> = ret64;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    }</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">ffm_read_write_index</a>(fd),</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                                        <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a> = lseek(fd, 0, SEEK_END);</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    lseek(fd, 0, SEEK_SET);</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="comment">/* init buffer input */</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> + <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">feed_opened</a> = 1;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a38c9f77110165c3599dba255c7dca51e">chunked_encoding</a> = !!<a class="code" href="group__lavu__string.html#ga47e14424edfb96d3f6bf0fca96a76fe5">av_stristr</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, <span class="stringliteral">&quot;Transfer-Encoding: chunked&quot;</span>);</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;}</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;</div><div class="line"><a name="l02719"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a570f1c612dfbaf3f3deb08f746fdc86b"> 2719</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a570f1c612dfbaf3f3deb08f746fdc86b">http_receive_data</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;{</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, loop_run = 0;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">while</span> (c-&gt;<a class="code" href="structHTTPContext.html#a38c9f77110165c3599dba255c7dca51e">chunked_encoding</a> &amp;&amp; !c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a> &amp;&amp;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;           c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> &gt; c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>) {</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="comment">/* read chunk header, if present */</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        len = recv(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>, 1, 0);</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR))</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                <span class="comment">/* error : close connection */</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 0) {</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;            <span class="comment">/* end of connection : close it */</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> - c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> &gt;= 2 &amp;&amp;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                   !memcmp(c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> - 1, <span class="stringliteral">&quot;\r\n&quot;</span>, 2)) {</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a> = strtol(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, 0, 16);</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a> &lt;= 0) { <span class="comment">// end of stream or invalid chunk size</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a> = 0;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;            }</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (++loop_run &gt; 10)</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;            <span class="comment">/* no chunk header, abort */</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>++;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    }</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> &gt; c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>) {</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        len = recv(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>,</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                   <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a>, c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>), 0);</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;        <span class="keywordflow">if</span> (len &lt; 0) {</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EAGAIN) &amp;&amp;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                <a class="code" href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a>() != <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(EINTR))</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                <span class="comment">/* error : close connection */</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 0)</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;            <span class="comment">/* end of connection : close it */</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(len &lt;= c-&gt;chunk_size);</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">chunk_size</a> -= <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> += <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;            <a class="code" href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">update_datarate</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">datarate</a>, c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a>);</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        }</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    }</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> - c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> &gt;= 2 &amp;&amp; c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> &gt; <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>) {</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>[0] != <span class="charliteral">&#39;f&#39;</span> ||</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;            c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>[1] != <span class="charliteral">&#39;m&#39;</span>) {</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Feed stream has become desynchronized -- disconnecting\n&quot;</span>);</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        }</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;    }</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a>) {</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        <a class="code" href="structFFServerStream.html">FFServerStream</a> *feed = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        <span class="comment">/* a packet has been received : write it in the store, except</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="comment">         * if header */</span></div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">data_count</a> &gt; <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>) {</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;            <span class="comment">/* XXX: use llseek or url_seek</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="comment">             * XXX: Should probably fail? */</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;            <span class="keywordflow">if</span> (lseek(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>, feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a>, SEEK_SET) == -1)</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Seek to %&quot;</span>PRId64<span class="stringliteral">&quot; failed\n&quot;</span>, feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a>);</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            <span class="keywordflow">if</span> (write(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>, c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>) &lt; 0) {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error writing to feed file: %s\n&quot;</span>, strerror(errno));</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            }</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> += <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;            <span class="comment">/* update file size */</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;            <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> &gt; c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a>)</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                feed-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a> = feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a>;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;            <span class="comment">/* handle wrap around if max file size reached */</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;            <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">feed_max_size</a> &amp;&amp;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> &gt;= c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">feed_max_size</a>)</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> = <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            <span class="comment">/* write index */</span></div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a07e9012a2339f51b3d2337cd8d99afc8">ffm_write_write_index</a>(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>, feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a>) &lt; 0) {</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Error writing index to feed file: %s\n&quot;</span>,</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                         strerror(errno));</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            }</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            <span class="comment">/* wake up any waiting connections */</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            <span class="keywordflow">for</span>(c1 = first_http_ctx; <a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>; c1 = c1-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>) {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a> &amp;&amp;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                    c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> == c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                    c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;            }</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            <span class="comment">/* We have a header in our hands that contains useful data */</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = <a class="code" href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a>();</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            <a class="code" href="structAVIOContext.html">AVIOContext</a> *pb;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            <a class="code" href="structAVInputFormat.html">AVInputFormat</a> *fmt_in;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;            <span class="keywordflow">if</span> (!s)</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;            <span class="comment">/* use feed output format name to find corresponding input format */</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;            fmt_in = <a class="code" href="group__lavf__decoding.html#ga7d2f532c6653c2419b17956712fdf3da">av_find_input_format</a>(feed-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>);</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;            <span class="keywordflow">if</span> (!fmt_in)</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            pb = <a class="code" href="avio_8h.html#a853f5149136a27ffba3207d8520172a5">avio_alloc_context</a>(c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>, c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> - c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>,</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                                    0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;            <span class="keywordflow">if</span> (!pb)</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;            pb-&gt;<a class="code" href="structAVIOContext.html#a0e3c41c290b38923880b9cccb669bf78">seekable</a> = 0;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;            s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a> = pb;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavf__decoding.html#ga31d601155e9035d5b0e7efedc894ee49">avformat_open_input</a>(&amp;s, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, fmt_in, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0) {</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pb);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            }</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            <span class="comment">/* Now we have the actual streams */</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a> != feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>) {</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;s);</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pb);</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Feed &#39;%s&#39; stream number does not match registered feed\n&quot;</span>,</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                         c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            }</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>; i++) {</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *fst = feed-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                <a class="code" href="structAVStream.html">AVStream</a> *st = s-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i];</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                <a class="code" href="group__lavc__core.html#gac7b282f51540ca7a99416a3ba6ee0d16">avcodec_parameters_to_context</a>(fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>, st-&gt;<a class="code" href="structAVStream.html#a12826d21779289356722971d362c583c">codecpar</a>);</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                <a class="code" href="group__lavc__core.html#ga0c7058f764778615e7978a1821ab3cfe">avcodec_parameters_from_context</a>(fst-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>, fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>);</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            }</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;            <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;s);</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pb);</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    }</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160; <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">feed_opened</a> = 0;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    close(c-&gt;<a class="code" href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">feed_fd</a>);</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="comment">/* wake up any waiting connections to stop waiting for feed */</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="keywordflow">for</span>(c1 = first_http_ctx; <a class="code" href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a>; c1 = c1-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>) {</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        <span class="keywordflow">if</span> (c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> == <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a> &amp;&amp;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;            c1-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> == c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;            c1-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a>;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    }</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;}</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment">/********************************************************************/</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment">/* RTSP handling */</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;</div><div class="line"><a name="l02886"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9"> 2886</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">enum</span> <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953">RTSPStatusCode</a> error_number)</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;{</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    time_t ti;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="keyword">struct </span>tm *tm;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <span class="keywordtype">char</span> buf2[32];</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    str = <a class="code" href="rtspcodes_8h.html#a1260f9bf593961ef3237e2a8bfe249c8">RTSP_STATUS_CODE2STRING</a>(error_number);</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">if</span> (!str)</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        str = <span class="stringliteral">&quot;Unknown Error&quot;</span>;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;RTSP/1.0 %d %s\r\n&quot;</span>, error_number, str);</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;CSeq: %d\r\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">seq</a>);</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="comment">/* output GMT time */</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    ti = time(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    tm = gmtime(&amp;ti);</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    strftime(buf2, <span class="keyword">sizeof</span>(buf2), <span class="stringliteral">&quot;%a, %d %b %Y %H:%M:%S&quot;</span>, tm);</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Date: %s GMT\r\n&quot;</span>, buf2);</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;}</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d"> 2907</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">enum</span> <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953">RTSPStatusCode</a> error_number)</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;{</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(c, error_number);</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;}</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;</div><div class="line"><a name="l02913"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0c6e9b96e64d7424a4c1ec2b78c1294f"> 2913</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a0c6e9b96e64d7424a4c1ec2b78c1294f">rtsp_parse_request</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c)</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;{</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *p1, *p2;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordtype">char</span> cmd[32];</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    <span class="keywordtype">char</span> url[1024];</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    <span class="keywordtype">char</span> protocol[32];</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structline.html">line</a>[1024];</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> header1 = { 0 }, *<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a> = &amp;header1;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    p = c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(cmd, <span class="keyword">sizeof</span>(cmd), &amp;p);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(url, <span class="keyword">sizeof</span>(url), &amp;p);</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    <a class="code" href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a>(protocol, <span class="keyword">sizeof</span>(protocol), &amp;p);</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">method</a>, cmd, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">method</a>));</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>, url, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">url</a>));</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, protocol, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>));</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>) &lt; 0) {</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <span class="comment">/* XXX: cannot do more */</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* safety */</span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    }</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="comment">/* check version name */</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">if</span> (strcmp(protocol, <span class="stringliteral">&quot;RTSP/1.0&quot;</span>)) {</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a52540a11a69a3452fb4b967e1f4d3f2e">RTSP_STATUS_VERSION</a>);</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        <span class="keywordflow">goto</span> the_end;</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    }</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="comment">/* parse each header line */</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="comment">/* skip to next line */</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="keywordflow">while</span> (*p != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        p++;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        p++;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    <span class="keywordflow">while</span> (*p != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        p1 = memchr(p, <span class="charliteral">&#39;\n&#39;</span>, (<span class="keywordtype">char</span> *)c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> - p);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        <span class="keywordflow">if</span> (!p1)</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        p2 = p1;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">if</span> (p2 &gt; p &amp;&amp; p2[-1] == <span class="charliteral">&#39;\r&#39;</span>)</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;            p2--;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        <span class="comment">/* skip empty line */</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        <span class="keywordflow">if</span> (p2 == p)</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        len = p2 - p;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        <span class="keywordflow">if</span> (len &gt; <span class="keyword">sizeof</span>(line) - 1)</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;            len = <span class="keyword">sizeof</span>(line) - 1;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        memcpy(line, p, len);</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        line[<a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        <a class="code" href="rtsp_8h.html#a71c900763c29cbcd5df47c2c94f1b355">ff_rtsp_parse_line</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, line, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        p = p1 + 1;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    }</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <span class="comment">/* handle sequence number */</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">seq</a> = <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>-&gt;seq;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;DESCRIBE&quot;</span>))</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <a class="code" href="ffserver_8c.html#ab75d5af2efd73e7eee5692f8ce05ee70">rtsp_cmd_describe</a>(c, url);</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;OPTIONS&quot;</span>))</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        <a class="code" href="ffserver_8c.html#a76b437eb4da461b2522b89d18a95fea6">rtsp_cmd_options</a>(c, url);</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;SETUP&quot;</span>))</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        <a class="code" href="ffserver_8c.html#adf12d52e6e8b868b43c702c20c9616d3">rtsp_cmd_setup</a>(c, url, <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;PLAY&quot;</span>))</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <a class="code" href="ffserver_8c.html#afb075e5c5d72162a0be32aaab4383b74">rtsp_cmd_play</a>(c, url, <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>);</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;PAUSE&quot;</span>))</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        <a class="code" href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a">rtsp_cmd_interrupt</a>(c, url, <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, 1);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cmd, <span class="stringliteral">&quot;TEARDOWN&quot;</span>))</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        <a class="code" href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a">rtsp_cmd_interrupt</a>(c, url, <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, 0);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a010e0fa995cc51d44653090810041c09">RTSP_STATUS_METHOD</a>);</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160; the_end:</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    len = <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, &amp;c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>);</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* safety */</span></div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">if</span> (len &lt; 0)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;        <span class="comment">/* XXX: cannot do more */</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">buffer_ptr</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a>;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">buffer_end</a> = c-&gt;<a class="code" href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">pb_buffer</a> + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">RTSPSTATE_SEND_REPLY</a>;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;}</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4"> 3002</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4">prepare_sdp_description</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> **pbuffer,</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                                   <span class="keyword">struct</span> in_addr my_ip)</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;{</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *avc;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <a class="code" href="structAVOutputFormat.html">AVOutputFormat</a> *rtp_format = <a class="code" href="group__lavf__encoding.html#ga8795680bd7489e96eeb5aef5e615cacc">av_guess_format</a>(<span class="stringliteral">&quot;rtp&quot;</span>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <a class="code" href="structAVDictionaryEntry.html">AVDictionaryEntry</a> *entry = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(stream-&gt;<a class="code" href="structFFServerStream.html#aea1b9572fd252c90117af69c2ef73878">metadata</a>, <span class="stringliteral">&quot;title&quot;</span>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    *pbuffer = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    avc =  <a class="code" href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a>();</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    <span class="keywordflow">if</span> (!avc || !rtp_format)</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    avc-&gt;<a class="code" href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">oformat</a> = rtp_format;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <a class="code" href="group__lavu__dict.html#ga8d9c2de72b310cef8e6a28c9cd3acbbe">av_dict_set</a>(&amp;avc-&gt;<a class="code" href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">metadata</a>, <span class="stringliteral">&quot;title&quot;</span>,</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                entry ? entry-&gt;<a class="code" href="structAVDictionaryEntry.html#aa38678f2cad36f120d42e56449c5edb4">value</a> : <span class="stringliteral">&quot;No Title&quot;</span>, 0);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#ac5b11b67652163181e8efd7c7a17a298">is_multicast</a>) {</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(avc-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>, 1024, <span class="stringliteral">&quot;rtp://%s:%d?multicast=1?ttl=%d&quot;</span>,</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                 inet_ntoa(stream-&gt;<a class="code" href="structFFServerStream.html#a47a664cde8fc184519b309e41fe6dc84">multicast_ip</a>),</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                 stream-&gt;<a class="code" href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">multicast_port</a>, stream-&gt;<a class="code" href="structFFServerStream.html#a13c2490307acfdd1d8d179452a870987">multicast_ttl</a>);</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(avc-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>, 1024, <span class="stringliteral">&quot;rtp://0.0.0.0&quot;</span>);</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; i++) {</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        <a class="code" href="structAVStream.html">AVStream</a> *st = <a class="code" href="group__lavf__core.html#gadcb0fd3e507d9b58fe78f61f8ad39827">avformat_new_stream</a>(avc, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="keywordflow">if</span> (!st)</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            <span class="keywordflow">goto</span> sdp_done;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        <a class="code" href="group__lavc__core.html#ga0c7058f764778615e7978a1821ab3cfe">avcodec_parameters_from_context</a>(stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>, stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>);</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(st, stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]);</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    }</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="preprocessor">#define PBUFFER_SIZE 2048</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    *pbuffer = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(<a class="code" href="ffserver_8c.html#a6cd5bfe26f563e17139086c1f18a3183">PBUFFER_SIZE</a>);</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    <span class="keywordflow">if</span> (!*pbuffer)</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;        <span class="keywordflow">goto</span> sdp_done;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <a class="code" href="group__lavf__misc.html#gaa2a7353a6bb0c8726797abd56b176af0">av_sdp_create</a>(&amp;avc, 1, *pbuffer, <a class="code" href="ffserver_8c.html#a6cd5bfe26f563e17139086c1f18a3183">PBUFFER_SIZE</a>);</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160; sdp_done:</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;avc-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>);</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <a class="code" href="group__lavu__dict.html#ga1bafd682b1fbb90e48a4cc3814b820f7">av_dict_free</a>(&amp;avc-&gt;<a class="code" href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">metadata</a>);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(avc);</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;    <span class="keywordflow">return</span> *pbuffer ? strlen(*pbuffer) : <a class="code" href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a>(ENOMEM);</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;}</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;</div><div class="line"><a name="l03047"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a76b437eb4da461b2522b89d18a95fea6"> 3047</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a76b437eb4da461b2522b89d18a95fea6">rtsp_cmd_options</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *url)</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;{</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    <span class="comment">/* rtsp_reply_header(c, RTSP_STATUS_OK); */</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;RTSP/1.0 %d %s\r\n&quot;</span>, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a>, <span class="stringliteral">&quot;OK&quot;</span>);</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;CSeq: %d\r\n&quot;</span>, c-&gt;<a class="code" href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">seq</a>);</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Public: %s\r\n&quot;</span>,</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                <span class="stringliteral">&quot;OPTIONS, DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE&quot;</span>);</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;}</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab75d5af2efd73e7eee5692f8ce05ee70"> 3057</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab75d5af2efd73e7eee5692f8ce05ee70">rtsp_cmd_describe</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *url)</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;{</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    <span class="keywordtype">char</span> path1[1024];</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *path;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *content;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    <span class="keywordtype">int</span> content_length;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    socklen_t <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    <span class="keyword">struct </span>sockaddr_in my_addr;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    <span class="comment">/* find which URL is asked */</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <a class="code" href="group__lavf__misc.html#ga63a0579d6c2aa72470ac742bbbc1205d">av_url_split</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, path1, <span class="keyword">sizeof</span>(path1), url);</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    path = path1;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="keywordflow">if</span> (*path == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        path++;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="structFFServerStream.html#a4bfb8bcea84925fa69c1ce4ee61a7b15">is_feed</a> &amp;&amp;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a> &amp;&amp; !strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>, <span class="stringliteral">&quot;rtp&quot;</span>) &amp;&amp;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;            !strcmp(path, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>)) {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            <span class="keywordflow">goto</span> found;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        }</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    }</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    <span class="comment">/* no stream found */</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a6d04569e9694af1afdab0a83cbf29438">RTSP_STATUS_NOT_FOUND</a>);</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160; found:</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    <span class="comment">/* prepare the media description in SDP format */</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    <span class="comment">/* get the host IP */</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;    len = <span class="keyword">sizeof</span>(my_addr);</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    getsockname(c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a>, (<span class="keyword">struct</span> sockaddr *)&amp;my_addr, &amp;len);</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    content_length = <a class="code" href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4">prepare_sdp_description</a>(stream, &amp;content,</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                                             my_addr.sin_addr);</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;    <span class="keywordflow">if</span> (content_length &lt; 0) {</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953aee353d512fe871f945de042d1fa3c442">RTSP_STATUS_INTERNAL</a>);</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;    <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a>);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Content-Base: %s/\r\n&quot;</span>, url);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Content-Type: application/sdp\r\n&quot;</span>);</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Content-Length: %d\r\n&quot;</span>, content_length);</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <a class="code" href="avio_8h.html#acc3626afc6aa3964b75d02811457164e">avio_write</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, content, content_length);</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(content);</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;}</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;</div><div class="line"><a name="l03105"></a><span class="lineno"><a class="line" href="ffserver_8c.html#acc69a9e45e7975a26cfdfd607fa47a52"> 3105</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="ffserver_8c.html#acc69a9e45e7975a26cfdfd607fa47a52">find_rtp_session</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *session_id)</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;{</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    <span class="keywordflow">if</span> (session_id[0] == <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <span class="keywordflow">for</span>(c = first_http_ctx; <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>; c = c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a>) {</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        <span class="keywordflow">if</span> (!strcmp(c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>, session_id))</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    }</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;}</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092"> 3119</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structRTSPTransportField.html">RTSPTransportField</a> *<a class="code" href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092">find_transport</a>(<a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h, <span class="keyword">enum</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02e">RTSPLowerTransport</a> lower_transport)</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;{</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <a class="code" href="structRTSPTransportField.html">RTSPTransportField</a> *<a class="code" href="regdef_8h.html#a13d252428836cb17e8183d427299d370">th</a>;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;h-&gt;<a class="code" href="structRTSPMessageHeader.html#ae395f0f1c4aca826244adc5953312091">nb_transports</a>;i++) {</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        th = &amp;h-&gt;<a class="code" href="structRTSPMessageHeader.html#abde68f4d04f3e06be52af6250bde02f1">transports</a>[i];</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="keywordflow">if</span> (th-&gt;<a class="code" href="structRTSPTransportField.html#ac2fe3fdef4ee13a5a9d0c9764c3b757f">lower_transport</a> == lower_transport)</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="regdef_8h.html#a13d252428836cb17e8183d427299d370">th</a>;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    }</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;}</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;</div><div class="line"><a name="l03132"></a><span class="lineno"><a class="line" href="ffserver_8c.html#adf12d52e6e8b868b43c702c20c9616d3"> 3132</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#adf12d52e6e8b868b43c702c20c9616d3">rtsp_cmd_setup</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *url,</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                           <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h)</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;{</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordtype">int</span> stream_index, rtp_port, rtcp_port;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[1024];</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    <span class="keywordtype">char</span> path1[1024];</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *path;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtp_c;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    <a class="code" href="structRTSPTransportField.html">RTSPTransportField</a> *<a class="code" href="regdef_8h.html#a13d252428836cb17e8183d427299d370">th</a>;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <span class="keyword">struct </span>sockaddr_in dest_addr;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <a class="code" href="structRTSPActionServerSetup.html">RTSPActionServerSetup</a> setup;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="comment">/* find which URL is asked */</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    <a class="code" href="group__lavf__misc.html#ga63a0579d6c2aa72470ac742bbbc1205d">av_url_split</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, path1, <span class="keyword">sizeof</span>(path1), url);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    path = path1;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;    <span class="keywordflow">if</span> (*path == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        path++;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    <span class="comment">/* now check each stream */</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a4bfb8bcea84925fa69c1ce4ee61a7b15">is_feed</a> || !stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a> ||</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;            strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>, <span class="stringliteral">&quot;rtp&quot;</span>)) {</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        }</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        <span class="comment">/* accept aggregate filenames only if single stream */</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        <span class="keywordflow">if</span> (!strcmp(path, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>)) {</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;            <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a> != 1) {</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953acf53b0a64148bfcea925a8cc411a9701">RTSP_STATUS_AGGREGATE</a>);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;            }</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;            stream_index = 0;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;            <span class="keywordflow">goto</span> found;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;        }</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        <span class="keywordflow">for</span>(stream_index = 0; stream_index &lt; stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;            stream_index++) {</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s/streamid=%d&quot;</span>,</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                     stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, stream_index);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;            <span class="keywordflow">if</span> (!strcmp(path, buf))</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                <span class="keywordflow">goto</span> found;</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;        }</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    }</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="comment">/* no stream found */</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f6f5875bda1f20f1a82bdd0d9dfe89f">RTSP_STATUS_SERVICE</a>); <span class="comment">/* XXX: right error ? */</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160; found:</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <span class="comment">/* generate session id if needed */</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <span class="keywordflow">if</span> (h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="keywordtype">unsigned</span> random0 = <a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(&amp;random_state);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        <span class="keywordtype">unsigned</span> random1 = <a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(&amp;random_state);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>, <span class="keyword">sizeof</span>(h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>), <span class="stringliteral">&quot;%08x%08x&quot;</span>,</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;                 random0, random1);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    }</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="comment">/* find RTP session, and create it if none found */</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    rtp_c = <a class="code" href="ffserver_8c.html#acc69a9e45e7975a26cfdfd607fa47a52">find_rtp_session</a>(h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>);</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    <span class="keywordflow">if</span> (!rtp_c) {</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        <span class="comment">/* always prefer UDP */</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        th = <a class="code" href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092">find_transport</a>(h, <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a>);</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        <span class="keywordflow">if</span> (!th) {</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;            th = <a class="code" href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092">find_transport</a>(h, <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>);</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            <span class="keywordflow">if</span> (!th) {</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953abb638992e412250d2dd6951a9cdff467">RTSP_STATUS_TRANSPORT</a>);</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;            }</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        }</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        rtp_c = <a class="code" href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b">rtp_new_connection</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>, stream, h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>,</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;                                   th-&gt;<a class="code" href="structRTSPTransportField.html#ac2fe3fdef4ee13a5a9d0c9764c3b757f">lower_transport</a>);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <span class="keywordflow">if</span> (!rtp_c) {</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a7ea9b9f6dad3fc14f7bde90bf6cff472">RTSP_STATUS_BANDWIDTH</a>);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        }</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        <span class="comment">/* open input stream */</span></div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a>(rtp_c, <span class="stringliteral">&quot;&quot;</span>) &lt; 0) {</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;            <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953aee353d512fe871f945de042d1fa3c442">RTSP_STATUS_INTERNAL</a>);</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        }</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    }</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    <span class="comment">/* test if stream is OK (test needed because several SETUP needs</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="comment">     * to be done for a given file) */</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <span class="keywordflow">if</span> (rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> != stream) {</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f6f5875bda1f20f1a82bdd0d9dfe89f">RTSP_STATUS_SERVICE</a>);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    }</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <span class="comment">/* test if stream is already set up */</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordflow">if</span> (rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">rtp_ctx</a>[stream_index]) {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f5979edd5bfabad258c8468517db060">RTSP_STATUS_STATE</a>);</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    }</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    <span class="comment">/* check transport */</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    th = <a class="code" href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092">find_transport</a>(h, rtp_c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a>);</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    <span class="keywordflow">if</span> (!th || (th-&gt;<a class="code" href="structRTSPTransportField.html#ac2fe3fdef4ee13a5a9d0c9764c3b757f">lower_transport</a> == <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a> &amp;&amp;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                th-&gt;<a class="code" href="structRTSPTransportField.html#a2cd6f1575b6ece5bd645b70677561e76">client_port_min</a> &lt;= 0)) {</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953abb638992e412250d2dd6951a9cdff467">RTSP_STATUS_TRANSPORT</a>);</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    }</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="comment">/* setup default options */</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    setup.transport_option[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    dest_addr = rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a>;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    dest_addr.sin_port = htons(th-&gt;<a class="code" href="structRTSPTransportField.html#a2cd6f1575b6ece5bd645b70677561e76">client_port_min</a>);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="comment">/* setup stream */</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0">rtp_new_av_stream</a>(rtp_c, stream_index, &amp;dest_addr, c) &lt; 0) {</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953abb638992e412250d2dd6951a9cdff467">RTSP_STATUS_TRANSPORT</a>);</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    }</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    <span class="comment">/* now everything is OK, so we can send the connection parameters */</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a>);</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="comment">/* session ID */</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Session: %s\r\n&quot;</span>, rtp_c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    <span class="keywordflow">switch</span>(rtp_c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a>) {</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a>:</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        rtp_port = <a class="code" href="rtpproto_8c.html#a359c5834d17144c08ff0b65243778571">ff_rtp_get_local_rtp_port</a>(rtp_c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[stream_index]);</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        rtcp_port = <a class="code" href="rtpproto_8c.html#a03678613205135ef7ece19f7fc556110">ff_rtp_get_local_rtcp_port</a>(rtp_c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[stream_index]);</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Transport: RTP/AVP/UDP;unicast;&quot;</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                    <span class="stringliteral">&quot;client_port=%d-%d;server_port=%d-%d&quot;</span>,</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                    th-&gt;<a class="code" href="structRTSPTransportField.html#a2cd6f1575b6ece5bd645b70677561e76">client_port_min</a>, th-&gt;<a class="code" href="structRTSPTransportField.html#ab74cb39e497f057274fed883e4ac38e8">client_port_max</a>,</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                    rtp_port, rtcp_port);</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>:</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Transport: RTP/AVP/TCP;interleaved=%d-%d&quot;</span>,</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                    stream_index * 2, stream_index * 2 + 1);</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    }</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    <span class="keywordflow">if</span> (setup.transport_option[0] != <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;        <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;;%s&quot;</span>, setup.transport_option);</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;}</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="comment"> * find an RTP connection by using the session ID. Check consistency</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="comment"> * with filename</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03281"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a87e247da97177f799c4fe7eb6a577391"> 3281</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="ffserver_8c.html#a87e247da97177f799c4fe7eb6a577391">find_rtp_session_with_url</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *url,</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                                              <span class="keyword">const</span> <span class="keywordtype">char</span> *session_id)</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;{</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtp_c;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <span class="keywordtype">char</span> path1[1024];</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *path;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a>[1024];</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    rtp_c = <a class="code" href="ffserver_8c.html#acc69a9e45e7975a26cfdfd607fa47a52">find_rtp_session</a>(session_id);</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <span class="keywordflow">if</span> (!rtp_c)</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <span class="comment">/* find which URL is asked */</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    <a class="code" href="group__lavf__misc.html#ga63a0579d6c2aa72470ac742bbbc1205d">av_url_split</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, path1, <span class="keyword">sizeof</span>(path1), url);</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    path = path1;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    <span class="keywordflow">if</span> (*path == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        path++;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;    <span class="keywordflow">if</span>(!strcmp(path, rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>)) <span class="keywordflow">return</span> rtp_c;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    <span class="keywordflow">for</span>(s=0; s&lt;rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; ++<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>) {</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s/streamid=%d&quot;</span>,</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, s);</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;      <span class="keywordflow">if</span>(!strncmp(path, buf, <span class="keyword">sizeof</span>(buf)))</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <span class="comment">/* XXX: Should we reply with RTSP_STATUS_ONLY_AGGREGATE</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment">         * if nb_streams&gt;1? */</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;        <span class="keywordflow">return</span> rtp_c;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    }</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    len = strlen(path);</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; path[len - 1] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;        !strncmp(path, rtp_c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, len - 1))</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;        <span class="keywordflow">return</span> rtp_c;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;}</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;</div><div class="line"><a name="l03315"></a><span class="lineno"><a class="line" href="ffserver_8c.html#afb075e5c5d72162a0be32aaab4383b74"> 3315</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#afb075e5c5d72162a0be32aaab4383b74">rtsp_cmd_play</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *url, <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h)</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;{</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtp_c;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    rtp_c = <a class="code" href="ffserver_8c.html#a87e247da97177f799c4fe7eb6a577391">find_rtp_session_with_url</a>(url, h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>);</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    <span class="keywordflow">if</span> (!rtp_c) {</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a2a558cd7b6864129ce14e18e566b3f4e">RTSP_STATUS_SESSION</a>);</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    }</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    <span class="keywordflow">if</span> (rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a> &amp;&amp;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a> &amp;&amp;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a>) {</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f5979edd5bfabad258c8468517db060">RTSP_STATUS_STATE</a>);</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    }</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a>;</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;    <span class="comment">/* now everything is OK, so we can send the connection parameters */</span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a>);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <span class="comment">/* session ID */</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Session: %s\r\n&quot;</span>, rtp_c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;}</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;</div><div class="line"><a name="l03341"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a"> 3341</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a">rtsp_cmd_interrupt</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *url,</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                               <a class="code" href="structRTSPMessageHeader.html">RTSPMessageHeader</a> *h, <span class="keywordtype">int</span> pause_only)</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;{</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtp_c;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    rtp_c = <a class="code" href="ffserver_8c.html#a87e247da97177f799c4fe7eb6a577391">find_rtp_session_with_url</a>(url, h-&gt;<a class="code" href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">session_id</a>);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;    <span class="keywordflow">if</span> (!rtp_c) {</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a2a558cd7b6864129ce14e18e566b3f4e">RTSP_STATUS_SESSION</a>);</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    }</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="keywordflow">if</span> (pause_only) {</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;        <span class="keywordflow">if</span> (rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a> &amp;&amp;</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> != <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a>) {</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;            <a class="code" href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f5979edd5bfabad258c8468517db060">RTSP_STATUS_STATE</a>);</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        }</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a>;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        rtp_c-&gt;<a class="code" href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">first_pts</a> = <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>;</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    }</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    <span class="comment">/* now everything is OK, so we can send the connection parameters */</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <a class="code" href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a>(c, <a class="code" href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a>);</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    <span class="comment">/* session ID */</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;Session: %s\r\n&quot;</span>, rtp_c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>);</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;    <a class="code" href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a>(c-&gt;<a class="code" href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">pb</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    <span class="keywordflow">if</span> (!pause_only)</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        <a class="code" href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a>(rtp_c);</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;}</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="comment">/********************************************************************/</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="comment">/* RTP handling */</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;</div><div class="line"><a name="l03375"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b"> 3375</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structHTTPContext.html">HTTPContext</a> *<a class="code" href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b">rtp_new_connection</a>(<span class="keyword">struct</span> sockaddr_in *from_addr,</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                                       <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream,</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *session_id,</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                                       <span class="keyword">enum</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02e">RTSPLowerTransport</a> rtp_protocol)</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;{</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;    <a class="code" href="structHTTPContext.html">HTTPContext</a> *c = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *proto_str;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    <span class="comment">/* XXX: should output a warning page when coming</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="comment">     * close to the connection limit */</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a> &gt;= config.<a class="code" href="structFFServerConfig.html#ad17ba4b42d4a451f2e08042fb57b1ce4">nb_max_connections</a>)</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    <span class="comment">/* add a new connection */</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    c = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="structHTTPContext.html">HTTPContext</a>));</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="keywordflow">if</span> (!c)</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">fd</a> = -1;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">poll_entry</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd900108894027bb7848787d0626560a">from_addr</a> = *from_addr;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a> = <a class="code" href="ffserver_8c.html#ad09de9db7e8c9fd03d27c7cd8b0d9506">IOBUFFER_INIT_SIZE</a>;</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(c-&gt;<a class="code" href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">buffer_size</a>);</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>)</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <a class="code" href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a>++;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a> = stream;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>, session_id, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">session_id</a>));</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">state</a> = <a class="code" href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a>;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">is_packetized</a> = 1;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a> = rtp_protocol;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    <span class="comment">/* protocol is shown in statistics */</span></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a>) {</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea89dd2ec02679eec3d7de20a8aa33f022">RTSP_LOWER_TRANSPORT_UDP_MULTICAST</a>:</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        proto_str = <span class="stringliteral">&quot;MCAST&quot;</span>;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a>:</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        proto_str = <span class="stringliteral">&quot;UDP&quot;</span>;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>:</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        proto_str = <span class="stringliteral">&quot;TCP&quot;</span>;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;        proto_str = <span class="stringliteral">&quot;???&quot;</span>;</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;    }</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <a class="code" href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, <span class="stringliteral">&quot;RTP/&quot;</span>, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>));</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    <a class="code" href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>, proto_str, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>));</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;    <a class="code" href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a> += stream-&gt;<a class="code" href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">bandwidth</a>;</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">next</a> = <a class="code" href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a>;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    first_http_ctx = <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a>;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160; <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;    <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;c-&gt;<a class="code" href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">buffer</a>);</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(c);</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;    }</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;}</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment"> * add a new RTP stream in an RTP connection (used in RTSP SETUP</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment"> * command). If RTP/TCP protocol is used, TCP connection &#39;rtsp_c&#39; is</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="comment"> * used.</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03444"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0"> 3444</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0">rtp_new_av_stream</a>(<a class="code" href="structHTTPContext.html">HTTPContext</a> *c,</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;                             <span class="keywordtype">int</span> stream_index, <span class="keyword">struct</span> sockaddr_in *dest_addr,</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                             <a class="code" href="structHTTPContext.html">HTTPContext</a> *rtsp_c)</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;{</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    <a class="code" href="structAVStream.html">AVStream</a> *st;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="structRTSPActionServerSetup.html#aab0be1e2a5d7348cb5067d039720889a">ipaddr</a>;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <a class="code" href="structURLContext.html">URLContext</a> *h = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *dummy_buf;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;    <span class="keywordtype">int</span> max_packet_size;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    <span class="keywordtype">void</span> *st_internal;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <span class="comment">/* now we can open the relevant output stream */</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    ctx = <a class="code" href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a>();</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="keywordflow">if</span> (!ctx)</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    ctx-&gt;<a class="code" href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">oformat</a> = <a class="code" href="group__lavf__encoding.html#ga8795680bd7489e96eeb5aef5e615cacc">av_guess_format</a>(<span class="stringliteral">&quot;rtp&quot;</span>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    st = <a class="code" href="group__lavf__core.html#gadcb0fd3e507d9b58fe78f61f8ad39827">avformat_new_stream</a>(ctx, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="keywordflow">if</span> (!st)</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;    st_internal = st-&gt;<a class="code" href="structAVStream.html#ae495a86ddec02af7d5a2805beba9ac9f">internal</a>;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> ||</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a> == c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>)</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;        <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(st, c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[stream_index]);</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(st,</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;               c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[stream_index]]);</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(st-&gt;<a class="code" href="structAVStream.html#a61b61b0d009be377ebcfdc30ea053d27">priv_data</a> == <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(st-&gt;<a class="code" href="structAVStream.html#ae495a86ddec02af7d5a2805beba9ac9f">internal</a> == st_internal);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <span class="comment">/* build destination RTP address */</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    ipaddr = inet_ntoa(dest_addr-&gt;sin_addr);</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <span class="keywordflow">switch</span>(c-&gt;<a class="code" href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">rtp_protocol</a>) {</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a>:</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea89dd2ec02679eec3d7de20a8aa33f022">RTSP_LOWER_TRANSPORT_UDP_MULTICAST</a>:</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;        <span class="comment">/* RTP/UDP case */</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        <span class="comment">/* XXX: also pass as parameter to function ? */</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#ac5b11b67652163181e8efd7c7a17a298">is_multicast</a>) {</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            <span class="keywordtype">int</span> ttl;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;            ttl = c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a13c2490307acfdd1d8d179452a870987">multicast_ttl</a>;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;            <span class="keywordflow">if</span> (!ttl)</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                ttl = 16;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>, <span class="keyword">sizeof</span>(ctx-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>),</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                     <span class="stringliteral">&quot;rtp://%s:%d?multicast=1&amp;ttl=%d&quot;</span>,</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                     ipaddr, ntohs(dest_addr-&gt;sin_port), ttl);</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;            <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>, <span class="keyword">sizeof</span>(ctx-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>),</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                     <span class="stringliteral">&quot;rtp://%s:%d&quot;</span>, ipaddr, ntohs(dest_addr-&gt;sin_port));</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        }</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avio_8c.html#a8d63c4fbaca88ffae9044204ec940d4d">ffurl_open</a>(&amp;h, ctx-&gt;<a class="code" href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">filename</a>, <a class="code" href="avio_8h.html#a5c9308f296545a8f3b7687d277a6dabc">AVIO_FLAG_WRITE</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0)</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">rtp_handles</a>[stream_index] = <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;        max_packet_size = h-&gt;<a class="code" href="structURLContext.html#a929b2b6f142d146ff2df0970839d78ae">max_packet_size</a>;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a>:</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;        <span class="comment">/* RTP/TCP case */</span></div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        c-&gt;<a class="code" href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">rtsp_c</a> = rtsp_c;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        max_packet_size = <a class="code" href="rtsp_8h.html#a53132bb0c530c18c36fc96f3acece4f0">RTSP_TCP_MAX_PACKET_SIZE</a>;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    }</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;%s:%d - - \&quot;PLAY %s/streamid=%d %s\&quot;\n&quot;</span>,</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;             ipaddr, ntohs(dest_addr-&gt;sin_port),</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;             c-&gt;<a class="code" href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">stream</a>-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, stream_index, c-&gt;<a class="code" href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">protocol</a>);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;    <span class="comment">/* normally, no packets should be output here, but the packet size may</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;<span class="comment">     * be checked */</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avio__internal_8h.html#aa743cd8e9a78aae3c1774cc8eba565cc">ffio_open_dyn_packet_buf</a>(&amp;ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, max_packet_size) &lt; 0)</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;        <span class="comment">/* XXX: close stream */</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__lavf__encoding.html#ga18b7b10bb5b94c4842de18166bc677cb">avformat_write_header</a>(ctx, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0) {</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;        <span class="keywordflow">if</span> (h)</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;            <a class="code" href="avio_8c.html#a894b202e9a254d9136a9233a894ba26e">ffurl_close</a>(h);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(st);</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(ctx);</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    }</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;    <a class="code" href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a>(ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, &amp;dummy_buf);</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    ctx-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(dummy_buf);</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    c-&gt;<a class="code" href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">rtp_ctx</a>[stream_index] = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;}</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;<span class="comment">/********************************************************************/</span></div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;<span class="comment">/* ffserver initialization */</span></div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;<span class="comment">/* FIXME: This code should use avformat_new_stream() */</span></div><div class="line"><a name="l03543"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a0b3c5afd4398e7e30dcbb3ca21846a7e"> 3543</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *<a class="code" href="ffserver_8c.html#a0b3c5afd4398e7e30dcbb3ca21846a7e">add_av_stream1</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream,</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;                                <a class="code" href="structAVCodecContext.html">AVCodecContext</a> *codec, <span class="keywordtype">int</span> <a class="code" href="vf__vaguedenoiser_8c.html#a119184041ca9d38a2ef373e1227323f9">copy</a>)</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;{</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *fst;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    <span class="keywordflow">if</span>(stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a> &gt;= <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>))</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    fst = <a class="code" href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a>(<span class="keyword">sizeof</span>(*fst));</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    <span class="keywordflow">if</span> (!fst)</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="keywordflow">if</span> (copy) {</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;        fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a> = <a class="code" href="group__lavc__core.html#gae80afec6f26df6607eaacf39b561c315">avcodec_alloc_context3</a>(codec-&gt;<a class="code" href="structAVCodecContext.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>);</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;        <span class="keywordflow">if</span> (!fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>) {</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(fst);</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;        }</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;        <a class="code" href="group__lavc__core.html#gae381631ba4fb14f4124575d9ceacb87e">avcodec_copy_context</a>(fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>, codec);</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;        <span class="comment">/* live streams must use the actual feed&#39;s codec since it may be</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;<span class="comment">         * updated later to carry extradata needed by them.</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;        fst-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a> = codec;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    <span class="comment">//NOTE we previously allocated internal &amp; internal-&gt;avctx, these seemed uneeded though</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    fst-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a> = <a class="code" href="group__lavc__core.html#ga647755ab2252e93221bb345f3d5e414f">avcodec_parameters_alloc</a>();</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    fst-&gt;<a class="code" href="structLayeredAVStream.html#a431db42df3f89c9cb3c0e7b31751cbf0">index</a> = stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    fst-&gt;<a class="code" href="structLayeredAVStream.html#a500d718ddfcb6ad593c6342c0b1f6b4d">time_base</a> = codec-&gt;<a class="code" href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    fst-&gt;<a class="code" href="structLayeredAVStream.html#a8a333e1b7061be138796ea43fc8851bc">pts_wrap_bits</a> = 33;</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    fst-&gt;<a class="code" href="structLayeredAVStream.html#a17d75293264ad1a69ac2a1475629abe3">sample_aspect_ratio</a> = codec-&gt;<a class="code" href="structAVCodecContext.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>++] = fst;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    <span class="keywordflow">return</span> fst;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;}</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="comment">/* return the stream number in the feed */</span></div><div class="line"><a name="l03578"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ac084014877e6fcb9e41a994d5e39d653"> 3578</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#ac084014877e6fcb9e41a994d5e39d653">add_av_stream</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *feed, <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *st)</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;{</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *fst;</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    <a class="code" href="structAVCodecContext.html">AVCodecContext</a> *av, *av1;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    av = st-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>;</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        av1 = feed-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>;</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;        <span class="keywordflow">if</span> (av1-&gt;<a class="code" href="structAVCodecContext.html#adc5f65d6099fd8339c1580c091777223">codec_id</a> == av-&gt;<a class="code" href="structAVCodecContext.html#adc5f65d6099fd8339c1580c091777223">codec_id</a> &amp;&amp;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            av1-&gt;<a class="code" href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">codec_type</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">codec_type</a> &amp;&amp;</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            av1-&gt;<a class="code" href="structAVCodecContext.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>) {</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            <span class="keywordflow">switch</span>(av-&gt;<a class="code" href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">codec_type</a>) {</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a>:</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                <span class="keywordflow">if</span> (av1-&gt;<a class="code" href="structAVCodecContext.html#ac1e6c2cd1269caa7570575725c682a49">channels</a> == av-&gt;<a class="code" href="structAVCodecContext.html#ac1e6c2cd1269caa7570575725c682a49">channels</a> &amp;&amp;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                    av1-&gt;<a class="code" href="structAVCodecContext.html#a8ff0b000c463361e234af48d03aadfc0">sample_rate</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a8ff0b000c463361e234af48d03aadfc0">sample_rate</a>)</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                    <span class="keywordflow">return</span> i;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>:</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                <span class="keywordflow">if</span> (av1-&gt;<a class="code" href="structAVCodecContext.html#a0d8f46461754e8abea0847dcbc41b956">width</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a0d8f46461754e8abea0847dcbc41b956">width</a> &amp;&amp;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                    av1-&gt;<a class="code" href="structAVCodecContext.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a> &amp;&amp;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                    av1-&gt;<a class="code" href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="structAVRational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> == av-&gt;<a class="code" href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="structAVRational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> &amp;&amp;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                    av1-&gt;<a class="code" href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="structAVRational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> == av-&gt;<a class="code" href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="structAVRational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> &amp;&amp;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                    av1-&gt;<a class="code" href="structAVCodecContext.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> == av-&gt;<a class="code" href="structAVCodecContext.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a>)</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                    <span class="keywordflow">return</span> i;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                abort();</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;            }</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;        }</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    }</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;    fst = <a class="code" href="ffserver_8c.html#a0b3c5afd4398e7e30dcbb3ca21846a7e">add_av_stream1</a>(feed, av, 0);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    <span class="keywordflow">if</span> (!fst)</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    <span class="keywordflow">if</span> (st-&gt;<a class="code" href="structLayeredAVStream.html#af7c9cefb5ec8162d851704d714534a1e">recommended_encoder_configuration</a>)</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        fst-&gt;<a class="code" href="structLayeredAVStream.html#af7c9cefb5ec8162d851704d714534a1e">recommended_encoder_configuration</a> =</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;            <a class="code" href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a>(st-&gt;<a class="code" href="structLayeredAVStream.html#af7c9cefb5ec8162d851704d714534a1e">recommended_encoder_configuration</a>);</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    <span class="keywordflow">return</span> feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a> - 1;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;}</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;</div><div class="line"><a name="l03620"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aac30c1abd86159649faf9a15a0963261"> 3620</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#aac30c1abd86159649faf9a15a0963261">remove_stream</a>(<a class="code" href="structFFServerStream.html">FFServerStream</a> *stream)</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;{</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> **ps;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;    ps = &amp;config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>;</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;    <span class="keywordflow">while</span> (*ps) {</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;        <span class="keywordflow">if</span> (*ps == stream)</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;            *ps = (*ps)-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;            ps = &amp;(*ps)-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    }</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;}</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">/* compute the needed AVStream for each file */</span></div><div class="line"><a name="l03633"></a><span class="lineno"><a class="line" href="ffserver_8c.html#ab36ef016e24afdb7395f67e6527ca80e"> 3633</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#ab36ef016e24afdb7395f67e6527ca80e">build_file_streams</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;{</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *infile;</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    <span class="keywordtype">int</span> i, ret;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <span class="comment">/* gather all streams */</span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        infile = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">stream_type</a> != <a class="code" href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6">STREAM_TYPE_LIVE</a> || stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>)</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;        <span class="comment">/* the stream comes from a file */</span></div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;        <span class="comment">/* try to open the file */</span></div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;        <span class="comment">/* open stream */</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;        <span class="comment">/* specific case: if transport stream output to RTP,</span></div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;<span class="comment">         * we use a raw transport stream reader */</span></div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a> &amp;&amp; !strcmp(stream-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>-&gt;<a class="code" href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">name</a>, <span class="stringliteral">&quot;rtp&quot;</span>))</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;            <a class="code" href="group__lavu__dict.html#ga8d9c2de72b310cef8e6a28c9cd3acbbe">av_dict_set</a>(&amp;stream-&gt;<a class="code" href="structFFServerStream.html#a53df34afe0a8459d3ab3664816d0b8d7">in_opts</a>, <span class="stringliteral">&quot;mpeg2ts_compute_pcr&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 0);</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;        <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>[0]) {</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Unspecified feed file for stream &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                     stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;        }</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Opening feed file &#39;%s&#39; for stream &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;                 stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, stream-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>);</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;        ret = <a class="code" href="group__lavf__decoding.html#ga31d601155e9035d5b0e7efedc894ee49">avformat_open_input</a>(&amp;infile, stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>,</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                                  stream-&gt;<a class="code" href="structFFServerStream.html#aaf39d9bebde7e936e4dd23428d6581c7">ifmt</a>, &amp;stream-&gt;<a class="code" href="structFFServerStream.html#a53df34afe0a8459d3ab3664816d0b8d7">in_opts</a>);</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open &#39;%s&#39;: %s\n&quot;</span>, stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>,</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                     <a class="code" href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a>(ret));</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;            <span class="comment">/* remove stream (no need to spend more time on it) */</span></div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;        <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;            <a class="code" href="ffserver_8c.html#aac30c1abd86159649faf9a15a0963261">remove_stream</a>(stream);</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;            <span class="comment">/* find all the AVStreams inside and reference them in</span></div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="comment">             * &#39;stream&#39; */</span></div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavf__decoding.html#gad42172e27cddafb81096939783b157bb">avformat_find_stream_info</a>(infile, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0) {</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not find codec parameters from &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;                         stream-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;                <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;infile);</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;            }</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;            <span class="keywordflow">for</span>(i=0;i&lt;infile-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>;i++)</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;                <a class="code" href="ffserver_8c.html#a0b3c5afd4398e7e30dcbb3ca21846a7e">add_av_stream1</a>(stream, infile-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i]-&gt;codec, 1);</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;            <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;infile);</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;        }</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    }</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;}</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span></div><div class="line"><a name="l03692"></a><span class="lineno"><a class="line" href="ffserver_8c.html#abdf71fb497c71e9f55df5fd7541bff22"> 3692</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#abdf71fb497c71e9f55df5fd7541bff22">check_codec_match</a>(<a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *ccf, <a class="code" href="structAVStream.html">AVStream</a> *ccs, <span class="keywordtype">int</span> stream)</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;{</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    <span class="keywordtype">int</span> matches = 1;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">/* FIXME: Missed check on AVCodecContext.flags */</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="preprocessor">#define CHECK_CODEC(x)  (ccf-&gt;codecpar-&gt;x != ccs-&gt;codecpar-&gt;x)</span></div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="ffmpeg__vaapi_8c.html#a0fd12851a78b80080e277db30411728d">codec_id</a>) || <a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="rtp_8c.html#a550d0fd0475cc25c2e1fec3e15acaffb">codec_type</a>)) {</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Codecs do not match for stream %d\n&quot;</span>, stream);</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;        matches = 0;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(bit_rate)) {</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Codec bitrates do not match for stream %d\n&quot;</span>, stream);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;        matches = 0;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ccf-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">codec_type</a> == <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>) {</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__lavu__math__rational.html#gaa440bf42ede128219a571ae4ce0f90b8">av_cmp_q</a>(ccf-&gt;<a class="code" href="structLayeredAVStream.html#a500d718ddfcb6ad593c6342c0b1f6b4d">time_base</a>, ccs-&gt;<a class="code" href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">time_base</a>) ||</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;            <a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a>) || <a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>)) {</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Codec width, height or framerate do not match for stream %d\n&quot;</span>, stream);</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;            matches = 0;</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;        }</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ccf-&gt;<a class="code" href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">codecpar</a>-&gt;<a class="code" href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">codec_type</a> == <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a>) {</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="ffmpeg__filter_8c.html#a9feef5270e0e54f103868362df0cd27a">sample_rate</a>) ||</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;            <a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(channels) ||</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;            <a class="code" href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a>(<a class="code" href="mxfenc_8c.html#ad662aa56c1696f09c0ac6b97abafac6d">frame_size</a>)) {</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Codec sample_rate, channels, frame_size do not match for stream %d\n&quot;</span>, stream);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;            matches = 0;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        }</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Unknown codec type for stream %d\n&quot;</span>, stream);</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;        matches = 0;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    }</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    <span class="keywordflow">return</span> matches;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;}</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="comment">/* compute the needed AVStream for each feed */</span></div><div class="line"><a name="l03726"></a><span class="lineno"><a class="line" href="ffserver_8c.html#aa742c9952e658cc18600e326da6ada2f"> 3726</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#aa742c9952e658cc18600e326da6ada2f">build_feed_streams</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;{</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream, *feed;</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    <span class="keywordtype">int</span> i, fd;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;    <span class="comment">/* gather all streams */</span></div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;        feed = stream-&gt;<a class="code" href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">feed</a>;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;        <span class="keywordflow">if</span> (!feed)</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;        <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="structFFServerStream.html#a4bfb8bcea84925fa69c1ce4ee61a7b15">is_feed</a>) {</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;            <span class="keywordflow">for</span>(i=0;i&lt;stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++)</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;                stream-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[i] = i;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;        }</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;        <span class="comment">/* we handle a stream coming from a feed */</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++)</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;            stream-&gt;<a class="code" href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">feed_streams</a>[i] = <a class="code" href="ffserver_8c.html#ac084014877e6fcb9e41a994d5e39d653">add_av_stream</a>(feed, stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]);</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;    }</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="comment">/* create feed files if needed */</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    <span class="keywordflow">for</span>(feed = config.<a class="code" href="structFFServerConfig.html#aa363e6ef1fb0c3d45e4b05657ed751d6">first_feed</a>; feed; feed = feed-&gt;<a class="code" href="structFFServerStream.html#a8988457ffee4cec8543ad5c29d7abf2c">next_feed</a>) {</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avio_8c.html#aa4006f7b803e4d104231734a23b35ab7">avio_check</a>(feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, <a class="code" href="avio_8h.html#a21e61cb486bd1588eb7f775998cf8c77">AVIO_FLAG_READ</a>) &gt; 0) {</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;            <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;            <span class="keywordtype">int</span> matches = 0;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;            <span class="comment">/* See if it matches */</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavf__decoding.html#ga31d601155e9035d5b0e7efedc894ee49">avformat_open_input</a>(&amp;s, feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0) {</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Deleting feed file &#39;%s&#39; as it appears &quot;</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                            <span class="stringliteral">&quot;to be corrupt\n&quot;</span>,</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;                         feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;                <span class="keywordflow">goto</span> drop;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;            }</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;            <span class="comment">/* set buffer size */</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="avio__internal_8h.html#a64d46fddfb5ef6745e46078b69517506">ffio_set_buf_size</a>(s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>) &lt; 0) {</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Failed to set buffer size\n&quot;</span>);</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;s);</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;                <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;            }</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;            <span class="comment">/* Now see if it matches */</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;            <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a> != feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>) {</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Deleting feed file &#39;%s&#39; as stream counts &quot;</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;                            <span class="stringliteral">&quot;differ (%d != %d)\n&quot;</span>,</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;                         feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>, feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>);</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;                <span class="keywordflow">goto</span> drop;</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;            }</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;            matches = 1;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;            <span class="keywordflow">for</span>(i=0;i&lt;s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a>;i++) {</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                <a class="code" href="structAVStream.html">AVStream</a> *<a class="code" href="colorspacedsp__template_8c.html#a74d3c3c85d450f9238a162d015c0b407">ss</a>;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;                <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *sf;</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                sf = feed-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                ss = s-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a>[i];</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                <span class="keywordflow">if</span> (sf-&gt;<a class="code" href="structLayeredAVStream.html#a431db42df3f89c9cb3c0e7b31751cbf0">index</a> != ss-&gt;<a class="code" href="structAVStream.html#a6ca823054632821e085377f7d371a2d1">index</a> || sf-&gt;<a class="code" href="structLayeredAVStream.html#a8d2e8ac4f3ecaeac7af769b7e5c8281c">id</a> != ss-&gt;<a class="code" href="structAVStream.html#a6873ed62f196c24e8bf282609231786f">id</a>) {</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;                    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Index &amp; Id do not match for stream %d (%s)\n&quot;</span>,</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;                             i, feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;                    matches = 0;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;                }</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                matches = <a class="code" href="ffserver_8c.html#abdf71fb497c71e9f55df5fd7541bff22">check_codec_match</a> (sf, ss, i);</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;                <span class="keywordflow">if</span> (!matches)</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;            }</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;drop:</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;            <span class="keywordflow">if</span> (s)</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                <a class="code" href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a>(&amp;s);</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;            <span class="keywordflow">if</span> (!matches) {</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a38cbc874e9f67c090ce9df4788aa7ea3">readonly</a>) {</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;                    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Unable to delete read-only feed file &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                             feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                    <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;                }</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                unlink(feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;            }</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        }</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avio_8c.html#aa4006f7b803e4d104231734a23b35ab7">avio_check</a>(feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, <a class="code" href="avio_8h.html#a5c9308f296545a8f3b7687d277a6dabc">AVIO_FLAG_WRITE</a>) &lt;= 0) {</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;            <a class="code" href="structAVFormatContext.html">AVFormatContext</a> *<a class="code" href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = <a class="code" href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a>();</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            <span class="keywordflow">if</span> (!s) {</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Failed to allocate context\n&quot;</span>);</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;            }</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;            <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a38cbc874e9f67c090ce9df4788aa7ea3">readonly</a>) {</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Unable to create feed file &#39;%s&#39; as it is &quot;</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;                            <span class="stringliteral">&quot;marked readonly\n&quot;</span>,</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;                         feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                <a class="code" href="group__lavf__core.html#gac2990b13b68e831a408fce8e1d0d6445">avformat_free_context</a>(s);</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;                <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;            }</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;            <span class="comment">/* only write the header of the ffm file */</span></div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="avio_8h.html#a371a670112abc5f3e15bc570da076301">avio_open</a>(&amp;s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>, feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, <a class="code" href="avio_8h.html#a5c9308f296545a8f3b7687d277a6dabc">AVIO_FLAG_WRITE</a>) &lt; 0) {</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open output feed file &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;                         feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;                <a class="code" href="group__lavf__core.html#gac2990b13b68e831a408fce8e1d0d6445">avformat_free_context</a>(s);</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;                <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;            }</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;            s-&gt;<a class="code" href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">oformat</a> = feed-&gt;<a class="code" href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">fmt</a>;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;            <span class="keywordflow">for</span> (i = 0; i&lt;feed-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>; i++) {</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;                <a class="code" href="structAVStream.html">AVStream</a> *st = <a class="code" href="group__lavf__core.html#gadcb0fd3e507d9b58fe78f61f8ad39827">avformat_new_stream</a>(s, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// FIXME free this</span></div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;                <span class="keywordflow">if</span> (!st) {</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;                    <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Failed to allocate stream\n&quot;</span>);</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;                    <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;                }</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                <a class="code" href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a>(st, feed-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i]);</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;            }</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__lavf__encoding.html#ga18b7b10bb5b94c4842de18166bc677cb">avformat_write_header</a>(s, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt; 0) {</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Container doesn&#39;t support the required parameters\n&quot;</span>);</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;                <a class="code" href="avio_8h.html#ae118a1f37f1e48617609ead9910aac15">avio_closep</a>(&amp;s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>);</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                s-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a> = 0;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                <a class="code" href="group__lavf__core.html#gac2990b13b68e831a408fce8e1d0d6445">avformat_free_context</a>(s);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;                <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            }</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;            <span class="comment">/* XXX: need better API */</span></div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;s-&gt;<a class="code" href="structAVFormatContext.html#ac4c0777e54085af2f3f1b27130e2b21b">priv_data</a>);</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;            <a class="code" href="avio_8h.html#ae118a1f37f1e48617609ead9910aac15">avio_closep</a>(&amp;s-&gt;<a class="code" href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">pb</a>);</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;            s-&gt;<a class="code" href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">streams</a> = <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;            s-&gt;<a class="code" href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">nb_streams</a> = 0;</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;            <a class="code" href="group__lavf__core.html#gac2990b13b68e831a408fce8e1d0d6445">avformat_free_context</a>(s);</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;        }</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;        <span class="comment">/* get feed size and write index */</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;        fd = open(feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>, O_RDONLY);</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;        <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not open output feed file &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;                    feed-&gt;<a class="code" href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">feed_filename</a>);</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;            <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;        }</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;        feed-&gt;<a class="code" href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">feed_write_index</a> = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">ffm_read_write_index</a>(fd),</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;                                       <a class="code" href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a>);</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;        feed-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a> = lseek(fd, 0, SEEK_END);</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;        <span class="comment">/* ensure that we do not wrap before the end of file */</span></div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;        <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">feed_max_size</a> &amp;&amp; feed-&gt;<a class="code" href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">feed_max_size</a> &lt; feed-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a>)</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;            feed-&gt;<a class="code" href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">feed_max_size</a> = feed-&gt;<a class="code" href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">feed_size</a>;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;        close(fd);</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;    }</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;bail:</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;}</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;<span class="comment">/* compute the bandwidth used by each stream */</span></div><div class="line"><a name="l03884"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a5ca236f4c53d713f2646d79d7612b71c"> 3884</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a5ca236f4c53d713f2646d79d7612b71c">compute_bandwidth</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;{</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;    <span class="keywordtype">unsigned</span> bandwidth;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;    <a class="code" href="structFFServerStream.html">FFServerStream</a> *stream;</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;    <span class="keywordflow">for</span>(stream = config.<a class="code" href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">first_stream</a>; stream; stream = stream-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;        bandwidth = 0;</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;        <span class="keywordflow">for</span>(i=0;i&lt;stream-&gt;<a class="code" href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">nb_streams</a>;i++) {</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;            <a class="code" href="structLayeredAVStream.html">LayeredAVStream</a> *st = stream-&gt;<a class="code" href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">streams</a>[i];</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;            <span class="keywordflow">switch</span>(st-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">codec_type</a>) {</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a>:</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>:</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;                bandwidth += st-&gt;<a class="code" href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">codec</a>-&gt;<a class="code" href="structAVCodecContext.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;            }</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        }</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        stream-&gt;<a class="code" href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">bandwidth</a> = (bandwidth + 999) / 1000;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    }</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;}</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;</div><div class="line"><a name="l03907"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a6fa60ea5086e24e4484ed12216df3fff"> 3907</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a6fa60ea5086e24e4484ed12216df3fff">handle_child_exit</a>(<span class="keywordtype">int</span> sig)</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;{</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    pid_t pid;</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;    <span class="keywordtype">int</span> status;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;    time_t uptime;</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;    <span class="keywordflow">while</span> ((pid = waitpid(-1, &amp;status, WNOHANG)) &gt; 0) {</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        <a class="code" href="structFFServerStream.html">FFServerStream</a> *feed;</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        <span class="keywordflow">for</span> (feed = config.<a class="code" href="structFFServerConfig.html#aa363e6ef1fb0c3d45e4b05657ed751d6">first_feed</a>; feed; feed = feed-&gt;<a class="code" href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">next</a>) {</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            <span class="keywordflow">if</span> (feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a> != pid)</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;            uptime = time(0) - feed-&gt;<a class="code" href="structFFServerStream.html#a72fea57e6b6d4dd2aac2a815ada63bd2">pid_start</a>;</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            feed-&gt;<a class="code" href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">pid</a> = 0;</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;            fprintf(stderr,</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;                    <span class="stringliteral">&quot;%s: Pid %&quot;</span>PRId64<span class="stringliteral">&quot; exited with status %d after %&quot;</span>PRId64<span class="stringliteral">&quot; &quot;</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;                        <span class="stringliteral">&quot;seconds\n&quot;</span>,</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;                    feed-&gt;<a class="code" href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">filename</a>, (int64_t) pid, status, (int64_t)uptime);</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;            <span class="keywordflow">if</span> (uptime &lt; 30)</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                <span class="comment">/* Turn off any more restarts */</span></div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;                <a class="code" href="ffserver__config_8c.html#a823cf44c706cfd104ba7339272759987">ffserver_free_child_args</a>(&amp;feed-&gt;<a class="code" href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">child_argv</a>);</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        }</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;    }</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;    <a class="code" href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">need_to_start_children</a> = 1;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;}</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;</div><div class="line"><a name="l03936"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a914a7920b526fd32fa0a982ab9fc1ce5"> 3936</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a914a7920b526fd32fa0a982ab9fc1ce5">opt_debug</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;{</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    config.<a class="code" href="structFFServerConfig.html#a82fc4d3aca083cbfc5d972ff8c52f892">debug</a> = 1;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(config.<a class="code" href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">logfilename</a>, <span class="keyword">sizeof</span>(config.<a class="code" href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">logfilename</a>), <span class="stringliteral">&quot;-&quot;</span>);</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;}</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;</div><div class="line"><a name="l03942"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a86b0b3c5097befa080e58ccbafe289c3"> 3942</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="ffserver_8c.html#a86b0b3c5097befa080e58ccbafe289c3">show_help_default</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *opt, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="libavcodec_2jacosubdec_8c.html#ac3a73711fd7f8a50db1c4b62e41cf852">arg</a>)</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;{</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    printf(<span class="stringliteral">&quot;usage: ffserver [options]\n&quot;</span></div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;           <span class="stringliteral">&quot;Hyper fast multi format Audio/Video streaming server\n&quot;</span>);</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <a class="code" href="cmdutils_8c.html#a13fba56a5674556e879f5733f9b1dd55">show_help_options</a>(options, <span class="stringliteral">&quot;Main options:&quot;</span>, 0, 0, 0);</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;}</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;</div><div class="line"><a name="l03950"></a><span class="lineno"><a class="line" href="ffmpeg_8h.html#abdbaa7127ef32aa4c435f3c609b4c2cd"> 3950</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structOptionDef.html">OptionDef</a> options[] = {</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cmdutils__common__opts_8h.html">cmdutils_common_opts.h</a>&quot;</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;    { <span class="stringliteral">&quot;n&quot;</span>, <a class="code" href="cmdutils_8h.html#a1b1c1cb0b866790034157479d6dd5da6">OPT_BOOL</a>, {(<span class="keywordtype">void</span> *)&amp;<a class="code" href="ffserver_8c.html#a9b94fed195a0fde46da68d2d0034ecbe">no_launch</a> }, <span class="stringliteral">&quot;enable no-launch mode&quot;</span> },</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;    { <span class="stringliteral">&quot;d&quot;</span>, 0, {(<span class="keywordtype">void</span>*)<a class="code" href="ffserver_8c.html#a914a7920b526fd32fa0a982ab9fc1ce5">opt_debug</a>}, <span class="stringliteral">&quot;enable debug mode&quot;</span> },</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    { <span class="stringliteral">&quot;f&quot;</span>, <a class="code" href="cmdutils_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a> | <a class="code" href="cmdutils_8h.html#a91fea349332c05eb78ce3c17202e1dc9">OPT_STRING</a>, {(<span class="keywordtype">void</span>*)&amp;config.<a class="code" href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">filename</a> }, <span class="stringliteral">&quot;use configfile instead of /etc/ffserver.conf&quot;</span>, <span class="stringliteral">&quot;configfile&quot;</span> },</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    { <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> },</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;};</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;</div><div class="line"><a name="l03958"></a><span class="lineno"><a class="line" href="ffserver_8c.html#a3c04138a5bfe5d72780bb7e82a18e627"> 3958</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ffserver_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;{</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;    <span class="keyword">struct </span>sigaction sigact = { { 0 } };</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;    <span class="keywordtype">int</span> cfg_parsed;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;    <span class="keywordtype">int</span> ret = EXIT_FAILURE;</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    <a class="code" href="cmdutils_8c.html#a0f4db71e6407040a01316c537db5040c">init_dynload</a>();</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;    config.<a class="code" href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">filename</a> = <a class="code" href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a>(<span class="stringliteral">&quot;/etc/ffserver.conf&quot;</span>);</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;    <a class="code" href="cmdutils_8c.html#a812390811ecf2673409d4d2191b3696a">parse_loglevel</a>(argc, argv, options);</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;    <a class="code" href="group__lavf__core.html#ga917265caec45ef5a0646356ed1a507e3">av_register_all</a>();</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <a class="code" href="group__lavf__core.html#ga84542023693d61e8564c5d457979c932">avformat_network_init</a>();</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    <a class="code" href="cmdutils_8c.html#a976c7dc9afeb4b0f6ec009a7a084e701">show_banner</a>(argc, argv, options);</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;    <a class="code" href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a> = argv[0];</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;    <a class="code" href="cmdutils_8c.html#a8863e994be95bc81bbedff194aa2842f">parse_options</a>(<a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, argc, argv, options, <a class="code" href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;    unsetenv(<span class="stringliteral">&quot;http_proxy&quot;</span>);             <span class="comment">/* Kill the http_proxy */</span></div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;    <a class="code" href="lfg_8c.html#aa8cc657d3dca15bc50a94730a4346d58">av_lfg_init</a>(&amp;random_state, <a class="code" href="group__lavu__crypto.html#ga4fe662789c7e05a6b63e0c675dbbd7ed">av_get_random_seed</a>());</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;    sigact.sa_handler = <a class="code" href="ffserver_8c.html#a6fa60ea5086e24e4484ed12216df3fff">handle_child_exit</a>;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    sigact.sa_flags = SA_NOCLDSTOP | SA_RESTART;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;    sigaction(SIGCHLD, &amp;sigact, 0);</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="keywordflow">if</span> ((cfg_parsed = <a class="code" href="ffserver__config_8c.html#a546fd5c1de859662f456c9524e63071b">ffserver_parse_ffconfig</a>(config.<a class="code" href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">filename</a>, &amp;config)) &lt; 0) {</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Error reading configuration file &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;                config.<a class="code" href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">filename</a>, <a class="code" href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a>(cfg_parsed));</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;        <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    }</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="comment">/* open log file if needed */</span></div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    <span class="keywordflow">if</span> (config.<a class="code" href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">logfilename</a>[0] != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        <span class="keywordflow">if</span> (!strcmp(config.<a class="code" href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">logfilename</a>, <span class="stringliteral">&quot;-&quot;</span>))</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;            <a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a> = stdout;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;            <a class="code" href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a> = fopen(config.<a class="code" href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">logfilename</a>, <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;        <a class="code" href="group__lavu__log.html#ga14034761faf581a8b9ed6ef19b313708">av_log_set_callback</a>(<a class="code" href="ffserver_8c.html#abe8f2ce62bfb5e7a38d71406625c1dd0">http_av_log</a>);</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    }</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;    <a class="code" href="ffserver_8c.html#ab36ef016e24afdb7395f67e6527ca80e">build_file_streams</a>();</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#aa742c9952e658cc18600e326da6ada2f">build_feed_streams</a>() &lt; 0) {</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not setup feed streams\n&quot;</span>);</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;        <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    }</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    <a class="code" href="ffserver_8c.html#a5ca236f4c53d713f2646d79d7612b71c">compute_bandwidth</a>();</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;    <span class="comment">/* signal init */</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;    signal(SIGPIPE, SIG_IGN);</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ffserver_8c.html#a14234b6e4169d7035d9b2fd05597e6ec">http_server</a>() &lt; 0) {</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;        <a class="code" href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a>(<span class="stringliteral">&quot;Could not start server\n&quot;</span>);</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        <span class="keywordflow">goto</span> bail;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    }</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    ret=EXIT_SUCCESS;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;bail:</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a> (&amp;config.<a class="code" href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">filename</a>);</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <a class="code" href="group__lavf__core.html#ga245f2875f80ce67ec3d1e0f54dacf2c4">avformat_network_deinit</a>();</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;}</div><div class="ttc" id="structAVLFG_html"><div class="ttname"><a href="structAVLFG.html">AVLFG</a></div><div class="ttdef"><b>Definition:</b> <a href="lfg_8h_source.html#l00025">lfg.h:25</a></div></div>
<div class="ttc" id="avio_8h_html_a371a670112abc5f3e15bc570da076301"><div class="ttname"><a href="avio_8h.html#a371a670112abc5f3e15bc570da076301">avio_open</a></div><div class="ttdeci">int avio_open(AVIOContext **s, const char *url, int flags)</div><div class="ttdoc">Create and initialize a AVIOContext for accessing the resource indicated by url. </div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l01033">aviobuf.c:1033</a></div></div>
<div class="ttc" id="ffserver_8c_html_ae821bc5aa5ceb895f9772c0b55ed94a0"><div class="ttname"><a href="ffserver_8c.html#ae821bc5aa5ceb895f9772c0b55ed94a0">rtp_new_av_stream</a></div><div class="ttdeci">static int rtp_new_av_stream(HTTPContext *c, int stream_index, struct sockaddr_in *dest_addr, HTTPContext *rtsp_c)</div><div class="ttdoc">add a new RTP stream in an RTP connection (used in RTSP SETUP command). </div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03444">ffserver.c:3444</a></div></div>
<div class="ttc" id="cmdutils_8c_html_a0f4db71e6407040a01316c537db5040c"><div class="ttname"><a href="cmdutils_8c.html#a0f4db71e6407040a01316c537db5040c">init_dynload</a></div><div class="ttdeci">void init_dynload(void)</div><div class="ttdoc">Initialize dynamic library loading. </div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8c_source.html#l00119">cmdutils.c:119</a></div></div>
<div class="ttc" id="group__lavf__misc_html_ga63a0579d6c2aa72470ac742bbbc1205d"><div class="ttname"><a href="group__lavf__misc.html#ga63a0579d6c2aa72470ac742bbbc1205d">av_url_split</a></div><div class="ttdeci">void av_url_split(char *proto, int proto_size, char *authorization, int authorization_size, char *hostname, int hostname_size, int *port_ptr, char *path, int path_size, const char *url)</div><div class="ttdoc">Split a URL string into components. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04486">utils.c:4486</a></div></div>
<div class="ttc" id="ffserver_8c_html_a527c7910002d011eb71174bdc34cdb7e"><div class="ttname"><a href="ffserver_8c.html#a527c7910002d011eb71174bdc34cdb7e">validate_acl</a></div><div class="ttdeci">static int validate_acl(FFServerStream *stream, HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01373">ffserver.c:1373</a></div></div>
<div class="ttc" id="ffserver_8c_html_a217f01fda38731495d208caf539ac9b5"><div class="ttname"><a href="ffserver_8c.html#a217f01fda38731495d208caf539ac9b5">http_state</a></div><div class="ttdeci">static const char *const http_state[]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00091">ffserver.c:91</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7fb89946ff402a4012353283022da2e7">HTTPSTATE_WAIT_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00077">ffserver.c:77</a></div></div>
<div class="ttc" id="rtsp_8h_html_a7d32a74979e7e6f60215f11789b3e02ea89dd2ec02679eec3d7de20a8aa33f022"><div class="ttname"><a href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea89dd2ec02679eec3d7de20a8aa33f022">RTSP_LOWER_TRANSPORT_UDP_MULTICAST</a></div><div class="ttdoc">UDP/multicast. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00040">rtsp.h:40</a></div></div>
<div class="ttc" id="ffserver_8c_html_acc69a9e45e7975a26cfdfd607fa47a52"><div class="ttname"><a href="ffserver_8c.html#acc69a9e45e7975a26cfdfd607fa47a52">find_rtp_session</a></div><div class="ttdeci">static HTTPContext * find_rtp_session(const char *session_id)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03105">ffserver.c:3105</a></div></div>
<div class="ttc" id="structDataRateData_html_a3ce9871bbc95ef8f0a988253cde02843"><div class="ttname"><a href="structDataRateData.html#a3ce9871bbc95ef8f0a988253cde02843">DataRateData::count1</a></div><div class="ttdeci">int64_t count1</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00121">ffserver.c:121</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a6e606effa68724cae2ef5cc05f7fd9cb"><div class="ttname"><a href="structAVCodecContext.html#a6e606effa68724cae2ef5cc05f7fd9cb">AVCodecContext::codec</a></div><div class="ttdeci">const struct AVCodec * codec</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01695">avcodec.h:1695</a></div></div>
<div class="ttc" id="ffserver__config_8c_html_a546fd5c1de859662f456c9524e63071b"><div class="ttname"><a href="ffserver__config_8c.html#a546fd5c1de859662f456c9524e63071b">ffserver_parse_ffconfig</a></div><div class="ttdeci">int ffserver_parse_ffconfig(const char *filename, FFServerConfig *config)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8c_source.html#l01210">ffserver_config.c:1210</a></div></div>
<div class="ttc" id="structFFServerStream_html_a72fea57e6b6d4dd2aac2a815ada63bd2"><div class="ttname"><a href="structFFServerStream.html#a72fea57e6b6d4dd2aac2a815ada63bd2">FFServerStream::pid_start</a></div><div class="ttdeci">time_t pid_start</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00090">ffserver_config.h:90</a></div></div>
<div class="ttc" id="ffserver_8c_html_a8c3aec3d7e1ed7c1cd8b0f3eec58fba7"><div class="ttname"><a href="ffserver_8c.html#a8c3aec3d7e1ed7c1cd8b0f3eec58fba7">my_program_name</a></div><div class="ttdeci">static const char * my_program_name</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00241">ffserver.c:241</a></div></div>
<div class="ttc" id="avisynth__c_8h_html_ab87f55bd0280d90925050a4188c14ab5"><div class="ttname"><a href="avisynth__c_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a></div><div class="ttdeci">const char * s</div><div class="ttdef"><b>Definition:</b> <a href="avisynth__c_8h_source.html#l00768">avisynth_c.h:768</a></div></div>
<div class="ttc" id="structAVIOContext_html"><div class="ttname"><a href="structAVIOContext.html">AVIOContext</a></div><div class="ttdoc">Bytestream IO Context. </div><div class="ttdef"><b>Definition:</b> <a href="avio_8h_source.html#l00147">avio.h:147</a></div></div>
<div class="ttc" id="ffmpeg__vaapi_8c_html_a0fd12851a78b80080e277db30411728d"><div class="ttname"><a href="ffmpeg__vaapi_8c.html#a0fd12851a78b80080e277db30411728d">codec_id</a></div><div class="ttdeci">enum AVCodecID codec_id</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__vaapi_8c_source.html#l00149">ffmpeg_vaapi.c:149</a></div></div>
<div class="ttc" id="ffserver_8c_html_a2e3e6e730434c763670806f4560be1c0"><div class="ttname"><a href="ffserver_8c.html#a2e3e6e730434c763670806f4560be1c0">http_log</a></div><div class="ttdeci">static void http_log(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00423">ffserver.c:423</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a346baa4f155cbd05c492bede2e01919f"><div class="ttname"><a href="structFFServerConfig.html#a346baa4f155cbd05c492bede2e01919f">FFServerConfig::http_addr</a></div><div class="ttdeci">struct sockaddr_in http_addr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00127">ffserver_config.h:127</a></div></div>
<div class="ttc" id="rtpproto_8c_html_a359c5834d17144c08ff0b65243778571"><div class="ttname"><a href="rtpproto_8c.html#a359c5834d17144c08ff0b65243778571">ff_rtp_get_local_rtp_port</a></div><div class="ttdeci">int ff_rtp_get_local_rtp_port(URLContext *h)</div><div class="ttdoc">Return the local rtp port used by the RTP connection. </div><div class="ttdef"><b>Definition:</b> <a href="rtpproto_8c_source.html#l00628">rtpproto.c:628</a></div></div>
<div class="ttc" id="vf__vaguedenoiser_8c_html_a119184041ca9d38a2ef373e1227323f9"><div class="ttname"><a href="vf__vaguedenoiser_8c.html#a119184041ca9d38a2ef373e1227323f9">copy</a></div><div class="ttdeci">static void copy(const float *p1, float *p2, const int length)</div><div class="ttdef"><b>Definition:</b> <a href="vf__vaguedenoiser_8c_source.html#l00183">vf_vaguedenoiser.c:183</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0e3060440dfe4ce039d413f80f55541d"><div class="ttname"><a href="ffserver_8c.html#a0e3060440dfe4ce039d413f80f55541d">rtsp_reply_error</a></div><div class="ttdeci">static void rtsp_reply_error(HTTPContext *c, enum RTSPStatusCode error_number)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02907">ffserver.c:2907</a></div></div>
<div class="ttc" id="twinvq__data_8h_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="twinvq__data_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="structHTTPContext_html_a38c9f77110165c3599dba255c7dca51e"><div class="ttname"><a href="structHTTPContext.html#a38c9f77110165c3599dba255c7dca51e">HTTPContext::chunked_encoding</a></div><div class="ttdeci">int chunked_encoding</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00135">ffserver.c:135</a></div></div>
<div class="ttc" id="rtsp_8h_html_a7d32a74979e7e6f60215f11789b3e02e"><div class="ttname"><a href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02e">RTSPLowerTransport</a></div><div class="ttdeci">RTSPLowerTransport</div><div class="ttdoc">Network layer over which RTP/etc packet data will be transported. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00037">rtsp.h:37</a></div></div>
<div class="ttc" id="group__lavc__encoding_html_ga9f820c481615c3a02d0407bac0bdbf25"><div class="ttname"><a href="group__lavc__encoding.html#ga9f820c481615c3a02d0407bac0bdbf25">avcodec_find_encoder</a></div><div class="ttdeci">AVCodec * avcodec_find_encoder(enum AVCodecID id)</div><div class="ttdoc">Find a registered encoder with a matching codec ID. </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l03110">utils.c:3110</a></div></div>
<div class="ttc" id="ffserver_8c_html_abe8f2ce62bfb5e7a38d71406625c1dd0"><div class="ttname"><a href="ffserver_8c.html#abe8f2ce62bfb5e7a38d71406625c1dd0">http_av_log</a></div><div class="ttdeci">static void http_av_log(void *ptr, int level, const char *fmt, va_list vargs)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00431">ffserver.c:431</a></div></div>
<div class="ttc" id="structHTTPContext_html_a3e8cbfa43c05357d186ee2130db57e37"><div class="ttname"><a href="structHTTPContext.html#a3e8cbfa43c05357d186ee2130db57e37">HTTPContext::packet_stream_index</a></div><div class="ttdeci">int packet_stream_index</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00171">ffserver.c:171</a></div></div>
<div class="ttc" id="structAVDictionaryEntry_html"><div class="ttname"><a href="structAVDictionaryEntry.html">AVDictionaryEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00085">dict.h:85</a></div></div>
<div class="ttc" id="vp9dsp__template_8c_html_a5e36941b3d856737e81516acd45edc50"><div class="ttname"><a href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a></div><div class="ttdeci">h</div><div class="ttdef"><b>Definition:</b> <a href="vp9dsp__template_8c_source.html#l02038">vp9dsp_template.c:2038</a></div></div>
<div class="ttc" id="avio_8h_html_a8faed62ce72e7411cbea2356494af8ce"><div class="ttname"><a href="avio_8h.html#a8faed62ce72e7411cbea2356494af8ce">avio_close_dyn_buf</a></div><div class="ttdeci">int avio_close_dyn_buf(AVIOContext *s, uint8_t **pbuffer)</div><div class="ttdoc">Return the written size and a pointer to the buffer. </div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l01280">aviobuf.c:1280</a></div></div>
<div class="ttc" id="structFFServerStream_html_af3418f7b448566b89bd4945c00027a2a"><div class="ttname"><a href="structFFServerStream.html#af3418f7b448566b89bd4945c00027a2a">FFServerStream::acl</a></div><div class="ttdeci">FFServerIPAddressACL * acl</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00079">ffserver_config.h:79</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a6d04569e9694af1afdab0a83cbf29438"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a6d04569e9694af1afdab0a83cbf29438">RTSP_STATUS_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00046">rtspcodes.h:46</a></div></div>
<div class="ttc" id="structDataRateData_html_a84b295eacc9555f207efda87873cd295"><div class="ttname"><a href="structDataRateData.html#a84b295eacc9555f207efda87873cd295">DataRateData::time2</a></div><div class="ttdeci">int64_t time2</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00122">ffserver.c:122</a></div></div>
<div class="ttc" id="ffserver_8c_html_ab2aa1638f0a0799f8a4a1890a264bd44"><div class="ttname"><a href="ffserver_8c.html#ab2aa1638f0a0799f8a4a1890a264bd44">print_stream_params</a></div><div class="ttdeci">static void print_stream_params(AVIOContext *pb, FFServerStream *stream)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01878">ffserver.c:1878</a></div></div>
<div class="ttc" id="group__lavf__encoding_html_gaa85cc1774f18f306cd20a40fc50d0b36"><div class="ttname"><a href="group__lavf__encoding.html#gaa85cc1774f18f306cd20a40fc50d0b36">av_write_frame</a></div><div class="ttdeci">int av_write_frame(AVFormatContext *s, AVPacket *pkt)</div><div class="ttdoc">Write a packet to an output media file. </div><div class="ttdef"><b>Definition:</b> <a href="mux_8c_source.html#l00920">mux.c:920</a></div></div>
<div class="ttc" id="ffserver_8c_html_a2743a60f42ba34d44cc893daad0d7cb4"><div class="ttname"><a href="ffserver_8c.html#a2743a60f42ba34d44cc893daad0d7cb4">prepare_sdp_description</a></div><div class="ttdeci">static int prepare_sdp_description(FFServerStream *stream, uint8_t **pbuffer, struct in_addr my_ip)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03002">ffserver.c:3002</a></div></div>
<div class="ttc" id="avisynth__c_8h_html_a868274bcce53dba81808c75d008593b4"><div class="ttname"><a href="avisynth__c_8h.html#a868274bcce53dba81808c75d008593b4">fmt</a></div><div class="ttdeci">const char * fmt</div><div class="ttdef"><b>Definition:</b> <a href="avisynth__c_8h_source.html#l00769">avisynth_c.h:769</a></div></div>
<div class="ttc" id="ffserver_8c_html_ab36ef016e24afdb7395f67e6527ca80e"><div class="ttname"><a href="ffserver_8c.html#ab36ef016e24afdb7395f67e6527ca80e">build_file_streams</a></div><div class="ttdeci">static void build_file_streams(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03633">ffserver.c:3633</a></div></div>
<div class="ttc" id="structFFServerConfig_html_ad17ba4b42d4a451f2e08042fb57b1ce4"><div class="ttname"><a href="structFFServerConfig.html#ad17ba4b42d4a451f2e08042fb57b1ce4">FFServerConfig::nb_max_connections</a></div><div class="ttdeci">unsigned int nb_max_connections</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00122">ffserver_config.h:122</a></div></div>
<div class="ttc" id="group__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdoc">Something somehow does not look correct. </div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00182">log.h:182</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a6b53fda85ad61baa345edbd96cb8a33c"><div class="ttname"><a href="structAVCodecContext.html#a6b53fda85ad61baa345edbd96cb8a33c">AVCodecContext::bit_rate</a></div><div class="ttdeci">int64_t bit_rate</div><div class="ttdoc">the average bitrate </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01751">avcodec.h:1751</a></div></div>
<div class="ttc" id="avr32_2intreadwrite_8h_html_ad3c990d78933aafd8096a21f01c19051"><div class="ttname"><a href="avr32_2intreadwrite_8h.html#ad3c990d78933aafd8096a21f01c19051">AV_RB64</a></div><div class="ttdeci">#define AV_RB64</div><div class="ttdef"><b>Definition:</b> <a href="avr32_2intreadwrite_8h_source.html#l00164">intreadwrite.h:164</a></div></div>
<div class="ttc" id="parseutils_8c_html_a98590feafe82e074f61f38c8faaa4cef"><div class="ttname"><a href="parseutils_8c.html#a98590feafe82e074f61f38c8faaa4cef">av_parse_time</a></div><div class="ttdeci">int av_parse_time(int64_t *timeval, const char *timestr, int duration)</div><div class="ttdoc">Parse timestr and return in *time a corresponding number of microseconds. </div><div class="ttdef"><b>Definition:</b> <a href="parseutils_8c_source.html#l00561">parseutils.c:561</a></div></div>
<div class="ttc" id="avio_8c_html_ac1d123f423ddc77939136919c75f44ba"><div class="ttname"><a href="avio_8c.html#ac1d123f423ddc77939136919c75f44ba">ffurl_write</a></div><div class="ttdeci">int ffurl_write(URLContext *h, const unsigned char *buf, int size)</div><div class="ttdoc">Write size bytes from buf to the resource accessed by h. </div><div class="ttdef"><b>Definition:</b> <a href="avio_8c_source.html#l00421">avio.c:421</a></div></div>
<div class="ttc" id="group__lavu__string_html_ga47e14424edfb96d3f6bf0fca96a76fe5"><div class="ttname"><a href="group__lavu__string.html#ga47e14424edfb96d3f6bf0fca96a76fe5">av_stristr</a></div><div class="ttdeci">char * av_stristr(const char *s1, const char *s2)</div><div class="ttdoc">Locate the first case-independent occurrence in the string haystack of the string needle...</div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00056">avstring.c:56</a></div></div>
<div class="ttc" id="structHTTPContext_html_a08ca1c044a6cc47eb3b6965e4ce46348"><div class="ttname"><a href="structHTTPContext.html#a08ca1c044a6cc47eb3b6965e4ce46348">HTTPContext::next</a></div><div class="ttdeci">struct HTTPContext * next</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00137">ffserver.c:137</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a826c9759d695c18cb6ebadc6a9f0154f"><div class="ttname"><a href="ffserver__config_8h.html#a826c9759d695c18cb6ebadc6a9f0154f">FFM_PACKET_SIZE</a></div><div class="ttdeci">#define FFM_PACKET_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00024">ffserver_config.h:24</a></div></div>
<div class="ttc" id="structHTTPContext_html"><div class="ttname"><a href="structHTTPContext.html">HTTPContext</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00126">ffserver.c:126</a></div></div>
<div class="ttc" id="ffserver_8c_html_aae68dc67f55217c97f8adcbfa6af4f0b"><div class="ttname"><a href="ffserver_8c.html#aae68dc67f55217c97f8adcbfa6af4f0b">config</a></div><div class="ttdeci">static FFServerConfig config</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00193">ffserver.c:193</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811">HTTPState</a></div><div class="ttdeci">HTTPState</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00076">ffserver.c:76</a></div></div>
<div class="ttc" id="ffserver_8c_html_a906e7021dcb77e221e09b4dcf49a3eb9"><div class="ttname"><a href="ffserver_8c.html#a906e7021dcb77e221e09b4dcf49a3eb9">rtsp_reply_header</a></div><div class="ttdeci">static void rtsp_reply_header(HTTPContext *c, enum RTSPStatusCode error_number)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02886">ffserver.c:2886</a></div></div>
<div class="ttc" id="ffserver_8c_html_a10f6aa3b91e89461b460411d0cf0d433"><div class="ttname"><a href="ffserver_8c.html#a10f6aa3b91e89461b460411d0cf0d433">cur_time</a></div><div class="ttdeci">static int64_t cur_time</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00252">ffserver.c:252</a></div></div>
<div class="ttc" id="ff__glob_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="ff__glob_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="ff__glob_8c_source.html#l00222">ff_glob.c:222</a></div></div>
<div class="ttc" id="ffserver_8c_html_afb075e5c5d72162a0be32aaab4383b74"><div class="ttname"><a href="ffserver_8c.html#afb075e5c5d72162a0be32aaab4383b74">rtsp_cmd_play</a></div><div class="ttdeci">static void rtsp_cmd_play(HTTPContext *c, const char *url, RTSPMessageHeader *h)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03315">ffserver.c:3315</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a1f39d6b2fe7dfdd5ebd3f67dd9a688e1"><div class="ttname"><a href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1">FFServerIPAddressAction</a></div><div class="ttdeci">FFServerIPAddressAction</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00039">ffserver_config.h:39</a></div></div>
<div class="ttc" id="structHTTPContext_html_a3b43d79122213be60c9f67bc1c72fcb3"><div class="ttname"><a href="structHTTPContext.html#a3b43d79122213be60c9f67bc1c72fcb3">HTTPContext::fmt_in</a></div><div class="ttdeci">AVFormatContext * fmt_in</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00143">ffserver.c:143</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a9f76f2475ef24ff4c9771dd53072d040"><div class="ttname"><a href="structAVCodecParameters.html#a9f76f2475ef24ff4c9771dd53072d040">AVCodecParameters::codec_id</a></div><div class="ttdeci">enum AVCodecID codec_id</div><div class="ttdoc">Specific type of the encoded data (the codec used). </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l03999">avcodec.h:3999</a></div></div>
<div class="ttc" id="structHTTPContext_html_a98538ca951ec149884b3bca8a34d46ea"><div class="ttname"><a href="structHTTPContext.html#a98538ca951ec149884b3bca8a34d46ea">HTTPContext::protocol</a></div><div class="ttdeci">char protocol[16]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00164">ffserver.c:164</a></div></div>
<div class="ttc" id="structHTTPContext_html_a78c481f94bb467e94b818f13a6e893e5"><div class="ttname"><a href="structHTTPContext.html#a78c481f94bb467e94b818f13a6e893e5">HTTPContext::packet_buffer_end</a></div><div class="ttdeci">uint8_t * packet_buffer_end</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00188">ffserver.c:188</a></div></div>
<div class="ttc" id="ffserver_8c_html_a6bbb8cc55551404552deb7e6d2ca7ad1"><div class="ttname"><a href="ffserver_8c.html#a6bbb8cc55551404552deb7e6d2ca7ad1">validate_acl_list</a></div><div class="ttdeci">static int validate_acl_list(FFServerIPAddressACL *in_acl, HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01356">ffserver.c:1356</a></div></div>
<div class="ttc" id="structAVRational_html_ae9a98c10a301c5e937095105b6f0fdb9"><div class="ttname"><a href="structAVRational.html#ae9a98c10a301c5e937095105b6f0fdb9">AVRational::num</a></div><div class="ttdeci">int num</div><div class="ttdoc">Numerator. </div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00059">rational.h:59</a></div></div>
<div class="ttc" id="structAVStream_html_a6ca823054632821e085377f7d371a2d1"><div class="ttname"><a href="structAVStream.html#a6ca823054632821e085377f7d371a2d1">AVStream::index</a></div><div class="ttdeci">int index</div><div class="ttdoc">stream index in AVFormatContext </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00890">avformat.h:890</a></div></div>
<div class="ttc" id="avio_8h_html_a21e61cb486bd1588eb7f775998cf8c77"><div class="ttname"><a href="avio_8h.html#a21e61cb486bd1588eb7f775998cf8c77">AVIO_FLAG_READ</a></div><div class="ttdeci">#define AVIO_FLAG_READ</div><div class="ttdoc">read-only </div><div class="ttdef"><b>Definition:</b> <a href="avio_8h_source.html#l00606">avio.h:606</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0c6e9b96e64d7424a4c1ec2b78c1294f"><div class="ttname"><a href="ffserver_8c.html#a0c6e9b96e64d7424a4c1ec2b78c1294f">rtsp_parse_request</a></div><div class="ttdeci">static int rtsp_parse_request(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02913">ffserver.c:2913</a></div></div>
<div class="ttc" id="group__lavu__string_html_ga96490acc8dd8d85f2ee43bc605661ffa"><div class="ttname"><a href="group__lavu__string.html#ga96490acc8dd8d85f2ee43bc605661ffa">av_isspace</a></div><div class="ttdeci">static av_const int av_isspace(int c)</div><div class="ttdoc">Locale-independent conversion of ASCII isspace. </div><div class="ttdef"><b>Definition:</b> <a href="avstring_8h_source.html#l00222">avstring.h:222</a></div></div>
<div class="ttc" id="avio_8h_html_a5c9308f296545a8f3b7687d277a6dabc"><div class="ttname"><a href="avio_8h.html#a5c9308f296545a8f3b7687d277a6dabc">AVIO_FLAG_WRITE</a></div><div class="ttdeci">#define AVIO_FLAG_WRITE</div><div class="ttdoc">write-only </div><div class="ttdef"><b>Definition:</b> <a href="avio_8h_source.html#l00607">avio.h:607</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a5252d34fbce300228d4dbda19a8c3293"><div class="ttname"><a href="structAVCodecContext.html#a5252d34fbce300228d4dbda19a8c3293">AVCodecContext::sample_aspect_ratio</a></div><div class="ttdeci">AVRational sample_aspect_ratio</div><div class="ttdoc">sample aspect ratio (0 if unknown) That is the width of a pixel divided by the height of the pixel...</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02097">avcodec.h:2097</a></div></div>
<div class="ttc" id="structFFServerStream_html_aaf39d9bebde7e936e4dd23428d6581c7"><div class="ttname"><a href="structFFServerStream.html#aaf39d9bebde7e936e4dd23428d6581c7">FFServerStream::ifmt</a></div><div class="ttdeci">AVInputFormat * ifmt</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00077">ffserver_config.h:77</a></div></div>
<div class="ttc" id="rtp_8c_html_a550d0fd0475cc25c2e1fec3e15acaffb"><div class="ttname"><a href="rtp_8c.html#a550d0fd0475cc25c2e1fec3e15acaffb">codec_type</a></div><div class="ttdeci">enum AVMediaType codec_type</div><div class="ttdef"><b>Definition:</b> <a href="rtp_8c_source.html#l00037">rtp.c:37</a></div></div>
<div class="ttc" id="structFFServerStream_html_af772429e4e2d59bd252da47e8783de57"><div class="ttname"><a href="structFFServerStream.html#af772429e4e2d59bd252da47e8783de57">FFServerStream::single_frame</a></div><div class="ttdeci">char single_frame</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00102">ffserver_config.h:102</a></div></div>
<div class="ttc" id="cmdutils_8c_html_a976c7dc9afeb4b0f6ec009a7a084e701"><div class="ttname"><a href="cmdutils_8c.html#a976c7dc9afeb4b0f6ec009a7a084e701">show_banner</a></div><div class="ttdeci">void show_banner(int argc, char **argv, const OptionDef *options)</div><div class="ttdoc">Print the program banner to stderr. </div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8c_source.html#l01248">cmdutils.c:1248</a></div></div>
<div class="ttc" id="group__lavu__string_html_gaea8a7c8c2832c11e753fbfc0d1464970"><div class="ttname"><a href="group__lavu__string.html#gaea8a7c8c2832c11e753fbfc0d1464970">av_strncasecmp</a></div><div class="ttdeci">int av_strncasecmp(const char *a, const char *b, size_t n)</div><div class="ttdoc">Locale-independent case-insensitive compare. </div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00223">avstring.c:223</a></div></div>
<div class="ttc" id="structHTTPContext_html_a1cec3e1451132c3f49007d5808abc353"><div class="ttname"><a href="structHTTPContext.html#a1cec3e1451132c3f49007d5808abc353">HTTPContext::timeout</a></div><div class="ttdeci">int64_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00131">ffserver.c:131</a></div></div>
<div class="ttc" id="time_8h_html"><div class="ttname"><a href="time_8h.html">time.h</a></div></div>
<div class="ttc" id="rtsp_8h_html_a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7"><div class="ttname"><a href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02eab31d84d023a1ff6f491af197a446bba7">RTSP_LOWER_TRANSPORT_UDP</a></div><div class="ttdoc">UDP/unicast. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00038">rtsp.h:38</a></div></div>
<div class="ttc" id="structOptionDef_html"><div class="ttname"><a href="structOptionDef.html">OptionDef</a></div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8h_source.html#l00165">cmdutils.h:165</a></div></div>
<div class="ttc" id="group__lavu__dict_html_ga59a6372b124b306e3a2233723c5cdc78"><div class="ttname"><a href="group__lavu__dict.html#ga59a6372b124b306e3a2233723c5cdc78">av_dict_copy</a></div><div class="ttdeci">int av_dict_copy(AVDictionary **dst, const AVDictionary *src, int flags)</div><div class="ttdoc">Copy entries from one AVDictionary struct into another. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00217">dict.c:217</a></div></div>
<div class="ttc" id="structFFServerStream_html_af1c8eb978faf3a104d136e643fb59c68"><div class="ttname"><a href="structFFServerStream.html#af1c8eb978faf3a104d136e643fb59c68">FFServerStream::truncate</a></div><div class="ttdeci">int truncate</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00108">ffserver_config.h:108</a></div></div>
<div class="ttc" id="structHTTPContext_html_a44f67ccad041486cd3416d8b9e7d27c3"><div class="ttname"><a href="structHTTPContext.html#a44f67ccad041486cd3416d8b9e7d27c3">HTTPContext::poll_entry</a></div><div class="ttdeci">struct pollfd * poll_entry</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00130">ffserver.c:130</a></div></div>
<div class="ttc" id="structFFServerStream_html_a629dace7ce6d3a78e58e17ab04ad6894"><div class="ttname"><a href="structFFServerStream.html#a629dace7ce6d3a78e58e17ab04ad6894">FFServerStream::child_argv</a></div><div class="ttdeci">char ** child_argv</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00091">ffserver_config.h:91</a></div></div>
<div class="ttc" id="structAVStream_html_a61b61b0d009be377ebcfdc30ea053d27"><div class="ttname"><a href="structAVStream.html#a61b61b0d009be377ebcfdc30ea053d27">AVStream::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00904">avformat.h:904</a></div></div>
<div class="ttc" id="structAVFormatContext_html_aaf1ef435f30fce3cd0872467267512d0"><div class="ttname"><a href="structAVFormatContext.html#aaf1ef435f30fce3cd0872467267512d0">AVFormatContext::filename</a></div><div class="ttdeci">char filename[OUTPUT_FILENAME_LEN]</div><div class="ttdoc">input or output filename </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01414">avformat.h:1414</a></div></div>
<div class="ttc" id="structFFServerStream_html_a0de593e16d5b06909c196ab0e0217940"><div class="ttname"><a href="structFFServerStream.html#a0de593e16d5b06909c196ab0e0217940">FFServerStream::bytes_served</a></div><div class="ttdeci">int64_t bytes_served</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00110">ffserver_config.h:110</a></div></div>
<div class="ttc" id="ffserver_8c_html_a86b0b3c5097befa080e58ccbafe289c3"><div class="ttname"><a href="ffserver_8c.html#a86b0b3c5097befa080e58ccbafe289c3">show_help_default</a></div><div class="ttdeci">void show_help_default(const char *opt, const char *arg)</div><div class="ttdoc">Per-fftool specific help handler. </div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03942">ffserver.c:3942</a></div></div>
<div class="ttc" id="structAVInputFormat_html"><div class="ttname"><a href="structAVInputFormat.html">AVInputFormat</a></div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00659">avformat.h:659</a></div></div>
<div class="ttc" id="avstring_8h_html"><div class="ttname"><a href="avstring_8h.html">avstring.h</a></div></div>
<div class="ttc" id="demuxing__decoding_8c_html_a3d4c6562f0b27cf0cacbbea5c038c090"><div class="ttname"><a href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a></div><div class="ttdeci">static AVPacket pkt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00054">demuxing_decoding.c:54</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1">RedirType</a></div><div class="ttdeci">RedirType</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01417">ffserver.c:1417</a></div></div>
<div class="ttc" id="ffplay_8c_html_a765905fd1694893cf8523999e58c88c6"><div class="ttname"><a href="ffplay_8c.html#a765905fd1694893cf8523999e58c88c6">audio_codec_name</a></div><div class="ttdeci">static const char * audio_codec_name</div><div class="ttdef"><b>Definition:</b> <a href="ffplay_8c_source.html#l00341">ffplay.c:341</a></div></div>
<div class="ttc" id="tests_2checkasm_2vp8dsp_8c_html_a522f8e5cb2658746479ebd5b805263cf"><div class="ttname"><a href="tests_2checkasm_2vp8dsp_8c.html#a522f8e5cb2658746479ebd5b805263cf">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="tests_2checkasm_2vp8dsp_8c_source.html#l00254">vp8dsp.c:254</a></div></div>
<div class="ttc" id="structAVCodec_html"><div class="ttname"><a href="structAVCodec.html">AVCodec</a></div><div class="ttdoc">AVCodec. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l03619">avcodec.h:3619</a></div></div>
<div class="ttc" id="avio_8h_html_adb5259ad07633518173eaa47fe6575e2"><div class="ttname"><a href="avio_8h.html#adb5259ad07633518173eaa47fe6575e2">avio_open_dyn_buf</a></div><div class="ttdeci">int avio_open_dyn_buf(AVIOContext **s)</div><div class="ttdoc">Open a write only memory stream. </div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l01268">aviobuf.c:1268</a></div></div>
<div class="ttc" id="structAVCodecParameters_html"><div class="ttname"><a href="structAVCodecParameters.html">AVCodecParameters</a></div><div class="ttdoc">This struct describes the properties of an encoded stream. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l03991">avcodec.h:3991</a></div></div>
<div class="ttc" id="structRTSPTransportField_html_ac2fe3fdef4ee13a5a9d0c9764c3b757f"><div class="ttname"><a href="structRTSPTransportField.html#ac2fe3fdef4ee13a5a9d0c9764c3b757f">RTSPTransportField::lower_transport</a></div><div class="ttdeci">enum RTSPLowerTransport lower_transport</div><div class="ttdoc">network layer transport protocol; e.g. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00121">rtsp.h:121</a></div></div>
<div class="ttc" id="structRTSPMessageHeader_html"><div class="ttname"><a href="structRTSPMessageHeader.html">RTSPMessageHeader</a></div><div class="ttdoc">This describes the server response to each RTSP command. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00127">rtsp.h:127</a></div></div>
<div class="ttc" id="structAVCodecContext_html_ab7bfeb9fa5840aac090e2b0bd0ef7589"><div class="ttname"><a href="structAVCodecContext.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">AVCodecContext::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdoc">This is the fundamental unit of time (in seconds) in terms of which frame timestamps are represented...</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01823">avcodec.h:1823</a></div></div>
<div class="ttc" id="structRTSPMessageHeader_html_abde68f4d04f3e06be52af6250bde02f1"><div class="ttname"><a href="structRTSPMessageHeader.html#abde68f4d04f3e06be52af6250bde02f1">RTSPMessageHeader::transports</a></div><div class="ttdeci">RTSPTransportField transports[RTSP_MAX_TRANSPORTS]</div><div class="ttdoc">describes the complete &quot;Transport:&quot; line of the server in response to a SETUP RTSP command by the cli...</div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00142">rtsp.h:142</a></div></div>
<div class="ttc" id="structFFServerStream_html_ad9c6e677eb928a023237a1ce370ab939"><div class="ttname"><a href="structFFServerStream.html#ad9c6e677eb928a023237a1ce370ab939">FFServerStream::next</a></div><div class="ttdeci">struct FFServerStream * next</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00092">ffserver_config.h:92</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a40e47d5384031d895b3c0b4c5ddb95c6">RTSPSTATE_SEND_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00087">ffserver.c:87</a></div></div>
<div class="ttc" id="ffserver_8c_html_adb047c8ef284577de88f3a64fe7638e0"><div class="ttname"><a href="ffserver_8c.html#adb047c8ef284577de88f3a64fe7638e0">program_birth_year</a></div><div class="ttdeci">const int program_birth_year</div><div class="ttdoc">program birth year, defined by the program for show_banner() </div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00072">ffserver.c:72</a></div></div>
<div class="ttc" id="structAVFormatContext_html"><div class="ttname"><a href="structAVFormatContext.html">AVFormatContext</a></div><div class="ttdoc">Format I/O context. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01338">avformat.h:1338</a></div></div>
<div class="ttc" id="ffserver_8c_html_ad09de9db7e8c9fd03d27c7cd8b0d9506"><div class="ttname"><a href="ffserver_8c.html#ad09de9db7e8c9fd03d27c7cd8b0d9506">IOBUFFER_INIT_SIZE</a></div><div class="ttdeci">#define IOBUFFER_INIT_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00107">ffserver.c:107</a></div></div>
<div class="ttc" id="mathematics_8h_html"><div class="ttname"><a href="mathematics_8h.html">mathematics.h</a></div></div>
<div class="ttc" id="avio_8c_html_aa4006f7b803e4d104231734a23b35ab7"><div class="ttname"><a href="avio_8c.html#aa4006f7b803e4d104231734a23b35ab7">avio_check</a></div><div class="ttdeci">int avio_check(const char *url, int flags)</div><div class="ttdoc">Return AVIO_FLAG_* access flags corresponding to the access permissions of the resource in url...</div><div class="ttdef"><b>Definition:</b> <a href="avio_8c_source.html#l00480">avio.c:480</a></div></div>
<div class="ttc" id="ffserver__config_8c_html_a823cf44c706cfd104ba7339272759987"><div class="ttname"><a href="ffserver__config_8c.html#a823cf44c706cfd104ba7339272759987">ffserver_free_child_args</a></div><div class="ttdeci">void ffserver_free_child_args(void *argsp)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8c_source.html#l01313">ffserver_config.c:1313</a></div></div>
<div class="ttc" id="avassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdoc">assert() equivalent, that is always enabled. </div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="dict_8h_html"><div class="ttname"><a href="dict_8h.html">dict.h</a></div><div class="ttdoc">Public dictionary API. </div></div>
<div class="ttc" id="ffserver_8c_html_a672971a0dbaa82d6938a25fbf3109481"><div class="ttname"><a href="ffserver_8c.html#a672971a0dbaa82d6938a25fbf3109481">free_acl_list</a></div><div class="ttdeci">static void free_acl_list(FFServerIPAddressACL *in_acl)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01344">ffserver.c:1344</a></div></div>
<div class="ttc" id="seek_8c_html_a5819dbc2d305e99e930c734a0d28bc3b"><div class="ttname"><a href="seek_8c.html#a5819dbc2d305e99e930c734a0d28bc3b">buffer</a></div><div class="ttdeci">static char buffer[20]</div><div class="ttdef"><b>Definition:</b> <a href="seek_8c_source.html#l00032">seek.c:32</a></div></div>
<div class="ttc" id="structFFServerStream_html_a3b9320d61bdf49134f40777c4dbae7d3"><div class="ttname"><a href="structFFServerStream.html#a3b9320d61bdf49134f40777c4dbae7d3">FFServerStream::fmt</a></div><div class="ttdeci">AVOutputFormat * fmt</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00078">ffserver_config.h:78</a></div></div>
<div class="ttc" id="ffserver_8c_html_a5df0188dbb90aa694f85e5440113559a"><div class="ttname"><a href="ffserver_8c.html#a5df0188dbb90aa694f85e5440113559a">http_vlog</a></div><div class="ttdeci">static void http_vlog(const char *fmt, va_list vargs)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00403">ffserver.c:403</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a17d75293264ad1a69ac2a1475629abe3"><div class="ttname"><a href="structLayeredAVStream.html#a17d75293264ad1a69ac2a1475629abe3">LayeredAVStream::sample_aspect_ratio</a></div><div class="ttdeci">AVRational sample_aspect_ratio</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00066">ffserver_config.h:66</a></div></div>
<div class="ttc" id="audio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="ffprobe_8c_html_ad5b72470d5d57d39c02421b54a92c065"><div class="ttname"><a href="ffprobe_8c.html#ad5b72470d5d57d39c02421b54a92c065">nb_streams</a></div><div class="ttdeci">static int nb_streams</div><div class="ttdef"><b>Definition:</b> <a href="ffprobe_8c_source.html#l00255">ffprobe.c:255</a></div></div>
<div class="ttc" id="random__seed_8h_html"><div class="ttname"><a href="random__seed_8h.html">random_seed.h</a></div></div>
<div class="ttc" id="structRTSPMessageHeader_html_a5df2bc55e4aba07dafa9c562f5824a72"><div class="ttname"><a href="structRTSPMessageHeader.html#a5df2bc55e4aba07dafa9c562f5824a72">RTSPMessageHeader::session_id</a></div><div class="ttdeci">char session_id[512]</div><div class="ttdoc">the &quot;Session:&quot; field. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00148">rtsp.h:148</a></div></div>
<div class="ttc" id="tableprint__vlc_8h_html_ae97db1f58b6b1515ed57a83bea3dd572"><div class="ttname"><a href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a></div><div class="ttdeci">#define av_malloc(s)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00031">tableprint_vlc.h:31</a></div></div>
<div class="ttc" id="structFFServerConfig_html_ad98d9708e0015939419e1581bd10367c"><div class="ttname"><a href="structFFServerConfig.html#ad98d9708e0015939419e1581bd10367c">FFServerConfig::max_bandwidth</a></div><div class="ttdeci">uint64_t max_bandwidth</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00123">ffserver_config.h:123</a></div></div>
<div class="ttc" id="group__lavu__misc_html_gga9a84bba4713dfced21a1a56163be1f48ae3df4d77c6908fb626293c2fed215d52"><div class="ttname"><a href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ae3df4d77c6908fb626293c2fed215d52">AVMEDIA_TYPE_DATA</a></div><div class="ttdoc">Opaque data information usually continuous. </div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00203">avutil.h:203</a></div></div>
<div class="ttc" id="ffserver_8c_html_a914a7920b526fd32fa0a982ab9fc1ce5"><div class="ttname"><a href="ffserver_8c.html#a914a7920b526fd32fa0a982ab9fc1ce5">opt_debug</a></div><div class="ttdeci">static void opt_debug(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03936">ffserver.c:3936</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a51639f88aef9f4f283f538a0c033fbb8"><div class="ttname"><a href="structAVCodecParameters.html#a51639f88aef9f4f283f538a0c033fbb8">AVCodecParameters::width</a></div><div class="ttdeci">int width</div><div class="ttdoc">Video only. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l04065">avcodec.h:4065</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a57d163260c75a12ec1ab322a6ac5d13f"><div class="ttname"><a href="structLayeredAVStream.html#a57d163260c75a12ec1ab322a6ac5d13f">LayeredAVStream::codecpar</a></div><div class="ttdeci">AVCodecParameters * codecpar</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00062">ffserver_config.h:62</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7ab43f886657fc2b7f9a1838fb3f4d6d">HTTPSTATE_SEND_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00080">ffserver.c:80</a></div></div>
<div class="ttc" id="opt_8h_html"><div class="ttname"><a href="opt_8h.html">opt.h</a></div><div class="ttdoc">AVOptions. </div></div>
<div class="ttc" id="structHTTPContext_html_a2da52bec5acd23cacafe3462eb2a235d"><div class="ttname"><a href="structHTTPContext.html#a2da52bec5acd23cacafe3462eb2a235d">HTTPContext::packet_buffer_ptr</a></div><div class="ttdeci">uint8_t * packet_buffer_ptr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00188">ffserver.c:188</a></div></div>
<div class="ttc" id="cmdutils_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="cmdutils_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8h_source.html#l00168">cmdutils.h:168</a></div></div>
<div class="ttc" id="group__lavc__core_html_ga647755ab2252e93221bb345f3d5e414f"><div class="ttname"><a href="group__lavc__core.html#ga647755ab2252e93221bb345f3d5e414f">avcodec_parameters_alloc</a></div><div class="ttdeci">AVCodecParameters * avcodec_parameters_alloc(void)</div><div class="ttdoc">Allocate a new AVCodecParameters and set its fields to default values (unknown/invalid/0). </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l04131">utils.c:4131</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a1d292ce4bc5b12234a9ab6529b5ae387"><div class="ttname"><a href="structFFServerConfig.html#a1d292ce4bc5b12234a9ab6529b5ae387">FFServerConfig::logfilename</a></div><div class="ttdeci">char logfilename[1024]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00126">ffserver_config.h:126</a></div></div>
<div class="ttc" id="ffserver_8c_html_ab82b7e387408431911358bfd3e068338"><div class="ttname"><a href="ffserver_8c.html#ab82b7e387408431911358bfd3e068338">compute_real_filename</a></div><div class="ttdeci">static void compute_real_filename(char *filename, int max_size)</div><div class="ttdoc">compute the real filename of a file by matching it without its extensions to all the stream&amp;#39;s filenam...</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01394">ffserver.c:1394</a></div></div>
<div class="ttc" id="ffserver_8c_html_a841ec705f392bc42857c9d6338eb8aed"><div class="ttname"><a href="ffserver_8c.html#a841ec705f392bc42857c9d6338eb8aed">nb_connections</a></div><div class="ttdeci">static unsigned int nb_connections</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00247">ffserver.c:247</a></div></div>
<div class="ttc" id="cmdutils_8h_html"><div class="ttname"><a href="cmdutils_8h.html">cmdutils.h</a></div></div>
<div class="ttc" id="structAVClass_html_ad763b2e6a0846234a165e74574a550bd"><div class="ttname"><a href="structAVClass.html#ad763b2e6a0846234a165e74574a550bd">AVClass::item_name</a></div><div class="ttdeci">const char *(* item_name)(void *ctx)</div><div class="ttdoc">A pointer to a function which returns the name of a context instance ctx associated with the class...</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00078">log.h:78</a></div></div>
<div class="ttc" id="structAVPacket_html_a622e758be29fd500aed0ffdc069550f7"><div class="ttname"><a href="structAVPacket.html#a622e758be29fd500aed0ffdc069550f7">AVPacket::duration</a></div><div class="ttdeci">int64_t duration</div><div class="ttdoc">Duration of this packet in AVStream-&gt;time_base units, 0 if unknown. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01629">avcodec.h:1629</a></div></div>
<div class="ttc" id="ffserver_8c_html_a01a73e823e0892841a4fd2f900b85688"><div class="ttname"><a href="ffserver_8c.html#a01a73e823e0892841a4fd2f900b85688">program_name</a></div><div class="ttdeci">const char program_name[]</div><div class="ttdoc">program name, defined by the program for show_version(). </div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00071">ffserver.c:71</a></div></div>
<div class="ttc" id="structHTTPContext_html_abd123bace785deeba87cb37922bb1f8f"><div class="ttname"><a href="structHTTPContext.html#abd123bace785deeba87cb37922bb1f8f">HTTPContext::rtp_ctx</a></div><div class="ttdeci">AVFormatContext * rtp_ctx[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00181">ffserver.c:181</a></div></div>
<div class="ttc" id="ffserver_8c_html_a544a9b399c7d51e7be4c5eb6617d133b"><div class="ttname"><a href="ffserver_8c.html#a544a9b399c7d51e7be4c5eb6617d133b">http_parse_request</a></div><div class="ttdeci">static int http_parse_request(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01427">ffserver.c:1427</a></div></div>
<div class="ttc" id="structAVStream_html_a6873ed62f196c24e8bf282609231786f"><div class="ttname"><a href="structAVStream.html#a6873ed62f196c24e8bf282609231786f">AVStream::id</a></div><div class="ttdeci">int id</div><div class="ttdoc">Format-specific stream ID. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00896">avformat.h:896</a></div></div>
<div class="ttc" id="avformat_8h_html_a69e2c8bc119c0245ff6092f9db4d12ae"><div class="ttname"><a href="avformat_8h.html#a69e2c8bc119c0245ff6092f9db4d12ae">AVFMT_FLAG_GENPTS</a></div><div class="ttdeci">#define AVFMT_FLAG_GENPTS</div><div class="ttdoc">Generate missing pts even if it requires parsing future frames. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01450">avformat.h:1450</a></div></div>
<div class="ttc" id="ffserver_8c_html_a1b57987e51dcc22329e90bb2750d07e9"><div class="ttname"><a href="ffserver_8c.html#a1b57987e51dcc22329e90bb2750d07e9">http_send_data</a></div><div class="ttdeci">static int http_send_data(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02536">ffserver.c:2536</a></div></div>
<div class="ttc" id="ffserver_8c_html_aa0b3b6e3b386d29dc34e9b843f568b3a"><div class="ttname"><a href="ffserver_8c.html#aa0b3b6e3b386d29dc34e9b843f568b3a">get_word</a></div><div class="ttdeci">static void get_word(char *buf, int buf_size, const char **pp)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01283">ffserver.c:1283</a></div></div>
<div class="ttc" id="ffserver_8c_html_aa4f848c169b0eb413afcdf35a1201af3"><div class="ttname"><a href="ffserver_8c.html#aa4f848c169b0eb413afcdf35a1201af3">SPACE_CHARS</a></div><div class="ttdeci">#define SPACE_CHARS</div></div>
<div class="ttc" id="group__lavf__core_html_gadcb0fd3e507d9b58fe78f61f8ad39827"><div class="ttname"><a href="group__lavf__core.html#gadcb0fd3e507d9b58fe78f61f8ad39827">avformat_new_stream</a></div><div class="ttdeci">AVStream * avformat_new_stream(AVFormatContext *s, const AVCodec *c)</div><div class="ttdoc">Add a new stream to a media file. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04235">utils.c:4235</a></div></div>
<div class="ttc" id="structAVFormatContext_html_acfefb6b6cf21e87a0dcbd1a547ba2348"><div class="ttname"><a href="structAVFormatContext.html#acfefb6b6cf21e87a0dcbd1a547ba2348">AVFormatContext::streams</a></div><div class="ttdeci">AVStream ** streams</div><div class="ttdoc">A list of all streams in the file. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01406">avformat.h:1406</a></div></div>
<div class="ttc" id="group__lavc__core_html_gac7b282f51540ca7a99416a3ba6ee0d16"><div class="ttname"><a href="group__lavc__core.html#gac7b282f51540ca7a99416a3ba6ee0d16">avcodec_parameters_to_context</a></div><div class="ttdeci">int avcodec_parameters_to_context(AVCodecContext *codec, const AVCodecParameters *par)</div><div class="ttdoc">Fill the codec context based on the values from the supplied codec parameters. </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l04227">utils.c:4227</a></div></div>
<div class="ttc" id="group__lavf__core_html_gac7a91abf2f59648d995894711f070f62"><div class="ttname"><a href="group__lavf__core.html#gac7a91abf2f59648d995894711f070f62">avformat_alloc_context</a></div><div class="ttdeci">AVFormatContext * avformat_alloc_context(void)</div><div class="ttdoc">Allocate an AVFormatContext. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2options_8c_source.html#l00132">options.c:132</a></div></div>
<div class="ttc" id="structFFServerStream_html_afb8e7ae4427e19fbf0e4fe310b447449"><div class="ttname"><a href="structFFServerStream.html#afb8e7ae4427e19fbf0e4fe310b447449">FFServerStream::feed_streams</a></div><div class="ttdeci">int feed_streams[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00086">ffserver_config.h:86</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953acf53b0a64148bfcea925a8cc411a9701"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953acf53b0a64148bfcea925a8cc411a9701">RTSP_STATUS_AGGREGATE</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00065">rtspcodes.h:65</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a8d2e8ac4f3ecaeac7af769b7e5c8281c"><div class="ttname"><a href="structLayeredAVStream.html#a8d2e8ac4f3ecaeac7af769b7e5c8281c">LayeredAVStream::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00061">ffserver_config.h:61</a></div></div>
<div class="ttc" id="avio__internal_8h_html"><div class="ttname"><a href="avio__internal_8h.html">avio_internal.h</a></div></div>
<div class="ttc" id="tests_2snowenc_8c_html_a64f9f90ece96c7bab4aee3deacf170e0"><div class="ttname"><a href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a></div><div class="ttdeci">#define height</div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a8f6f5875bda1f20f1a82bdd0d9dfe89f"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f6f5875bda1f20f1a82bdd0d9dfe89f">RTSP_STATUS_SERVICE</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00072">rtspcodes.h:72</a></div></div>
<div class="ttc" id="group__lavu__dict_html_gae67f143237b2cb2936c9b147aa6dfde3"><div class="ttname"><a href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a></div><div class="ttdeci">AVDictionaryEntry * av_dict_get(const AVDictionary *m, const char *key, const AVDictionaryEntry *prev, int flags)</div><div class="ttdoc">Get a dictionary entry with matching key. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00040">dict.c:40</a></div></div>
<div class="ttc" id="structHTTPContext_html_ab22f8c313515101674bb8ceb0e965e20"><div class="ttname"><a href="structHTTPContext.html#ab22f8c313515101674bb8ceb0e965e20">HTTPContext::post</a></div><div class="ttdeci">int post</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00134">ffserver.c:134</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a32379cc371463b235d54235d4af06a15"><div class="ttname"><a href="structAVFormatContext.html#a32379cc371463b235d54235d4af06a15">AVFormatContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdoc">Flags modifying the (de)muxer behaviour. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01449">avformat.h:1449</a></div></div>
<div class="ttc" id="ffserver_8c_html_ade9c9eeadb0f3ef8e60d4a4316465e3a"><div class="ttname"><a href="ffserver_8c.html#ade9c9eeadb0f3ef8e60d4a4316465e3a">rtsp_cmd_interrupt</a></div><div class="ttdeci">static void rtsp_cmd_interrupt(HTTPContext *c, const char *url, RTSPMessageHeader *h, int pause_only)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03341">ffserver.c:3341</a></div></div>
<div class="ttc" id="cmdutils_8c_html_a8863e994be95bc81bbedff194aa2842f"><div class="ttname"><a href="cmdutils_8c.html#a8863e994be95bc81bbedff194aa2842f">parse_options</a></div><div class="ttdeci">void parse_options(void *optctx, int argc, char **argv, const OptionDef *options, void(*parse_arg_function)(void *, const char *))</div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8c_source.html#l00386">cmdutils.c:386</a></div></div>
<div class="ttc" id="structHTTPContext_html_abd6bded6c55a0f5b46d4d93ffdaa7981"><div class="ttname"><a href="structHTTPContext.html#abd6bded6c55a0f5b46d4d93ffdaa7981">HTTPContext::stream</a></div><div class="ttdeci">struct FFServerStream * stream</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00154">ffserver.c:154</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a21fad52116f88a218b8d93ee4216dbeb">HTTPSTATE_SEND_DATA_HEADER</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00079">ffserver.c:79</a></div></div>
<div class="ttc" id="group__lavf__core_html_ga84542023693d61e8564c5d457979c932"><div class="ttname"><a href="group__lavf__core.html#ga84542023693d61e8564c5d457979c932">avformat_network_init</a></div><div class="ttdeci">int avformat_network_init(void)</div><div class="ttdoc">Do global initialization of network components. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04719">utils.c:4719</a></div></div>
<div class="ttc" id="murmur3_8c_html_a4d68f4a1f764d8b45413b33127c24ca8"><div class="ttname"><a href="murmur3_8c.html#a4d68f4a1f764d8b45413b33127c24ca8">c1</a></div><div class="ttdeci">static const uint64_t c1</div><div class="ttdef"><b>Definition:</b> <a href="murmur3_8c_source.html#l00049">murmur3.c:49</a></div></div>
<div class="ttc" id="structFFServerStream_html_aea1b9572fd252c90117af69c2ef73878"><div class="ttname"><a href="structFFServerStream.html#aea1b9572fd252c90117af69c2ef73878">FFServerStream::metadata</a></div><div class="ttdeci">AVDictionary * metadata</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00076">ffserver_config.h:76</a></div></div>
<div class="ttc" id="ffserver_8c_html_a87e247da97177f799c4fe7eb6a577391"><div class="ttname"><a href="ffserver_8c.html#a87e247da97177f799c4fe7eb6a577391">find_rtp_session_with_url</a></div><div class="ttdeci">static HTTPContext * find_rtp_session_with_url(const char *url, const char *session_id)</div><div class="ttdoc">find an RTP connection by using the session ID. </div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03281">ffserver.c:3281</a></div></div>
<div class="ttc" id="structFFServerStream_html_a4bfb8bcea84925fa69c1ce4ee61a7b15"><div class="ttname"><a href="structFFServerStream.html#a4bfb8bcea84925fa69c1ce4ee61a7b15">FFServerStream::is_feed</a></div><div class="ttdeci">int is_feed</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00106">ffserver_config.h:106</a></div></div>
<div class="ttc" id="group__lavf__misc_html_gaa2a7353a6bb0c8726797abd56b176af0"><div class="ttname"><a href="group__lavf__misc.html#gaa2a7353a6bb0c8726797abd56b176af0">av_sdp_create</a></div><div class="ttdeci">int av_sdp_create(AVFormatContext *ac[], int n_files, char *buf, int size)</div><div class="ttdoc">Generate an SDP for an RTP session. </div><div class="ttdef"><b>Definition:</b> <a href="sdp_8c_source.html#l00827">sdp.c:827</a></div></div>
<div class="ttc" id="parseutils_8c_html_ad97f06e907c14c253c2bf3e775f51ccb"><div class="ttname"><a href="parseutils_8c.html#ad97f06e907c14c253c2bf3e775f51ccb">av_find_info_tag</a></div><div class="ttdeci">int av_find_info_tag(char *arg, int arg_size, const char *tag1, const char *info)</div><div class="ttdoc">Attempt to find a specific tag in a URL. </div><div class="ttdef"><b>Definition:</b> <a href="parseutils_8c_source.html#l00707">parseutils.c:707</a></div></div>
<div class="ttc" id="group__lavf__misc_html_ga8247f49e5642dd3bd20ce6ba5a7f6466"><div class="ttname"><a href="group__lavf__misc.html#ga8247f49e5642dd3bd20ce6ba5a7f6466">av_match_ext</a></div><div class="ttdeci">int av_match_ext(const char *filename, const char *extensions)</div><div class="ttdoc">Return a positive value if the given filename has one of the given extensions, 0 otherwise. </div><div class="ttdef"><b>Definition:</b> <a href="format_8c_source.html#l00085">format.c:85</a></div></div>
<div class="ttc" id="ffserver_8c_html_a570f1c612dfbaf3f3deb08f746fdc86b"><div class="ttname"><a href="ffserver_8c.html#a570f1c612dfbaf3f3deb08f746fdc86b">http_receive_data</a></div><div class="ttdeci">static int http_receive_data(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02719">ffserver.c:2719</a></div></div>
<div class="ttc" id="cmdutils_8c_html_a812390811ecf2673409d4d2191b3696a"><div class="ttname"><a href="cmdutils_8c.html#a812390811ecf2673409d4d2191b3696a">parse_loglevel</a></div><div class="ttdeci">void parse_loglevel(int argc, char **argv, const OptionDef *options)</div><div class="ttdoc">Find the &amp;#39;-loglevel&amp;#39; option in the command line args and apply it. </div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8c_source.html#l00511">cmdutils.c:511</a></div></div>
<div class="ttc" id="sdr2_8c_html_abd18f6ed7dc5da8824a97bc504e4280e"><div class="ttname"><a href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a></div><div class="ttdeci">static const uint8_t header[24]</div><div class="ttdef"><b>Definition:</b> <a href="sdr2_8c_source.html#l00067">sdr2.c:67</a></div></div>
<div class="ttc" id="cmdutils_8c_html_a13fba56a5674556e879f5733f9b1dd55"><div class="ttname"><a href="cmdutils_8c.html#a13fba56a5674556e879f5733f9b1dd55">show_help_options</a></div><div class="ttdeci">void show_help_options(const OptionDef *options, const char *msg, int req_flags, int rej_flags, int alt_flags)</div><div class="ttdoc">Print help for all options matching specified flags. </div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8c_source.html#l00176">cmdutils.c:176</a></div></div>
<div class="ttc" id="structFFServerStream_html_a38cbc874e9f67c090ce9df4788aa7ea3"><div class="ttname"><a href="structFFServerStream.html#a38cbc874e9f67c090ce9df4788aa7ea3">FFServerStream::readonly</a></div><div class="ttdeci">int readonly</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00107">ffserver_config.h:107</a></div></div>
<div class="ttc" id="structHTTPContext_html_a949c5b0457e2473d40df89d10149d059"><div class="ttname"><a href="structHTTPContext.html#a949c5b0457e2473d40df89d10149d059">HTTPContext::clean_url</a></div><div class="ttdeci">char clean_url[128 *7]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00167">ffserver.c:167</a></div></div>
<div class="ttc" id="avio_8h_html_acc3626afc6aa3964b75d02811457164e"><div class="ttname"><a href="avio_8h.html#acc3626afc6aa3964b75d02811457164e">avio_write</a></div><div class="ttdeci">void avio_write(AVIOContext *s, const unsigned char *buf, int size)</div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l00204">aviobuf.c:204</a></div></div>
<div class="ttc" id="avformat_8h_html_a2fa1d95841e62af509ba733a11c1b25b"><div class="ttname"><a href="avformat_8h.html#a2fa1d95841e62af509ba733a11c1b25b">AVFMT_FLAG_BITEXACT</a></div><div class="ttdeci">#define AVFMT_FLAG_BITEXACT</div><div class="ttdoc">When muxing, try to avoid writing any random/volatile data to the output. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01466">avformat.h:1466</a></div></div>
<div class="ttc" id="structHTTPContext_html_af9cc8b3dd46404c955ccf2ce856e530d"><div class="ttname"><a href="structHTTPContext.html#af9cc8b3dd46404c955ccf2ce856e530d">HTTPContext::chunk_size</a></div><div class="ttdeci">int chunk_size</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00136">ffserver.c:136</a></div></div>
<div class="ttc" id="structHTTPContext_html_a1b8489c281543ccf0a749c200d700e9d"><div class="ttname"><a href="structHTTPContext.html#a1b8489c281543ccf0a749c200d700e9d">HTTPContext::datarate</a></div><div class="ttdeci">DataRateData datarate</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00162">ffserver.c:162</a></div></div>
<div class="ttc" id="tableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="structRTSPMessageHeader_html_ae395f0f1c4aca826244adc5953312091"><div class="ttname"><a href="structRTSPMessageHeader.html#ae395f0f1c4aca826244adc5953312091">RTSPMessageHeader::nb_transports</a></div><div class="ttdeci">int nb_transports</div><div class="ttdoc">number of items in the &amp;#39;transports&amp;#39; variable below </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00134">rtsp.h:134</a></div></div>
<div class="ttc" id="rtsp_8h_html_a71c900763c29cbcd5df47c2c94f1b355"><div class="ttname"><a href="rtsp_8h.html#a71c900763c29cbcd5df47c2c94f1b355">ff_rtsp_parse_line</a></div><div class="ttdeci">void ff_rtsp_parse_line(AVFormatContext *s, RTSPMessageHeader *reply, const char *buf, RTSPState *rt, const char *method)</div></div>
<div class="ttc" id="ffserver_8c_html_ab25a3625a8efbaa3d81ef27bbb51c9c5"><div class="ttname"><a href="ffserver_8c.html#ab25a3625a8efbaa3d81ef27bbb51c9c5">logfile</a></div><div class="ttdeci">static FILE * logfile</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00256">ffserver.c:256</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a431db42df3f89c9cb3c0e7b31751cbf0"><div class="ttname"><a href="structLayeredAVStream.html#a431db42df3f89c9cb3c0e7b31751cbf0">LayeredAVStream::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00060">ffserver_config.h:60</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a20d80ac07e38ff5c268d15aaf2798b98"><div class="ttname"><a href="structAVFormatContext.html#a20d80ac07e38ff5c268d15aaf2798b98">AVFormatContext::oformat</a></div><div class="ttdeci">struct AVOutputFormat * oformat</div><div class="ttdoc">The output container format. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01357">avformat.h:1357</a></div></div>
<div class="ttc" id="structDataRateData_html"><div class="ttname"><a href="structDataRateData.html">DataRateData</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00120">ffserver.c:120</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a5268fcf4ae8ed27edef54f836b926d93"><div class="ttname"><a href="structAVCodecParameters.html#a5268fcf4ae8ed27edef54f836b926d93">AVCodecParameters::bit_rate</a></div><div class="ttdeci">int64_t bit_rate</div><div class="ttdoc">The average bitrate of the encoded data (in bits per second). </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l04028">avcodec.h:4028</a></div></div>
<div class="ttc" id="group__lavc__packet_html_ga75603d7c2b8adf5829f4fd2fb860168f"><div class="ttname"><a href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a></div><div class="ttdeci">#define AV_PKT_FLAG_KEY</div><div class="ttdoc">The packet contains a keyframe. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01643">avcodec.h:1643</a></div></div>
<div class="ttc" id="ffserver_8c_html_ad5cef9b73d86f71dcd307267d93eb710"><div class="ttname"><a href="ffserver_8c.html#ad5cef9b73d86f71dcd307267d93eb710">COPY</a></div><div class="ttdeci">#define COPY(a)</div></div>
<div class="ttc" id="ffserver_8c_html_abbd688d540cfa9f4915db086ad4786e1"><div class="ttname"><a href="ffserver_8c.html#abbd688d540cfa9f4915db086ad4786e1">http_send_too_busy_reply</a></div><div class="ttdeci">static void http_send_too_busy_reply(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00819">ffserver.c:819</a></div></div>
<div class="ttc" id="group__lavu__math_html_gaf02994a8bbeaa91d4757df179cbe567f"><div class="ttname"><a href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a></div><div class="ttdeci">int64_t av_rescale_q(int64_t a, AVRational bq, AVRational cq)</div><div class="ttdoc">Rescale a 64-bit integer by 2 rational numbers. </div><div class="ttdef"><b>Definition:</b> <a href="mathematics_8c_source.html#l00142">mathematics.c:142</a></div></div>
<div class="ttc" id="structFFServerStream_html_a393766fdc90635636d1cf87316258e90"><div class="ttname"><a href="structFFServerStream.html#a393766fdc90635636d1cf87316258e90">FFServerStream::feed_max_size</a></div><div class="ttdeci">int64_t feed_max_size</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00111">ffserver_config.h:111</a></div></div>
<div class="ttc" id="group__lavc__core_html_gaf4daa92361efb3523ef5afeb0b54077f"><div class="ttname"><a href="group__lavc__core.html#gaf4daa92361efb3523ef5afeb0b54077f">avcodec_close</a></div><div class="ttdeci">int avcodec_close(AVCodecContext *avctx)</div><div class="ttdoc">Close a given AVCodecContext and free all the data associated with it (but not the AVCodecContext its...</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l03024">utils.c:3024</a></div></div>
<div class="ttc" id="avio_8h_html_a853f5149136a27ffba3207d8520172a5"><div class="ttname"><a href="avio_8h.html#a853f5149136a27ffba3207d8520172a5">avio_alloc_context</a></div><div class="ttdeci">AVIOContext * avio_alloc_context(unsigned char *buffer, int buffer_size, int write_flag, void *opaque, int(*read_packet)(void *opaque, uint8_t *buf, int buf_size), int(*write_packet)(void *opaque, uint8_t *buf, int buf_size), int64_t(*seek)(void *opaque, int64_t offset, int whence))</div><div class="ttdoc">Allocate and initialize an AVIOContext for buffered I/O. </div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l00126">aviobuf.c:126</a></div></div>
<div class="ttc" id="structHTTPContext_html_a0697dd8d28e7ef182771de82aab0f4ec"><div class="ttname"><a href="structHTTPContext.html#a0697dd8d28e7ef182771de82aab0f4ec">HTTPContext::cur_clock</a></div><div class="ttdeci">int64_t cur_clock</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00152">ffserver.c:152</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6"><div class="ttname"><a href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedab768904755ca703e7ea647a2602c7aa6">STREAM_TYPE_LIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00034">ffserver_config.h:34</a></div></div>
<div class="ttc" id="structFFServerStream_html_aafcd72e0dd1230e5d125d8f3bd0cfa89"><div class="ttname"><a href="structFFServerStream.html#aafcd72e0dd1230e5d125d8f3bd0cfa89">FFServerStream::loop</a></div><div class="ttdeci">int loop</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00101">ffserver_config.h:101</a></div></div>
<div class="ttc" id="checkasm_8c_html_ac07eab03049dcbd3490f72576f5a34d2"><div class="ttname"><a href="checkasm_8c.html#ac07eab03049dcbd3490f72576f5a34d2">suffix</a></div><div class="ttdeci">const char * suffix</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8c_source.html#l00125">checkasm.c:125</a></div></div>
<div class="ttc" id="ffserver_8c_html_adf7a872163b061adbe0f46216c88496b"><div class="ttname"><a href="ffserver_8c.html#adf7a872163b061adbe0f46216c88496b">extract_rates</a></div><div class="ttdeci">static int extract_rates(char *rates, int ratelen, const char *request)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01158">ffserver.c:1158</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0b3c5afd4398e7e30dcbb3ca21846a7e"><div class="ttname"><a href="ffserver_8c.html#a0b3c5afd4398e7e30dcbb3ca21846a7e">add_av_stream1</a></div><div class="ttdeci">static LayeredAVStream * add_av_stream1(FFServerStream *stream, AVCodecContext *codec, int copy)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03543">ffserver.c:3543</a></div></div>
<div class="ttc" id="structHTTPContext_html_a360cc14ff16f3fd14558e4bf3bbab6b4"><div class="ttname"><a href="structHTTPContext.html#a360cc14ff16f3fd14558e4bf3bbab6b4">HTTPContext::buffer_end</a></div><div class="ttdeci">uint8_t * buffer_end</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00132">ffserver.c:132</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a3019a56080ed2e3297ff25bc2ff88adf"><div class="ttname"><a href="structAVFormatContext.html#a3019a56080ed2e3297ff25bc2ff88adf">AVFormatContext::metadata</a></div><div class="ttdeci">AVDictionary * metadata</div><div class="ttdoc">Metadata that applies to the whole file. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01554">avformat.h:1554</a></div></div>
<div class="ttc" id="ffserver_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="ffserver_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03958">ffserver.c:3958</a></div></div>
<div class="ttc" id="ffserver_8c_html_a9ec5b67aac81069b275ba1dc603c2f11"><div class="ttname"><a href="ffserver_8c.html#a9ec5b67aac81069b275ba1dc603c2f11">handle_connection</a></div><div class="ttdeci">static int handle_connection(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00977">ffserver.c:977</a></div></div>
<div class="ttc" id="structHTTPContext_html_aa4637370811027fb726eba86790a2cab"><div class="ttname"><a href="structHTTPContext.html#aa4637370811027fb726eba86790a2cab">HTTPContext::last_packet_sent</a></div><div class="ttdeci">int last_packet_sent</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00160">ffserver.c:160</a></div></div>
<div class="ttc" id="structHTTPContext_html_a0442246527e4bd06c6a07226206982a9"><div class="ttname"><a href="structHTTPContext.html#a0442246527e4bd06c6a07226206982a9">HTTPContext::got_key_frame</a></div><div class="ttdeci">int got_key_frame</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00138">ffserver.c:138</a></div></div>
<div class="ttc" id="structHTTPContext_html_a89912854b28f50bd3989f3a65b7fbe80"><div class="ttname"><a href="structHTTPContext.html#a89912854b28f50bd3989f3a65b7fbe80">HTTPContext::suppress_log</a></div><div class="ttdeci">int suppress_log</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00161">ffserver.c:161</a></div></div>
<div class="ttc" id="ffserver_8c_html_ab8f12a8f07b794e584b9ae26f465aa48"><div class="ttname"><a href="ffserver_8c.html#ab8f12a8f07b794e584b9ae26f465aa48">get_server_clock</a></div><div class="ttdeci">static int64_t get_server_clock(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02275">ffserver.c:2275</a></div></div>
<div class="ttc" id="ffserver_8c_html_afdbb9d84bd17efd2ae7290e664992c48"><div class="ttname"><a href="ffserver_8c.html#afdbb9d84bd17efd2ae7290e664992c48">closesocket</a></div><div class="ttdeci">#define closesocket</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00028">ffserver.c:28</a></div></div>
<div class="ttc" id="structHTTPContext_html_a737f3e7555cacdd8ad441a798c0b64d9"><div class="ttname"><a href="structHTTPContext.html#a737f3e7555cacdd8ad441a798c0b64d9">HTTPContext::data_count</a></div><div class="ttdeci">int64_t data_count</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00139">ffserver.c:139</a></div></div>
<div class="ttc" id="group__lavu__error_html_gae4bb6f165973d09584e0ec0f335f69ca"><div class="ttname"><a href="group__lavu__error.html#gae4bb6f165973d09584e0ec0f335f69ca">AVERROR</a></div><div class="ttdeci">#define AVERROR(e)</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00043">error.h:43</a></div></div>
<div class="ttc" id="avio__internal_8h_html_a64d46fddfb5ef6745e46078b69517506"><div class="ttname"><a href="avio__internal_8h.html#a64d46fddfb5ef6745e46078b69517506">ffio_set_buf_size</a></div><div class="ttdeci">int ffio_set_buf_size(AVIOContext *s, int buf_size)</div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l00959">aviobuf.c:959</a></div></div>
<div class="ttc" id="ffserver_8c_html_a76b437eb4da461b2522b89d18a95fea6"><div class="ttname"><a href="ffserver_8c.html#a76b437eb4da461b2522b89d18a95fea6">rtsp_cmd_options</a></div><div class="ttdeci">static void rtsp_cmd_options(HTTPContext *c, const char *url)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03047">ffserver.c:3047</a></div></div>
<div class="ttc" id="ffserver_8c_html_ae4c988e126676799d54e082a3d238d0f"><div class="ttname"><a href="ffserver_8c.html#ae4c988e126676799d54e082a3d238d0f">current_bandwidth</a></div><div class="ttdeci">static uint64_t current_bandwidth</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00249">ffserver.c:249</a></div></div>
<div class="ttc" id="structAVCodecContext_html_ab015db3b7fcd227193a7c17283914187"><div class="ttname"><a href="structAVCodecContext.html#ab015db3b7fcd227193a7c17283914187">AVCodecContext::qmax</a></div><div class="ttdeci">int qmax</div><div class="ttdoc">maximum quantizer </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02636">avcodec.h:2636</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a0c1bc367fe75a2e304dfa4f4243fb723">HTTPSTATE_RECEIVE_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00082">ffserver.c:82</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_ace3cff8e1bc22621b52b908e98344ecd"><div class="ttname"><a href="ffserver__config_8h.html#ace3cff8e1bc22621b52b908e98344ecd">FFSERVER_MAX_STREAMS</a></div><div class="ttdeci">#define FFSERVER_MAX_STREAMS</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00030">ffserver_config.h:30</a></div></div>
<div class="ttc" id="structFFServerStream_html_aa049e9b3a7bf9a67855234e2adc5b558"><div class="ttname"><a href="structFFServerStream.html#aa049e9b3a7bf9a67855234e2adc5b558">FFServerStream::conns_served</a></div><div class="ttdeci">int conns_served</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00109">ffserver_config.h:109</a></div></div>
<div class="ttc" id="structHTTPContext_html_a2b5b7f456afa55ea911c5c88b29b3f7d"><div class="ttname"><a href="structHTTPContext.html#a2b5b7f456afa55ea911c5c88b29b3f7d">HTTPContext::pb</a></div><div class="ttdeci">AVIOContext * pb</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00175">ffserver.c:175</a></div></div>
<div class="ttc" id="group__lavu__dict_html_ga1bafd682b1fbb90e48a4cc3814b820f7"><div class="ttname"><a href="group__lavu__dict.html#ga1bafd682b1fbb90e48a4cc3814b820f7">av_dict_free</a></div><div class="ttdeci">void av_dict_free(AVDictionary **pm)</div><div class="ttdoc">Free all the memory allocated for an AVDictionary struct and all keys and values. ...</div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00203">dict.c:203</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a58369c3a8a986935b572df5aa6361ce2"><div class="ttname"><a href="structAVCodecParameters.html#a58369c3a8a986935b572df5aa6361ce2">AVCodecParameters::codec_type</a></div><div class="ttdeci">enum AVMediaType codec_type</div><div class="ttdoc">General type of the encoded data. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l03995">avcodec.h:3995</a></div></div>
<div class="ttc" id="libavcodec_2jacosubdec_8c_html_ac3a73711fd7f8a50db1c4b62e41cf852"><div class="ttname"><a href="libavcodec_2jacosubdec_8c.html#ac3a73711fd7f8a50db1c4b62e41cf852">arg</a></div><div class="ttdeci">const char * arg</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2jacosubdec_8c_source.html#l00066">jacosubdec.c:66</a></div></div>
<div class="ttc" id="structAVCodecContext_html_abb01e291550fa3fb96188af4d494587e"><div class="ttname"><a href="structAVCodecContext.html#abb01e291550fa3fb96188af4d494587e">AVCodecContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdoc">AV_CODEC_FLAG_*. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01781">avcodec.h:1781</a></div></div>
<div class="ttc" id="structHTTPContext_html_a70f20fb613270c53583ebacb819b43c5"><div class="ttname"><a href="structHTTPContext.html#a70f20fb613270c53583ebacb819b43c5">HTTPContext::cur_pts</a></div><div class="ttdeci">int64_t cur_pts</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00146">ffserver.c:146</a></div></div>
<div class="ttc" id="group__opt__set__funcs_html_ga3adf7185c21cc080890a5ec02c2e56b2"><div class="ttname"><a href="group__opt__set__funcs.html#ga3adf7185c21cc080890a5ec02c2e56b2">av_opt_set_int</a></div><div class="ttdeci">int av_opt_set_int(void *obj, const char *name, int64_t val, int search_flags)</div><div class="ttdef"><b>Definition:</b> <a href="opt_8c_source.html#l00560">opt.c:560</a></div></div>
<div class="ttc" id="structFFServerStream_html_aa88511d1e08cd636cb229e794469092b"><div class="ttname"><a href="structFFServerStream.html#aa88511d1e08cd636cb229e794469092b">FFServerStream::stream_type</a></div><div class="ttdeci">enum FFServerStreamType stream_type</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00072">ffserver_config.h:72</a></div></div>
<div class="ttc" id="structline_html"><div class="ttname"><a href="structline.html">line</a></div><div class="ttdef"><b>Definition:</b> <a href="graph2dot_8c_source.html#l00048">graph2dot.c:48</a></div></div>
<div class="ttc" id="group__lavu__misc_html_gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a"><div class="ttname"><a href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a">AVMEDIA_TYPE_AUDIO</a></div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00202">avutil.h:202</a></div></div>
<div class="ttc" id="structFFServerStream_html_ab53c91a45d13b50b16af8519c457bf0c"><div class="ttname"><a href="structFFServerStream.html#ab53c91a45d13b50b16af8519c457bf0c">FFServerStream::dynamic_acl</a></div><div class="ttdeci">char dynamic_acl[1024]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00080">ffserver_config.h:80</a></div></div>
<div class="ttc" id="avassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div><div class="ttdoc">simple assert() macros that are a bit more flexible than ISO C assert(). </div></div>
<div class="ttc" id="group__lavu__log_html_gae8ada5cc5722548d8698650b05207904"><div class="ttname"><a href="group__lavu__log.html#gae8ada5cc5722548d8698650b05207904">av_log_get_level</a></div><div class="ttdeci">int av_log_get_level(void)</div><div class="ttdoc">Get the current log level. </div><div class="ttdef"><b>Definition:</b> <a href="log_8c_source.html#l00386">log.c:386</a></div></div>
<div class="ttc" id="ffserver_8c_html_a91950b6611fc92f92cafe221d4d39a23"><div class="ttname"><a href="ffserver_8c.html#a91950b6611fc92f92cafe221d4d39a23">socket_open_listen</a></div><div class="ttdeci">static int socket_open_listen(struct sockaddr_in *my_addr)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00560">ffserver.c:560</a></div></div>
<div class="ttc" id="group__lavu__mem__funcs_html_ga6a42cc41278e2f5a5b658d2202d1650d"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga6a42cc41278e2f5a5b658d2202d1650d">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdoc">Allocate a memory block with alignment suitable for all memory accesses (including vectors if availab...</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00252">mem.c:252</a></div></div>
<div class="ttc" id="structAVCodec_html_ad3daa3e729850b573c139a83be8938ca"><div class="ttname"><a href="structAVCodec.html#ad3daa3e729850b573c139a83be8938ca">AVCodec::name</a></div><div class="ttdeci">const char * name</div><div class="ttdoc">Name of the codec implementation. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l03626">avcodec.h:3626</a></div></div>
<div class="ttc" id="rtpproto_8h_html"><div class="ttname"><a href="rtpproto_8h.html">rtpproto.h</a></div></div>
<div class="ttc" id="libavformat_2internal_8h_html"><div class="ttname"><a href="libavformat_2internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="structHTTPContext_html_a47a8126b613b2e153682b68c72ed9f8c"><div class="ttname"><a href="structHTTPContext.html#a47a8126b613b2e153682b68c72ed9f8c">HTTPContext::packet_buffer</a></div><div class="ttdeci">uint8_t * packet_buffer</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00188">ffserver.c:188</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5baa205f2326fef6977bfbe1a01e4064">REDIR_RAM</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01420">ffserver.c:1420</a></div></div>
<div class="ttc" id="structHTTPContext_html_a6fd92416fb6b8c6f4bf387f7999f1151"><div class="ttname"><a href="structHTTPContext.html#a6fd92416fb6b8c6f4bf387f7999f1151">HTTPContext::buffer_size</a></div><div class="ttdeci">int buffer_size</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00168">ffserver.c:168</a></div></div>
<div class="ttc" id="ffserver_8c_html_a3f68f47e66dc1934aff0bbdaab8ce5c1"><div class="ttname"><a href="ffserver_8c.html#a3f68f47e66dc1934aff0bbdaab8ce5c1">start_children</a></div><div class="ttdeci">static void start_children(FFServerStream *feed)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00476">ffserver.c:476</a></div></div>
<div class="ttc" id="common_8h_html_a9960bd6780a9b16a216a57be1ee04359"><div class="ttname"><a href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a></div><div class="ttdeci">#define FFMAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00094">common.h:94</a></div></div>
<div class="ttc" id="ffserver_8c_html_a07e9012a2339f51b3d2337cd8d99afc8"><div class="ttname"><a href="ffserver_8c.html#a07e9012a2339f51b3d2337cd8d99afc8">ffm_write_write_index</a></div><div class="ttdeci">static int ffm_write_write_index(int fd, int64_t pos)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00359">ffserver.c:359</a></div></div>
<div class="ttc" id="group__lavc__core_html_ga950c8da55b8112077e640b6a0cb8cf36"><div class="ttname"><a href="group__lavc__core.html#ga950c8da55b8112077e640b6a0cb8cf36">avcodec_parameters_free</a></div><div class="ttdeci">void avcodec_parameters_free(AVCodecParameters **par)</div><div class="ttdoc">Free an AVCodecParameters instance and everything associated with it and write NULL to the supplied p...</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l04141">utils.c:4141</a></div></div>
<div class="ttc" id="group__lavu__mem__funcs_html_gae0443f550815c80af42c5ae967351433"><div class="ttname"><a href="group__lavu__mem__funcs.html#gae0443f550815c80af42c5ae967351433">av_mallocz_array</a></div><div class="ttdeci">static void * av_mallocz_array(size_t nmemb, size_t size)</div><div class="ttdoc">Allocate a memory block for an array with av_mallocz(). </div><div class="ttdef"><b>Definition:</b> <a href="mem_8h_source.html#l00226">mem.h:226</a></div></div>
<div class="ttc" id="group__lavu__string_html_ga716447ae73b612bcf3a405b9b4608f6c"><div class="ttname"><a href="group__lavu__string.html#ga716447ae73b612bcf3a405b9b4608f6c">av_strlcpy</a></div><div class="ttdeci">size_t av_strlcpy(char *dst, const char *src, size_t size)</div><div class="ttdoc">Copy the string src to dst, but no more than size - 1 bytes, and null-terminate dst. </div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00083">avstring.c:83</a></div></div>
<div class="ttc" id="checkasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00084">checkasm.h:84</a></div></div>
<div class="ttc" id="structHTTPContext_html_a8563836c812a34922f773e1e5c8d4e77"><div class="ttname"><a href="structHTTPContext.html#a8563836c812a34922f773e1e5c8d4e77">HTTPContext::feed_streams</a></div><div class="ttdeci">int feed_streams[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00156">ffserver.c:156</a></div></div>
<div class="ttc" id="structFFServerStream_html_a0d94988d7804b1cfbde51783e17ccde9"><div class="ttname"><a href="structFFServerStream.html#a0d94988d7804b1cfbde51783e17ccde9">FFServerStream::pid</a></div><div class="ttdeci">pid_t pid</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00089">ffserver_config.h:89</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7516b6423158baece9632d7274f381fa"><div class="ttname"><a href="ffserver_8c.html#a7516b6423158baece9632d7274f381fa">htmlencode</a></div><div class="ttdeci">static size_t htmlencode(const char *src, char **dest)</div><div class="ttdoc">Substitutes known conflicting chars on a text string with their corresponding HTML entities...</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00287">ffserver.c:287</a></div></div>
<div class="ttc" id="ffserver_8c_html_a3fd8b848051c7766286a128683271e6d"><div class="ttname"><a href="ffserver_8c.html#a3fd8b848051c7766286a128683271e6d">CHECK_CODEC</a></div><div class="ttdeci">#define CHECK_CODEC(x)</div></div>
<div class="ttc" id="structAVPacket_html_a437be96a9da675f12caa228a9c81bd82"><div class="ttname"><a href="structAVPacket.html#a437be96a9da675f12caa228a9c81bd82">AVPacket::flags</a></div><div class="ttdeci">int flags</div><div class="ttdoc">A combination of AV_PKT_FLAG values. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01617">avcodec.h:1617</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a7eb4fd1f323d7e89beaa039a548656d7"><div class="ttname"><a href="structFFServerConfig.html#a7eb4fd1f323d7e89beaa039a548656d7">FFServerConfig::bitexact</a></div><div class="ttdeci">int bitexact</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00125">ffserver_config.h:125</a></div></div>
<div class="ttc" id="ffserver_8c_html_ad7971791d2cd55e08994c113e7ce5cce"><div class="ttname"><a href="ffserver_8c.html#ad7971791d2cd55e08994c113e7ce5cce">first_http_ctx</a></div><div class="ttdeci">static HTTPContext * first_http_ctx</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00191">ffserver.c:191</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a5fecbdcd0da7fcd67cdbc3d3edf2269c">REDIR_ASX</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01419">ffserver.c:1419</a></div></div>
<div class="ttc" id="ffserver_8c_html_aa63c8f34642944df3d8c55b153ba37e4"><div class="ttname"><a href="ffserver_8c.html#aa63c8f34642944df3d8c55b153ba37e4">clean_html</a></div><div class="ttdeci">static void clean_html(char *clean, int clean_len, char *dirty)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01924">ffserver.c:1924</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a0b748d924898b08b89ff4974afd17285"><div class="ttname"><a href="structAVFormatContext.html#a0b748d924898b08b89ff4974afd17285">AVFormatContext::nb_streams</a></div><div class="ttdeci">unsigned int nb_streams</div><div class="ttdoc">Number of elements in AVFormatContext.streams. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01394">avformat.h:1394</a></div></div>
<div class="ttc" id="ffserver_8c_html_adbf4e7a6e700876cc3fb57f649201cf9"><div class="ttname"><a href="ffserver_8c.html#adbf4e7a6e700876cc3fb57f649201cf9">open_input_stream</a></div><div class="ttdeci">static int open_input_stream(HTTPContext *c, const char *info)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02189">ffserver.c:2189</a></div></div>
<div class="ttc" id="ffserver_8c_html_a523a367664093b066749a911db8a615e"><div class="ttname"><a href="ffserver_8c.html#a523a367664093b066749a911db8a615e">log_connection</a></div><div class="ttdeci">static void log_connection(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00443">ffserver.c:443</a></div></div>
<div class="ttc" id="regdef_8h_html_a13d252428836cb17e8183d427299d370"><div class="ttname"><a href="regdef_8h.html#a13d252428836cb17e8183d427299d370">th</a></div><div class="ttdeci">#define th</div><div class="ttdef"><b>Definition:</b> <a href="regdef_8h_source.html#l00075">regdef.h:75</a></div></div>
<div class="ttc" id="structFFServerStream_html_af01cd990e7696193779996276a9fd14d"><div class="ttname"><a href="structFFServerStream.html#af01cd990e7696193779996276a9fd14d">FFServerStream::feed_opened</a></div><div class="ttdeci">int feed_opened</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00105">ffserver_config.h:105</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_ga7d2f532c6653c2419b17956712fdf3da"><div class="ttname"><a href="group__lavf__decoding.html#ga7d2f532c6653c2419b17956712fdf3da">av_find_input_format</a></div><div class="ttdeci">AVInputFormat * av_find_input_format(const char *short_name)</div><div class="ttdoc">Find AVInputFormat based on the short name of the input format. </div><div class="ttdef"><b>Definition:</b> <a href="format_8c_source.html#l00166">format.c:166</a></div></div>
<div class="ttc" id="ffserver_8c_html_aff9f9c16aa064caf50db45ce1f0935fb"><div class="ttname"><a href="ffserver_8c.html#aff9f9c16aa064caf50db45ce1f0935fb">RTSP_REQUEST_TIMEOUT</a></div><div class="ttdeci">#define RTSP_REQUEST_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00111">ffserver.c:111</a></div></div>
<div class="ttc" id="structHTTPContext_html_ad907f5e1973eee1e1b5eb4849645ce7a"><div class="ttname"><a href="structHTTPContext.html#ad907f5e1973eee1e1b5eb4849645ce7a">HTTPContext::method</a></div><div class="ttdeci">char method[16]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00165">ffserver.c:165</a></div></div>
<div class="ttc" id="structAVIOContext_html_a0e3c41c290b38923880b9cccb669bf78"><div class="ttname"><a href="structAVIOContext.html#a0e3c41c290b38923880b9cccb669bf78">AVIOContext::seekable</a></div><div class="ttdeci">int seekable</div><div class="ttdoc">A combination of AVIO_SEEKABLE_ flags or 0 when the stream is not seekable. </div><div class="ttdef"><b>Definition:</b> <a href="avio_8h_source.html#l00243">avio.h:243</a></div></div>
<div class="ttc" id="structFFServerStream_html_a8efffed2728ab6be98d5318f239e8731"><div class="ttname"><a href="structFFServerStream.html#a8efffed2728ab6be98d5318f239e8731">FFServerStream::feed_filename</a></div><div class="ttdeci">char feed_filename[1024]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00087">ffserver_config.h:87</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0192bce4ac95e6e4688d0f2799d34b82"><div class="ttname"><a href="ffserver_8c.html#a0192bce4ac95e6e4688d0f2799d34b82">modify_current_stream</a></div><div class="ttdeci">static int modify_current_stream(HTTPContext *c, char *rates)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01243">ffserver.c:1243</a></div></div>
<div class="ttc" id="structHTTPContext_html_a53573a171889eb51cae1b824169673ed"><div class="ttname"><a href="structHTTPContext.html#a53573a171889eb51cae1b824169673ed">HTTPContext::is_packetized</a></div><div class="ttdeci">int is_packetized</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00170">ffserver.c:170</a></div></div>
<div class="ttc" id="group__lavc__core_html_ga17ae68044f725fd5ba26c54162b96490"><div class="ttname"><a href="group__lavc__core.html#ga17ae68044f725fd5ba26c54162b96490">AV_CODEC_FLAG_BITEXACT</a></div><div class="ttdeci">#define AV_CODEC_FLAG_BITEXACT</div><div class="ttdoc">Use only bitexact stuff (except (I)DCT). </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00890">avcodec.h:890</a></div></div>
<div class="ttc" id="ffserver_8c_html_ab75d5af2efd73e7eee5692f8ce05ee70"><div class="ttname"><a href="ffserver_8c.html#ab75d5af2efd73e7eee5692f8ce05ee70">rtsp_cmd_describe</a></div><div class="ttdeci">static void rtsp_cmd_describe(HTTPContext *c, const char *url)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03057">ffserver.c:3057</a></div></div>
<div class="ttc" id="group__lavu__time_html_gaa11ed202b70e1f52bac809811a910e2a"><div class="ttname"><a href="group__lavu__time.html#gaa11ed202b70e1f52bac809811a910e2a">AV_TIME_BASE</a></div><div class="ttdeci">#define AV_TIME_BASE</div><div class="ttdoc">Internal time base represented as integer. </div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00254">avutil.h:254</a></div></div>
<div class="ttc" id="group__lavf__encoding_html_ga18b7b10bb5b94c4842de18166bc677cb"><div class="ttname"><a href="group__lavf__encoding.html#ga18b7b10bb5b94c4842de18166bc677cb">avformat_write_header</a></div><div class="ttdeci">av_warn_unused_result int avformat_write_header(AVFormatContext *s, AVDictionary **options)</div><div class="ttdoc">Allocate the stream private data and write the stream header to an output media file. </div><div class="ttdef"><b>Definition:</b> <a href="mux_8c_source.html#l00522">mux.c:522</a></div></div>
<div class="ttc" id="common_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="structHTTPContext_html_a2d1234f6f8be648a2585ac0921baca38"><div class="ttname"><a href="structHTTPContext.html#a2d1234f6f8be648a2585ac0921baca38">HTTPContext::start_time</a></div><div class="ttdeci">int64_t start_time</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00144">ffserver.c:144</a></div></div>
<div class="ttc" id="structFFServerStream_html_a8988457ffee4cec8543ad5c29d7abf2c"><div class="ttname"><a href="structFFServerStream.html#a8988457ffee4cec8543ad5c29d7abf2c">FFServerStream::next_feed</a></div><div class="ttdeci">struct FFServerStream * next_feed</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00114">ffserver_config.h:114</a></div></div>
<div class="ttc" id="group__lavu__string_html_ga4c60b7d4ce023a6466bc033e31c5349c"><div class="ttname"><a href="group__lavu__string.html#ga4c60b7d4ce023a6466bc033e31c5349c">av_strcasecmp</a></div><div class="ttdeci">int av_strcasecmp(const char *a, const char *b)</div><div class="ttdoc">Locale-independent case-insensitive compare. </div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00213">avstring.c:213</a></div></div>
<div class="ttc" id="group__lavu__log_html_ga14034761faf581a8b9ed6ef19b313708"><div class="ttname"><a href="group__lavu__log.html#ga14034761faf581a8b9ed6ef19b313708">av_log_set_callback</a></div><div class="ttdeci">void av_log_set_callback(void(*callback)(void *, int, const char *, va_list))</div><div class="ttdoc">Set the logging callback. </div><div class="ttdef"><b>Definition:</b> <a href="log_8c_source.html#l00406">log.c:406</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a1f39d6b2fe7dfdd5ebd3f67dd9a688e1aceaadb5d0eb1670f28ee24b81d672ee4"><div class="ttname"><a href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1aceaadb5d0eb1670f28ee24b81d672ee4">IP_DENY</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00041">ffserver_config.h:41</a></div></div>
<div class="ttc" id="group__lavc__core_html_gae381631ba4fb14f4124575d9ceacb87e"><div class="ttname"><a href="group__lavc__core.html#gae381631ba4fb14f4124575d9ceacb87e">avcodec_copy_context</a></div><div class="ttdeci">attribute_deprecated int avcodec_copy_context(AVCodecContext *dest, const AVCodecContext *src)</div><div class="ttdoc">Copy the settings of the source AVCodecContext into the destination AVCodecContext. </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2options_8c_source.html#l00190">options.c:190</a></div></div>
<div class="ttc" id="group__lavc__core_html_gae80afec6f26df6607eaacf39b561c315"><div class="ttname"><a href="group__lavc__core.html#gae80afec6f26df6607eaacf39b561c315">avcodec_alloc_context3</a></div><div class="ttdeci">AVCodecContext * avcodec_alloc_context3(const AVCodec *codec)</div><div class="ttdoc">Allocate an AVCodecContext and set its fields to default values. </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2options_8c_source.html#l00156">options.c:156</a></div></div>
<div class="ttc" id="group__avoptions_html_ga25801ba4fc9b5313eb33ec84e082dd72"><div class="ttname"><a href="group__avoptions.html#ga25801ba4fc9b5313eb33ec84e082dd72">AV_OPT_SEARCH_CHILDREN</a></div><div class="ttdeci">#define AV_OPT_SEARCH_CHILDREN</div><div class="ttdoc">Search in possible children of the given object first. </div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00557">opt.h:557</a></div></div>
<div class="ttc" id="cmdutils__common__opts_8h_html"><div class="ttname"><a href="cmdutils__common__opts_8h.html">cmdutils_common_opts.h</a></div></div>
<div class="ttc" id="tests_2snowenc_8c_html_a667b04d7fb6ef46db4da4af554c5b6f7"><div class="ttname"><a href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a></div><div class="ttdeci">#define width</div></div>
<div class="ttc" id="intreadwrite_8h_html"><div class="ttname"><a href="intreadwrite_8h.html">intreadwrite.h</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a0d8f46461754e8abea0847dcbc41b956"><div class="ttname"><a href="structAVCodecContext.html#a0d8f46461754e8abea0847dcbc41b956">AVCodecContext::width</a></div><div class="ttdeci">int width</div><div class="ttdoc">picture width / height. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01873">avcodec.h:1873</a></div></div>
<div class="ttc" id="structRTSPActionServerSetup_html_aab0be1e2a5d7348cb5067d039720889a"><div class="ttname"><a href="structRTSPActionServerSetup.html#aab0be1e2a5d7348cb5067d039720889a">RTSPActionServerSetup::ipaddr</a></div><div class="ttdeci">uint32_t ipaddr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00116">ffserver.c:116</a></div></div>
<div class="ttc" id="avio__internal_8h_html_aa743cd8e9a78aae3c1774cc8eba565cc"><div class="ttname"><a href="avio__internal_8h.html#aa743cd8e9a78aae3c1774cc8eba565cc">ffio_open_dyn_packet_buf</a></div><div class="ttdeci">int ffio_open_dyn_packet_buf(AVIOContext **s, int max_packet_size)</div><div class="ttdoc">Open a write only packetized memory stream with a maximum packet size of &amp;#39;max_packet_size&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l01273">aviobuf.c:1273</a></div></div>
<div class="ttc" id="rtsp_8h_html_a53132bb0c530c18c36fc96f3acece4f0"><div class="ttname"><a href="rtsp_8h.html#a53132bb0c530c18c36fc96f3acece4f0">RTSP_TCP_MAX_PACKET_SIZE</a></div><div class="ttdeci">#define RTSP_TCP_MAX_PACKET_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00075">rtsp.h:75</a></div></div>
<div class="ttc" id="network_8h_html_aa807b114961219408d111f732d1dcbe5"><div class="ttname"><a href="network_8h.html#aa807b114961219408d111f732d1dcbe5">ff_neterrno</a></div><div class="ttdeci">#define ff_neterrno()</div><div class="ttdef"><b>Definition:</b> <a href="network_8h_source.html#l00064">network.h:64</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_ac54400bd093a3ba8b30357e5fed6a4d3"><div class="ttname"><a href="structLayeredAVStream.html#ac54400bd093a3ba8b30357e5fed6a4d3">LayeredAVStream::codec</a></div><div class="ttdeci">AVCodecContext * codec</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00063">ffserver_config.h:63</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a010e0fa995cc51d44653090810041c09"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a010e0fa995cc51d44653090810041c09">RTSP_STATUS_METHOD</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00047">rtspcodes.h:47</a></div></div>
<div class="ttc" id="structHTTPContext_html_aa7695127ee24c7cdbe26798587159ad1"><div class="ttname"><a href="structHTTPContext.html#aa7695127ee24c7cdbe26798587159ad1">HTTPContext::seq</a></div><div class="ttdeci">int seq</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00176">ffserver.c:176</a></div></div>
<div class="ttc" id="structAVOutputFormat_html_ac3abc5f47f3465b6b7eec89c9476351c"><div class="ttname"><a href="structAVOutputFormat.html#ac3abc5f47f3465b6b7eec89c9476351c">AVOutputFormat::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00524">avformat.h:524</a></div></div>
<div class="ttc" id="ffserver__config_8c_html_a43fc93241b7167a490acaf8873c8e8f2"><div class="ttname"><a href="ffserver__config_8c.html#a43fc93241b7167a490acaf8873c8e8f2">ffserver_get_arg</a></div><div class="ttdeci">void ffserver_get_arg(char *buf, int buf_size, const char **pp)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8c_source.html#l00082">ffserver_config.c:82</a></div></div>
<div class="ttc" id="structFFServerIPAddressACL_html_af5838674c8df1f690b1db328e5556fa0"><div class="ttname"><a href="structFFServerIPAddressACL.html#af5838674c8df1f690b1db328e5556fa0">FFServerIPAddressACL::next</a></div><div class="ttdeci">struct FFServerIPAddressACL * next</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00045">ffserver_config.h:45</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a1ec57ee84f19cf65d00eaa4d2a2253ce"><div class="ttname"><a href="structAVCodecParameters.html#a1ec57ee84f19cf65d00eaa4d2a2253ce">AVCodecParameters::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l04066">avcodec.h:4066</a></div></div>
<div class="ttc" id="group__lavu__error_html_gac4f6e109c242c81aeee21868d3f35e12"><div class="ttname"><a href="group__lavu__error.html#gac4f6e109c242c81aeee21868d3f35e12">av_err2str</a></div><div class="ttdeci">#define av_err2str(errnum)</div><div class="ttdoc">Convenience macro, the return value should be used only directly in function arguments but never stan...</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00119">error.h:119</a></div></div>
<div class="ttc" id="tests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="structFFServerStream_html_ae9873c6eb98733d4845cefd220e35630"><div class="ttname"><a href="structFFServerStream.html#ae9873c6eb98733d4845cefd220e35630">FFServerStream::feed_size</a></div><div class="ttdeci">int64_t feed_size</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00113">ffserver_config.h:113</a></div></div>
<div class="ttc" id="structFFServerStream_html_a67b2a3a3be5a3da4e805918299ab3b61"><div class="ttname"><a href="structFFServerStream.html#a67b2a3a3be5a3da4e805918299ab3b61">FFServerStream::nb_streams</a></div><div class="ttdeci">int nb_streams</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00081">ffserver_config.h:81</a></div></div>
<div class="ttc" id="structRTSPTransportField_html"><div class="ttname"><a href="structRTSPTransportField.html">RTSPTransportField</a></div><div class="ttdoc">This describes a single item in the &quot;Transport:&quot; line of one stream as negotiated by the SETUP RTSP c...</div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00088">rtsp.h:88</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a584e92b819c85fffe4c2bc05487fdb4e">HTTPSTATE_WAIT_FEED</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00083">ffserver.c:83</a></div></div>
<div class="ttc" id="structHTTPContext_html_adf3d57085ea03dcfb1291f75cdb21bbc"><div class="ttname"><a href="structHTTPContext.html#adf3d57085ea03dcfb1291f75cdb21bbc">HTTPContext::switch_pending</a></div><div class="ttdeci">int switch_pending</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00158">ffserver.c:158</a></div></div>
<div class="ttc" id="structFFServerStream_html_a557600322aba620b2985fa0daa2b1523"><div class="ttname"><a href="structFFServerStream.html#a557600322aba620b2985fa0daa2b1523">FFServerStream::feed_write_index</a></div><div class="ttdeci">int64_t feed_write_index</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00112">ffserver_config.h:112</a></div></div>
<div class="ttc" id="ffserver_8c_html_af4f4bba894f9f789fb9a97626d8bffe3"><div class="ttname"><a href="ffserver_8c.html#af4f4bba894f9f789fb9a97626d8bffe3">need_to_start_children</a></div><div class="ttdeci">static int need_to_start_children</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00244">ffserver.c:244</a></div></div>
<div class="ttc" id="structHTTPContext_html_a698bf6b7c2a9c8f1396b835e994522f2"><div class="ttname"><a href="structHTTPContext.html#a698bf6b7c2a9c8f1396b835e994522f2">HTTPContext::rtsp_c</a></div><div class="ttdeci">struct HTTPContext * rtsp_c</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00187">ffserver.c:187</a></div></div>
<div class="ttc" id="ffserver_8c_html_a97de50e0209c967af29fbc038a788bc1"><div class="ttname"><a href="ffserver_8c.html#a97de50e0209c967af29fbc038a788bc1">random_state</a></div><div class="ttdeci">static AVLFG random_state</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00254">ffserver.c:254</a></div></div>
<div class="ttc" id="structFFServerStream_html_a13c2490307acfdd1d8d179452a870987"><div class="ttname"><a href="structFFServerStream.html#a13c2490307acfdd1d8d179452a870987">FFServerStream::multicast_ttl</a></div><div class="ttdeci">int multicast_ttl</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00100">ffserver_config.h:100</a></div></div>
<div class="ttc" id="group__lavf__encoding_html_ga8795680bd7489e96eeb5aef5e615cacc"><div class="ttname"><a href="group__lavf__encoding.html#ga8795680bd7489e96eeb5aef5e615cacc">av_guess_format</a></div><div class="ttdeci">AVOutputFormat * av_guess_format(const char *short_name, const char *filename, const char *mime_type)</div><div class="ttdoc">Return the output format in the list of registered output formats which best matches the provided par...</div><div class="ttdef"><b>Definition:</b> <a href="format_8c_source.html#l00098">format.c:98</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a51470339c20ac490af53c9acb2300aedaca9fe53fa0bd0aa649c700996e7fda22"><div class="ttname"><a href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedaca9fe53fa0bd0aa649c700996e7fda22">STREAM_TYPE_REDIRECT</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00036">ffserver_config.h:36</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1ae9ab007769b30e94e6a1b8734db499a1">REDIR_RTSP</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01422">ffserver.c:1422</a></div></div>
<div class="ttc" id="lfg_8h_html"><div class="ttname"><a href="lfg_8h.html">lfg.h</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811af2553e6bd7de015f43b53e02029db13a">HTTPSTATE_READY</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00084">ffserver.c:84</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a0449afd803eb107bd4dbc8b5ea22e363"><div class="ttname"><a href="structAVCodecContext.html#a0449afd803eb107bd4dbc8b5ea22e363">AVCodecContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01873">avcodec.h:1873</a></div></div>
<div class="ttc" id="network_8h_html_a24d04e29f579c954b882070912b75fa8"><div class="ttname"><a href="network_8h.html#a24d04e29f579c954b882070912b75fa8">ff_socket_nonblock</a></div><div class="ttdeci">int ff_socket_nonblock(int socket, int enable)</div></div>
<div class="ttc" id="ffserver_8c_html_abdf71fb497c71e9f55df5fd7541bff22"><div class="ttname"><a href="ffserver_8c.html#abdf71fb497c71e9f55df5fd7541bff22">check_codec_match</a></div><div class="ttdeci">static int check_codec_match(LayeredAVStream *ccf, AVStream *ccs, int stream)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03692">ffserver.c:3692</a></div></div>
<div class="ttc" id="structHTTPContext_html_a30cfdc9431ce9741975b8a97f5d39b3a"><div class="ttname"><a href="structHTTPContext.html#a30cfdc9431ce9741975b8a97f5d39b3a">HTTPContext::cur_frame_bytes</a></div><div class="ttdeci">int cur_frame_bytes</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00148">ffserver.c:148</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811ae92c524e288c7ba587106bceea38904e">RTSPSTATE_SEND_PACKET</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00088">ffserver.c:88</a></div></div>
<div class="ttc" id="ffplay_8c_html_a5ad4c812a5f4896f57511a05a3207999"><div class="ttname"><a href="ffplay_8c.html#a5ad4c812a5f4896f57511a05a3207999">input_filename</a></div><div class="ttdeci">static const char * input_filename</div><div class="ttdef"><b>Definition:</b> <a href="ffplay_8c_source.html#l00313">ffplay.c:313</a></div></div>
<div class="ttc" id="sinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00036">sinewin_tablegen_template.c:36</a></div></div>
<div class="ttc" id="time_8c_html_aebf7f9c94187487c31d26fa3da816468"><div class="ttname"><a href="time_8c.html#aebf7f9c94187487c31d26fa3da816468">av_gettime</a></div><div class="ttdeci">int64_t av_gettime(void)</div><div class="ttdoc">Get the current time in microseconds. </div><div class="ttdef"><b>Definition:</b> <a href="time_8c_source.html#l00039">time.c:39</a></div></div>
<div class="ttc" id="structAVStream_html"><div class="ttname"><a href="structAVStream.html">AVStream</a></div><div class="ttdoc">Stream structure. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00889">avformat.h:889</a></div></div>
<div class="ttc" id="structHTTPContext_html_ab81d9d4dc24eb5b5427116cc92745f60"><div class="ttname"><a href="structHTTPContext.html#ab81d9d4dc24eb5b5427116cc92745f60">HTTPContext::rtp_protocol</a></div><div class="ttdeci">enum RTSPLowerTransport rtp_protocol</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00179">ffserver.c:179</a></div></div>
<div class="ttc" id="ffserver_8c_html_a09a4abb882f4a5eb922527165c838faf"><div class="ttname"><a href="ffserver_8c.html#a09a4abb882f4a5eb922527165c838faf">ffm_read_write_index</a></div><div class="ttdeci">static int64_t ffm_read_write_index(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00348">ffserver.c:348</a></div></div>
<div class="ttc" id="structHTTPContext_html_abd900108894027bb7848787d0626560a"><div class="ttname"><a href="structHTTPContext.html#abd900108894027bb7848787d0626560a">HTTPContext::from_addr</a></div><div class="ttdeci">struct sockaddr_in from_addr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00129">ffserver.c:129</a></div></div>
<div class="ttc" id="group__lavf__core_html_ga245f2875f80ce67ec3d1e0f54dacf2c4"><div class="ttname"><a href="group__lavf__core.html#ga245f2875f80ce67ec3d1e0f54dacf2c4">avformat_network_deinit</a></div><div class="ttdeci">int avformat_network_deinit(void)</div><div class="ttdoc">Undo the initialization done by avformat_network_init. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04732">utils.c:4732</a></div></div>
<div class="ttc" id="ffmpeg__filter_8c_html_a9feef5270e0e54f103868362df0cd27a"><div class="ttname"><a href="ffmpeg__filter_8c.html#a9feef5270e0e54f103868362df0cd27a">sample_rate</a></div><div class="ttdeci">sample_rate</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00190">ffmpeg_filter.c:190</a></div></div>
<div class="ttc" id="ffserver_8c_html_a6cd5bfe26f563e17139086c1f18a3183"><div class="ttname"><a href="ffserver_8c.html#a6cd5bfe26f563e17139086c1f18a3183">PBUFFER_SIZE</a></div><div class="ttdeci">#define PBUFFER_SIZE</div></div>
<div class="ttc" id="mxfenc_8c_html_ad662aa56c1696f09c0ac6b97abafac6d"><div class="ttname"><a href="mxfenc_8c.html#ad662aa56c1696f09c0ac6b97abafac6d">frame_size</a></div><div class="ttdeci">int frame_size</div><div class="ttdef"><b>Definition:</b> <a href="mxfenc_8c_source.html#l01820">mxfenc.c:1820</a></div></div>
<div class="ttc" id="group__lavu__mem__funcs_html_ga7c352f4cff02184f005323691375fea9"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a></div><div class="ttdeci">char * av_strdup(const char *s)</div><div class="ttdoc">Duplicate a string. </div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00267">mem.c:267</a></div></div>
<div class="ttc" id="structHTTPContext_html_a7dc323b9fb82acf5f63b83f3524be511"><div class="ttname"><a href="structHTTPContext.html#a7dc323b9fb82acf5f63b83f3524be511">HTTPContext::http_error</a></div><div class="ttdeci">int http_error</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00133">ffserver.c:133</a></div></div>
<div class="ttc" id="ffserver_8c_html_a08fb465ef64e53221d4d10bcb796a16b"><div class="ttname"><a href="ffserver_8c.html#a08fb465ef64e53221d4d10bcb796a16b">rtp_new_connection</a></div><div class="ttdeci">static HTTPContext * rtp_new_connection(struct sockaddr_in *from_addr, FFServerStream *stream, const char *session_id, enum RTSPLowerTransport rtp_protocol)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03375">ffserver.c:3375</a></div></div>
<div class="ttc" id="ffserver_8c_html_abfee149d261eace9ff0d19f72bff6d3c"><div class="ttname"><a href="ffserver_8c.html#abfee149d261eace9ff0d19f72bff6d3c">compute_status</a></div><div class="ttdeci">static void compute_status(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01952">ffserver.c:1952</a></div></div>
<div class="ttc" id="structAVStream_html_ae495a86ddec02af7d5a2805beba9ac9f"><div class="ttname"><a href="structAVStream.html#ae495a86ddec02af7d5a2805beba9ac9f">AVStream::internal</a></div><div class="ttdeci">AVStreamInternal * internal</div><div class="ttdoc">An opaque field for libavformat internal usage. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01230">avformat.h:1230</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a3f99ca3115c44e6d7772c9384faf15e6"><div class="ttname"><a href="structAVCodecContext.html#a3f99ca3115c44e6d7772c9384faf15e6">AVCodecContext::codec_type</a></div><div class="ttdeci">enum AVMediaType codec_type</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01694">avcodec.h:1694</a></div></div>
<div class="ttc" id="group__lavc__core_html_gaf869d0829ed607cec3a4a02a1c7026b3"><div class="ttname"><a href="group__lavc__core.html#gaf869d0829ed607cec3a4a02a1c7026b3">avcodec_free_context</a></div><div class="ttdeci">void avcodec_free_context(AVCodecContext **avctx)</div><div class="ttdoc">Free the codec context and everything associated with it and write NULL to the provided pointer...</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2options_8c_source.html#l00171">options.c:171</a></div></div>
<div class="ttc" id="ffserver_8c_html_ae4816b6ec3780edf8e6cba537c0fa5ec"><div class="ttname"><a href="ffserver_8c.html#ae4816b6ec3780edf8e6cba537c0fa5ec">start_multicast</a></div><div class="ttdeci">static void start_multicast(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00599">ffserver.c:599</a></div></div>
<div class="ttc" id="structAVCodecContext_html_adc5f65d6099fd8339c1580c091777223"><div class="ttname"><a href="structAVCodecContext.html#adc5f65d6099fd8339c1580c091777223">AVCodecContext::codec_id</a></div><div class="ttdeci">enum AVCodecID codec_id</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01703">avcodec.h:1703</a></div></div>
<div class="ttc" id="group__lavu__time_html_gafd07a13a4ddaa6015275cad6022d9ee3"><div class="ttname"><a href="group__lavu__time.html#gafd07a13a4ddaa6015275cad6022d9ee3">AV_TIME_BASE_Q</a></div><div class="ttdeci">#define AV_TIME_BASE_Q</div><div class="ttdoc">Internal time base represented as fractional value. </div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00260">avutil.h:260</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a8ff0b000c463361e234af48d03aadfc0"><div class="ttname"><a href="structAVCodecContext.html#a8ff0b000c463361e234af48d03aadfc0">AVCodecContext::sample_rate</a></div><div class="ttdeci">int sample_rate</div><div class="ttdoc">samples per second </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02448">avcodec.h:2448</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a1e7324262b6b78522e52064daaa7bc87"><div class="ttname"><a href="structAVFormatContext.html#a1e7324262b6b78522e52064daaa7bc87">AVFormatContext::pb</a></div><div class="ttdeci">AVIOContext * pb</div><div class="ttdoc">I/O context. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01380">avformat.h:1380</a></div></div>
<div class="ttc" id="colorspacedsp__template_8c_html_a74d3c3c85d450f9238a162d015c0b407"><div class="ttname"><a href="colorspacedsp__template_8c.html#a74d3c3c85d450f9238a162d015c0b407">ss</a></div><div class="ttdeci">#define ss</div><div class="ttdef"><b>Definition:</b> <a href="colorspacedsp__template_8c_source.html#l00027">colorspacedsp_template.c:27</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a7f0fc0f1bf928a66576e21bb2064dded">HTTPSTATE_SEND_DATA_TRAILER</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00081">ffserver.c:81</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a2d7459850c748f74559fc4369683685a">REDIR_ASF</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01421">ffserver.c:1421</a></div></div>
<div class="ttc" id="structFFServerStream_html_a6b0ce59c3493c86db7d4b75a4de6db94"><div class="ttname"><a href="structFFServerStream.html#a6b0ce59c3493c86db7d4b75a4de6db94">FFServerStream::filename</a></div><div class="ttdeci">char filename[1024]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00073">ffserver_config.h:73</a></div></div>
<div class="ttc" id="structAVCodecContext_html"><div class="ttname"><a href="structAVCodecContext.html">AVCodecContext</a></div><div class="ttdoc">main external API structure. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01686">avcodec.h:1686</a></div></div>
<div class="ttc" id="group__lavc__packet_html_ga63d5a489b419bd5d45cfd09091cbcbc2"><div class="ttname"><a href="group__lavc__packet.html#ga63d5a489b419bd5d45cfd09091cbcbc2">av_packet_unref</a></div><div class="ttdeci">void av_packet_unref(AVPacket *pkt)</div><div class="ttdoc">Wipe the packet. </div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00569">avpacket.c:569</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a3f63bc9141e25bf7f1cda0cef7cd4a60"><div class="ttname"><a href="structAVCodecContext.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">AVCodecContext::qmin</a></div><div class="ttdeci">int qmin</div><div class="ttdoc">minimum quantizer </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02629">avcodec.h:2629</a></div></div>
<div class="ttc" id="structHTTPContext_html_a8078009a52019644e9b61965bdaa4619"><div class="ttname"><a href="structHTTPContext.html#a8078009a52019644e9b61965bdaa4619">HTTPContext::wmp_client_id</a></div><div class="ttdeci">int wmp_client_id</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00163">ffserver.c:163</a></div></div>
<div class="ttc" id="structDataRateData_html_a46f9318f9887fb1f27b3a67d8e8eb2f7"><div class="ttname"><a href="structDataRateData.html#a46f9318f9887fb1f27b3a67d8e8eb2f7">DataRateData::time1</a></div><div class="ttdeci">int64_t time1</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00122">ffserver.c:122</a></div></div>
<div class="ttc" id="ffserver_8c_html_a716ffa43b588f6944a24f595d0bdc406"><div class="ttname"><a href="ffserver_8c.html#a716ffa43b588f6944a24f595d0bdc406">compute_datarate</a></div><div class="ttdeci">static int compute_datarate(DataRateData *drd, int64_t count)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00467">ffserver.c:467</a></div></div>
<div class="ttc" id="checkasm_8c_html_a615e09de8eb27f4c0e37e10a1f25f4e3"><div class="ttname"><a href="checkasm_8c.html#a615e09de8eb27f4c0e37e10a1f25f4e3">state</a></div><div class="ttdeci">static struct @246 state</div></div>
<div class="ttc" id="structFFServerConfig_html_ad1fe0423f113886e101ec5f804bb5ef3"><div class="ttname"><a href="structFFServerConfig.html#ad1fe0423f113886e101ec5f804bb5ef3">FFServerConfig::rtsp_addr</a></div><div class="ttdeci">struct sockaddr_in rtsp_addr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00128">ffserver_config.h:128</a></div></div>
<div class="ttc" id="lfg_8h_html_a58feb242e560adee0b7a16e11cce43e9"><div class="ttname"><a href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a></div><div class="ttdeci">static unsigned int av_lfg_get(AVLFG *c)</div><div class="ttdoc">Get the next random unsigned 32-bit number using an ALFG. </div><div class="ttdef"><b>Definition:</b> <a href="lfg_8h_source.html#l00038">lfg.h:38</a></div></div>
<div class="ttc" id="structFFServerIPAddressACL_html"><div class="ttname"><a href="structFFServerIPAddressACL.html">FFServerIPAddressACL</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00044">ffserver_config.h:44</a></div></div>
<div class="ttc" id="ffserver_8c_html_a1610daa40d8bb73e71ffa45f79202092"><div class="ttname"><a href="ffserver_8c.html#a1610daa40d8bb73e71ffa45f79202092">find_transport</a></div><div class="ttdeci">static RTSPTransportField * find_transport(RTSPMessageHeader *h, enum RTSPLowerTransport lower_transport)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03119">ffserver.c:3119</a></div></div>
<div class="ttc" id="avisynth__c_8h_html_a5bc5fa69bee375df074734a2c4858604"><div class="ttname"><a href="avisynth__c_8h.html#a5bc5fa69bee375df074734a2c4858604">buf</a></div><div class="ttdeci">void * buf</div><div class="ttdef"><b>Definition:</b> <a href="avisynth__c_8h_source.html#l00690">avisynth_c.h:690</a></div></div>
<div class="ttc" id="structURLContext_html"><div class="ttname"><a href="structURLContext.html">URLContext</a></div><div class="ttdef"><b>Definition:</b> <a href="url_8h_source.html#l00038">url.h:38</a></div></div>
<div class="ttc" id="structHTTPContext_html_a4d2991be910b4f3355f5c6f29b386f1e"><div class="ttname"><a href="structHTTPContext.html#a4d2991be910b4f3355f5c6f29b386f1e">HTTPContext::url</a></div><div class="ttdeci">char url[128]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00166">ffserver.c:166</a></div></div>
<div class="ttc" id="ffserver__config_8h_html"><div class="ttname"><a href="ffserver__config_8h.html">ffserver_config.h</a></div></div>
<div class="ttc" id="ffserver_8c_html_a6f20cb062ef282f88c097aeceedec5b0"><div class="ttname"><a href="ffserver_8c.html#a6f20cb062ef282f88c097aeceedec5b0">close_connection</a></div><div class="ttdeci">static void close_connection(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00892">ffserver.c:892</a></div></div>
<div class="ttc" id="group__lavu__dict_html_ga8d9c2de72b310cef8e6a28c9cd3acbbe"><div class="ttname"><a href="group__lavu__dict.html#ga8d9c2de72b310cef8e6a28c9cd3acbbe">av_dict_set</a></div><div class="ttdeci">int av_dict_set(AVDictionary **pm, const char *key, const char *value, int flags)</div><div class="ttdoc">Set the given entry in *pm, overwriting an existing entry. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00070">dict.c:70</a></div></div>
<div class="ttc" id="structRTSPTransportField_html_ab74cb39e497f057274fed883e4ac38e8"><div class="ttname"><a href="structRTSPTransportField.html#ab74cb39e497f057274fed883e4ac38e8">RTSPTransportField::client_port_max</a></div><div class="ttdeci">int client_port_max</div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00101">rtsp.h:101</a></div></div>
<div class="ttc" id="ffserver_8c_html_a14234b6e4169d7035d9b2fd05597e6ec"><div class="ttname"><a href="ffserver_8c.html#a14234b6e4169d7035d9b2fd05597e6ec">http_server</a></div><div class="ttdeci">static int http_server(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00659">ffserver.c:659</a></div></div>
<div class="ttc" id="tests_2movenc_8c_html_a6bd2bb5fcc7628a640958994a22f997c"><div class="ttname"><a href="tests_2movenc_8c.html#a6bd2bb5fcc7628a640958994a22f997c">format</a></div><div class="ttdeci">static const char * format</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00047">movenc.c:47</a></div></div>
<div class="ttc" id="structAVClass_html"><div class="ttname"><a href="structAVClass.html">AVClass</a></div><div class="ttdoc">Describe the class of an AVClass context structure. </div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00067">log.h:67</a></div></div>
<div class="ttc" id="ffserver_8c_html_a212917be0aeecbac5a284e0c1d24e178"><div class="ttname"><a href="ffserver_8c.html#a212917be0aeecbac5a284e0c1d24e178">cp_html_entity</a></div><div class="ttdeci">static void cp_html_entity(char *buffer, const char *entity)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00273">ffserver.c:273</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a500d718ddfcb6ad593c6342c0b1f6b4d"><div class="ttname"><a href="structLayeredAVStream.html#a500d718ddfcb6ad593c6342c0b1f6b4d">LayeredAVStream::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00064">ffserver_config.h:64</a></div></div>
<div class="ttc" id="gxfenc_8c_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="gxfenc_8c_source.html#l00089">gxfenc.c:89</a></div></div>
<div class="ttc" id="group__lavc__core_html_ga0c7058f764778615e7978a1821ab3cfe"><div class="ttname"><a href="group__lavc__core.html#ga0c7058f764778615e7978a1821ab3cfe">avcodec_parameters_from_context</a></div><div class="ttdeci">int avcodec_parameters_from_context(AVCodecParameters *par, const AVCodecContext *codec)</div><div class="ttdoc">Fill the parameters struct based on the values from the supplied codec context. </div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l04170">utils.c:4170</a></div></div>
<div class="ttc" id="structHTTPContext_html_acca83282aa4a9f53f97b8c42c8d2e037"><div class="ttname"><a href="structHTTPContext.html#acca83282aa4a9f53f97b8c42c8d2e037">HTTPContext::buffer_ptr</a></div><div class="ttdeci">uint8_t * buffer_ptr</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00132">ffserver.c:132</a></div></div>
<div class="ttc" id="cmdutils_8h_html_a91fea349332c05eb78ce3c17202e1dc9"><div class="ttname"><a href="cmdutils_8h.html#a91fea349332c05eb78ce3c17202e1dc9">OPT_STRING</a></div><div class="ttdeci">#define OPT_STRING</div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8h_source.html#l00171">cmdutils.h:171</a></div></div>
<div class="ttc" id="ffserver_8c_html_ac1af233dcbd62e550aeedcab90a7eef7"><div class="ttname"><a href="ffserver_8c.html#ac1af233dcbd62e550aeedcab90a7eef7">update_datarate</a></div><div class="ttdeci">static void update_datarate(DataRateData *drd, int64_t count)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00453">ffserver.c:453</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811afbd8c5e50abc1e106b34eb332d7800d8">RTSPSTATE_WAIT_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00086">ffserver.c:86</a></div></div>
<div class="ttc" id="structLayeredAVStream_html"><div class="ttname"><a href="structLayeredAVStream.html">LayeredAVStream</a></div><div class="ttdoc">This holds the stream parameters for an AVStream, it cannot be a AVStream because AVStreams cannot be...</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00059">ffserver_config.h:59</a></div></div>
<div class="ttc" id="avstring_8c_html_a98e5858f933c6e6be64f03a76e22b272"><div class="ttname"><a href="avstring_8c.html#a98e5858f933c6e6be64f03a76e22b272">av_strlcatf</a></div><div class="ttdeci">size_t av_strlcatf(char *dst, size_t size, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00101">avstring.c:101</a></div></div>
<div class="ttc" id="structFFServerStream_html_ae0f8891be0f03ce7f7de92302967b40c"><div class="ttname"><a href="structFFServerStream.html#ae0f8891be0f03ce7f7de92302967b40c">FFServerStream::streams</a></div><div class="ttdeci">LayeredAVStream * streams[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00085">ffserver_config.h:85</a></div></div>
<div class="ttc" id="lfg_8c_html_aa8cc657d3dca15bc50a94730a4346d58"><div class="ttname"><a href="lfg_8c.html#aa8cc657d3dca15bc50a94730a4346d58">av_lfg_init</a></div><div class="ttdeci">av_cold void av_lfg_init(AVLFG *c, unsigned int seed)</div><div class="ttdef"><b>Definition:</b> <a href="lfg_8c_source.html#l00030">lfg.c:30</a></div></div>
<div class="ttc" id="structHTTPContext_html_a3008f31e40fb771d3e8687658e7304bc"><div class="ttname"><a href="structHTTPContext.html#a3008f31e40fb771d3e8687658e7304bc">HTTPContext::first_pts</a></div><div class="ttdeci">int64_t first_pts</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00145">ffserver.c:145</a></div></div>
<div class="ttc" id="ffserver_8c_html_affee77914991e4f6048c708556a7edbe"><div class="ttname"><a href="ffserver_8c.html#affee77914991e4f6048c708556a7edbe">options</a></div><div class="ttdeci">static const OptionDef options[]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00074">ffserver.c:74</a></div></div>
<div class="ttc" id="ffserver_8c_html_ad3bea3b94289e908d655569f284c1543"><div class="ttname"><a href="ffserver_8c.html#ad3bea3b94289e908d655569f284c1543">start_wait_request</a></div><div class="ttdeci">static void start_wait_request(HTTPContext *c, int is_rtsp)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00809">ffserver.c:809</a></div></div>
<div class="ttc" id="snprintf_8h_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="snprintf_8h_source.html#l00034">snprintf.h:34</a></div></div>
<div class="ttc" id="ffserver_8c_html_ac084014877e6fcb9e41a994d5e39d653"><div class="ttname"><a href="ffserver_8c.html#ac084014877e6fcb9e41a994d5e39d653">add_av_stream</a></div><div class="ttdeci">static int add_av_stream(FFServerStream *feed, LayeredAVStream *st)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03578">ffserver.c:3578</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a8c8ac54a9d7cb47e521af3b38f2d5ce4"><div class="ttname"><a href="structFFServerConfig.html#a8c8ac54a9d7cb47e521af3b38f2d5ce4">FFServerConfig::filename</a></div><div class="ttdeci">char * filename</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00118">ffserver_config.h:118</a></div></div>
<div class="ttc" id="group__lavf__core_html_gac2990b13b68e831a408fce8e1d0d6445"><div class="ttname"><a href="group__lavf__core.html#gac2990b13b68e831a408fce8e1d0d6445">avformat_free_context</a></div><div class="ttdeci">void avformat_free_context(AVFormatContext *s)</div><div class="ttdoc">Free an AVFormatContext and all its streams. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04171">utils.c:4171</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a1b0fa9becc514950214ef6e4c49c38c6">REDIR_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01418">ffserver.c:1418</a></div></div>
<div class="ttc" id="parseutils_8h_html"><div class="ttname"><a href="parseutils_8h.html">parseutils.h</a></div><div class="ttdoc">misc parsing utilities </div></div>
<div class="ttc" id="structFFServerStream_html_ac5b11b67652163181e8efd7c7a17a298"><div class="ttname"><a href="structFFServerStream.html#ac5b11b67652163181e8efd7c7a17a298">FFServerStream::is_multicast</a></div><div class="ttdeci">int is_multicast</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00097">ffserver_config.h:97</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_ga4fdb3084415a82e3810de6ee60e46a61"><div class="ttname"><a href="group__lavf__decoding.html#ga4fdb3084415a82e3810de6ee60e46a61">av_read_frame</a></div><div class="ttdeci">int av_read_frame(AVFormatContext *s, AVPacket *pkt)</div><div class="ttdoc">Return the next frame of a stream. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l01695">utils.c:1695</a></div></div>
<div class="ttc" id="group__lavu__string_html_ga193877ba459faf314c3d285b6082cf73"><div class="ttname"><a href="group__lavu__string.html#ga193877ba459faf314c3d285b6082cf73">av_strlcat</a></div><div class="ttdeci">size_t av_strlcat(char *dst, const char *src, size_t size)</div><div class="ttdoc">Append the string src to the string dst, but to a total length of no more than size - 1 bytes...</div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00093">avstring.c:93</a></div></div>
<div class="ttc" id="structFFServerStream_html_a7bae1580d6bb3c98dccf9a3cfc854d5b"><div class="ttname"><a href="structFFServerStream.html#a7bae1580d6bb3c98dccf9a3cfc854d5b">FFServerStream::bandwidth</a></div><div class="ttdeci">unsigned bandwidth</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00093">ffserver_config.h:93</a></div></div>
<div class="ttc" id="structFFServerConfig_html_aa363e6ef1fb0c3d45e4b05657ed751d6"><div class="ttname"><a href="structFFServerConfig.html#aa363e6ef1fb0c3d45e4b05657ed751d6">FFServerConfig::first_feed</a></div><div class="ttdeci">FFServerStream * first_feed</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00119">ffserver_config.h:119</a></div></div>
<div class="ttc" id="structHTTPContext_html_a8f59798cdb37f35f4c74b5b82929093c"><div class="ttname"><a href="structHTTPContext.html#a8f59798cdb37f35f4c74b5b82929093c">HTTPContext::switch_feed_streams</a></div><div class="ttdeci">int switch_feed_streams[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00157">ffserver.c:157</a></div></div>
<div class="ttc" id="structFFServerStream_html_a53df34afe0a8459d3ab3664816d0b8d7"><div class="ttname"><a href="structFFServerStream.html#a53df34afe0a8459d3ab3664816d0b8d7">FFServerStream::in_opts</a></div><div class="ttdeci">AVDictionary * in_opts</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00075">ffserver_config.h:75</a></div></div>
<div class="ttc" id="structRTSPActionServerSetup_html"><div class="ttname"><a href="structRTSPActionServerSetup.html">RTSPActionServerSetup</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00115">ffserver.c:115</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953">RTSPStatusCode</a></div><div class="ttdeci">RTSPStatusCode</div><div class="ttdoc">RTSP handling. </div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00031">rtspcodes.h:31</a></div></div>
<div class="ttc" id="avio_8c_html_a894b202e9a254d9136a9233a894ba26e"><div class="ttname"><a href="avio_8c.html#a894b202e9a254d9136a9233a894ba26e">ffurl_close</a></div><div class="ttdeci">int ffurl_close(URLContext *h)</div><div class="ttdef"><b>Definition:</b> <a href="avio_8c_source.html#l00467">avio.c:467</a></div></div>
<div class="ttc" id="structHTTPContext_html_a9c7f54a1f403eeae0beb66e14ad61508"><div class="ttname"><a href="structHTTPContext.html#a9c7f54a1f403eeae0beb66e14ad61508">HTTPContext::rtp_handles</a></div><div class="ttdeci">URLContext * rtp_handles[FFSERVER_MAX_STREAMS]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00184">ffserver.c:184</a></div></div>
<div class="ttc" id="svq3_8c_html_abbb6c7c49508c1ac374683f2d1159e08"><div class="ttname"><a href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a></div><div class="ttdeci">uint8_t level</div><div class="ttdef"><b>Definition:</b> <a href="svq3_8c_source.html#l00207">svq3.c:207</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a1f39d6b2fe7dfdd5ebd3f67dd9a688e1af6012797550aa8c1ebdf9fd44518bd2d"><div class="ttname"><a href="ffserver__config_8h.html#a1f39d6b2fe7dfdd5ebd3f67dd9a688e1af6012797550aa8c1ebdf9fd44518bd2d">IP_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00040">ffserver_config.h:40</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0b30b5730bee0712936099a3865688aa"><div class="ttname"><a href="ffserver_8c.html#a0b30b5730bee0712936099a3865688aa">get_packet_send_clock</a></div><div class="ttdeci">static int64_t get_packet_send_clock(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02282">ffserver.c:2282</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_gaa23f7619d8d4ea0857065d9979c75ac8"><div class="ttname"><a href="group__lavf__decoding.html#gaa23f7619d8d4ea0857065d9979c75ac8">av_seek_frame</a></div><div class="ttdeci">int av_seek_frame(AVFormatContext *s, int stream_index, int64_t timestamp, int flags)</div><div class="ttdoc">Seek to the keyframe at timestamp. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l02431">utils.c:2431</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a7ea9b9f6dad3fc14f7bde90bf6cff472"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a7ea9b9f6dad3fc14f7bde90bf6cff472">RTSP_STATUS_BANDWIDTH</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00059">rtspcodes.h:59</a></div></div>
<div class="ttc" id="ffserver__config_8h_html_a51470339c20ac490af53c9acb2300aedaa890cebbee43177f8b3a00e97c6d5e21"><div class="ttname"><a href="ffserver__config_8h.html#a51470339c20ac490af53c9acb2300aedaa890cebbee43177f8b3a00e97c6d5e21">STREAM_TYPE_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00035">ffserver_config.h:35</a></div></div>
<div class="ttc" id="structFFServerStream_html_af16f1fde7a9a35ba662ddcfce552ceda"><div class="ttname"><a href="structFFServerStream.html#af16f1fde7a9a35ba662ddcfce552ceda">FFServerStream::feed</a></div><div class="ttdeci">struct FFServerStream * feed</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00074">ffserver_config.h:74</a></div></div>
<div class="ttc" id="structAVCodecContext_html_a9b6b3f1fcbdcc2ad9f4dbb4370496e38"><div class="ttname"><a href="structAVCodecContext.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">AVCodecContext::gop_size</a></div><div class="ttdeci">int gop_size</div><div class="ttdoc">the number of pictures in a group of pictures, or 0 for intra_only </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01899">avcodec.h:1899</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_abfc9b0aa975206f7e77a125e6b78536e"><div class="ttname"><a href="structAVCodecParameters.html#abfc9b0aa975206f7e77a125e6b78536e">AVCodecParameters::sample_rate</a></div><div class="ttdeci">int sample_rate</div><div class="ttdoc">Audio only. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l04109">avcodec.h:4109</a></div></div>
<div class="ttc" id="cmdutils_8h_html_a1b1c1cb0b866790034157479d6dd5da6"><div class="ttname"><a href="cmdutils_8h.html#a1b1c1cb0b866790034157479d6dd5da6">OPT_BOOL</a></div><div class="ttdeci">#define OPT_BOOL</div><div class="ttdef"><b>Definition:</b> <a href="cmdutils_8h_source.html#l00169">cmdutils.h:169</a></div></div>
<div class="ttc" id="group__lavu__math__rational_html_gaa440bf42ede128219a571ae4ce0f90b8"><div class="ttname"><a href="group__lavu__math__rational.html#gaa440bf42ede128219a571ae4ce0f90b8">av_cmp_q</a></div><div class="ttdeci">static int av_cmp_q(AVRational a, AVRational b)</div><div class="ttdoc">Compare two rationals. </div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00089">rational.h:89</a></div></div>
<div class="ttc" id="structFFServerStream_html_adf75ac96109bb80f844282ebd58b0c76"><div class="ttname"><a href="structFFServerStream.html#adf75ac96109bb80f844282ebd58b0c76">FFServerStream::send_on_key</a></div><div class="ttdeci">int send_on_key</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00084">ffserver_config.h:84</a></div></div>
<div class="ttc" id="structFFServerConfig_html"><div class="ttname"><a href="structFFServerConfig.html">FFServerConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00117">ffserver_config.h:117</a></div></div>
<div class="ttc" id="structRTSPActionServerSetup_html_a14885bbb5fed2664d57f9755cb495671"><div class="ttname"><a href="structRTSPActionServerSetup.html#a14885bbb5fed2664d57f9755cb495671">RTSPActionServerSetup::transport_option</a></div><div class="ttdeci">char transport_option[512]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00117">ffserver.c:117</a></div></div>
<div class="ttc" id="avformat_8h_html"><div class="ttname"><a href="avformat_8h.html">avformat.h</a></div><div class="ttdoc">Main libavformat public API header. </div></div>
<div class="ttc" id="ffmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00190">ffmpeg_filter.c:190</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a82fc4d3aca083cbfc5d972ff8c52f892"><div class="ttname"><a href="structFFServerConfig.html#a82fc4d3aca083cbfc5d972ff8c52f892">FFServerConfig::debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00124">ffserver_config.h:124</a></div></div>
<div class="ttc" id="rational_8h_html"><div class="ttname"><a href="rational_8h.html">rational.h</a></div><div class="ttdoc">Utilties for rational number calculation. </div></div>
<div class="ttc" id="structFFServerStream_html"><div class="ttname"><a href="structFFServerStream.html">FFServerStream</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00071">ffserver_config.h:71</a></div></div>
<div class="ttc" id="structHTTPContext_html_a42f07c2fecc9a54c044578991054b2b7"><div class="ttname"><a href="structHTTPContext.html#a42f07c2fecc9a54c044578991054b2b7">HTTPContext::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00128">ffserver.c:128</a></div></div>
<div class="ttc" id="avio_8c_html_a8d63c4fbaca88ffae9044204ec940d4d"><div class="ttname"><a href="avio_8c.html#a8d63c4fbaca88ffae9044204ec940d4d">ffurl_open</a></div><div class="ttdeci">int ffurl_open(URLContext **puc, const char *filename, int flags, const AVIOInterruptCB *int_cb, AVDictionary **options)</div><div class="ttdef"><b>Definition:</b> <a href="avio_8c_source.html#l00357">avio.c:357</a></div></div>
<div class="ttc" id="ffserver_8c_html_a656a0fa8e963645d63ea987b3c4d6028"><div class="ttname"><a href="ffserver_8c.html#a656a0fa8e963645d63ea987b3c4d6028">find_stream_in_feed</a></div><div class="ttdeci">static int find_stream_in_feed(FFServerStream *feed, AVCodecParameters *codec, int bit_rate)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01205">ffserver.c:1205</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_a8a333e1b7061be138796ea43fc8851bc"><div class="ttname"><a href="structLayeredAVStream.html#a8a333e1b7061be138796ea43fc8851bc">LayeredAVStream::pts_wrap_bits</a></div><div class="ttdeci">int pts_wrap_bits</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00065">ffserver_config.h:65</a></div></div>
<div class="ttc" id="ffserver_8c_html_a0d6c59fca9d2b7d2ee11be5596f94075"><div class="ttname"><a href="ffserver_8c.html#a0d6c59fca9d2b7d2ee11be5596f94075">parse_dynamic_acl</a></div><div class="ttdeci">static FFServerIPAddressACL * parse_dynamic_acl(FFServerStream *stream, HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01303">ffserver.c:1303</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_gad42172e27cddafb81096939783b157bb"><div class="ttname"><a href="group__lavf__decoding.html#gad42172e27cddafb81096939783b157bb">avformat_find_stream_info</a></div><div class="ttdeci">int avformat_find_stream_info(AVFormatContext *ic, AVDictionary **options)</div><div class="ttdoc">Read packets of a media file to get stream information. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l03372">utils.c:3372</a></div></div>
<div class="ttc" id="structAVInputFormat_html_a04a3b9ba459666bdb43628c472fa29bf"><div class="ttname"><a href="structAVInputFormat.html#a04a3b9ba459666bdb43628c472fa29bf">AVInputFormat::read_seek</a></div><div class="ttdeci">int(* read_seek)(struct AVFormatContext *, int stream_index, int64_t timestamp, int flags)</div><div class="ttdoc">Seek to a given timestamp relative to the frames in stream component stream_index. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00756">avformat.h:756</a></div></div>
<div class="ttc" id="ffserver__config_8c_html_a29467cf0c665b465567563f880d2dc25"><div class="ttname"><a href="ffserver__config_8c.html#a29467cf0c665b465567563f880d2dc25">ffserver_parse_acl_row</a></div><div class="ttdeci">void ffserver_parse_acl_row(FFServerStream *stream, FFServerStream *feed, FFServerIPAddressACL *ext_acl, const char *p, const char *filename, int line_num)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8c_source.html#l00110">ffserver_config.c:110</a></div></div>
<div class="ttc" id="structHTTPContext_html_a49b179f529c77c6df7a1bf00347f2fa0"><div class="ttname"><a href="structHTTPContext.html#a49b179f529c77c6df7a1bf00347f2fa0">HTTPContext::listen</a></div><div class="ttdeci">int listen</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l00117">http.c:117</a></div></div>
<div class="ttc" id="structAVOutputFormat_html"><div class="ttname"><a href="structAVOutputFormat.html">AVOutputFormat</a></div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00523">avformat.h:523</a></div></div>
<div class="ttc" id="structAVRational_html_aee46bdac67d965ac0a4204e753f910c3"><div class="ttname"><a href="structAVRational.html#aee46bdac67d965ac0a4204e753f910c3">AVRational::den</a></div><div class="ttdeci">int den</div><div class="ttdoc">Denominator. </div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00060">rational.h:60</a></div></div>
<div class="ttc" id="structHTTPContext_html_a58a0e3bfa69cb132e1987772ff3d3951"><div class="ttname"><a href="structHTTPContext.html#a58a0e3bfa69cb132e1987772ff3d3951">HTTPContext::pfmt_ctx</a></div><div class="ttdeci">AVFormatContext * pfmt_ctx</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00159">ffserver.c:159</a></div></div>
<div class="ttc" id="structFFServerStream_html_a6f8a4ad039a1231d8733d884e790615d"><div class="ttname"><a href="structFFServerStream.html#a6f8a4ad039a1231d8733d884e790615d">FFServerStream::max_time</a></div><div class="ttdeci">int64_t max_time</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00083">ffserver_config.h:83</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a78efc5a53c21c8d81197445207ac4374"><div class="ttname"><a href="structAVFormatContext.html#a78efc5a53c21c8d81197445207ac4374">AVFormatContext::iformat</a></div><div class="ttdeci">struct AVInputFormat * iformat</div><div class="ttdoc">The input container format. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01350">avformat.h:1350</a></div></div>
<div class="ttc" id="structDataRateData_html_ad74f3c6bd0de21df8726ae3632422279"><div class="ttname"><a href="structDataRateData.html#ad74f3c6bd0de21df8726ae3632422279">DataRateData::count2</a></div><div class="ttdeci">int64_t count2</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00121">ffserver.c:121</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_gae804b99aec044690162b8b9b110236a4"><div class="ttname"><a href="group__lavf__decoding.html#gae804b99aec044690162b8b9b110236a4">avformat_close_input</a></div><div class="ttdeci">void avformat_close_input(AVFormatContext **s)</div><div class="ttdoc">Close an opened input AVFormatContext. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l04207">utils.c:4207</a></div></div>
<div class="ttc" id="rtpproto_8c_html_a03678613205135ef7ece19f7fc556110"><div class="ttname"><a href="rtpproto_8c.html#a03678613205135ef7ece19f7fc556110">ff_rtp_get_local_rtcp_port</a></div><div class="ttdeci">int ff_rtp_get_local_rtcp_port(URLContext *h)</div><div class="ttdoc">Return the local rtcp port used by the RTP connection. </div><div class="ttdef"><b>Definition:</b> <a href="rtpproto_8c_source.html#l00640">rtpproto.c:640</a></div></div>
<div class="ttc" id="structFFServerStream_html_aef71658a7dac7f836a6bb13383913ebe"><div class="ttname"><a href="structFFServerStream.html#aef71658a7dac7f836a6bb13383913ebe">FFServerStream::prebuffer</a></div><div class="ttdeci">int prebuffer</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00082">ffserver_config.h:82</a></div></div>
<div class="ttc" id="structLayeredAVStream_html_af7c9cefb5ec8162d851704d714534a1e"><div class="ttname"><a href="structLayeredAVStream.html#af7c9cefb5ec8162d851704d714534a1e">LayeredAVStream::recommended_encoder_configuration</a></div><div class="ttdeci">char * recommended_encoder_configuration</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00067">ffserver_config.h:67</a></div></div>
<div class="ttc" id="tableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="ffserver_8c_html_a5ca236f4c53d713f2646d79d7612b71c"><div class="ttname"><a href="ffserver_8c.html#a5ca236f4c53d713f2646d79d7612b71c">compute_bandwidth</a></div><div class="ttdeci">static void compute_bandwidth(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03884">ffserver.c:3884</a></div></div>
<div class="ttc" id="ffserver_8c_html_a761ae4333dbc5c2431a984cfc6b35b64"><div class="ttname"><a href="ffserver_8c.html#a761ae4333dbc5c2431a984cfc6b35b64">ffm_set_write_index</a></div><div class="ttdeci">static void ffm_set_write_index(AVFormatContext *s, int64_t pos, int64_t file_size)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00377">ffserver.c:377</a></div></div>
<div class="ttc" id="structAVDictionaryEntry_html_aa38678f2cad36f120d42e56449c5edb4"><div class="ttname"><a href="structAVDictionaryEntry.html#aa38678f2cad36f120d42e56449c5edb4">AVDictionaryEntry::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00087">dict.h:87</a></div></div>
<div class="ttc" id="structHTTPContext_html_afa22134de468247301a583da80d1e4cc"><div class="ttname"><a href="structHTTPContext.html#afa22134de468247301a583da80d1e4cc">HTTPContext::pb_buffer</a></div><div class="ttdeci">uint8_t * pb_buffer</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00174">ffserver.c:174</a></div></div>
<div class="ttc" id="rtsp_8h_html_a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b"><div class="ttname"><a href="rtsp_8h.html#a7d32a74979e7e6f60215f11789b3e02ea365e39b94c7df02faa14d371d49a6a9b">RTSP_LOWER_TRANSPORT_TCP</a></div><div class="ttdoc">TCP; interleaved in RTSP. </div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00039">rtsp.h:39</a></div></div>
<div class="ttc" id="vorbis__enc__data_8h_html_afed088663f8704004425cdae2120b9b3"><div class="ttname"><a href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a></div><div class="ttdeci">int len</div><div class="ttdef"><b>Definition:</b> <a href="vorbis__enc__data_8h_source.html#l00452">vorbis_enc_data.h:452</a></div></div>
<div class="ttc" id="structHTTPContext_html_aa805c05da4fa84f43c1819f0a06b4ea4"><div class="ttname"><a href="structHTTPContext.html#aa805c05da4fa84f43c1819f0a06b4ea4">HTTPContext::buffer</a></div><div class="ttdeci">uint8_t * buffer</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00169">ffserver.c:169</a></div></div>
<div class="ttc" id="structAVCodecContext_html_ac1e6c2cd1269caa7570575725c682a49"><div class="ttname"><a href="structAVCodecContext.html#ac1e6c2cd1269caa7570575725c682a49">AVCodecContext::channels</a></div><div class="ttdeci">int channels</div><div class="ttdoc">number of audio channels </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02449">avcodec.h:2449</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953abb638992e412250d2dd6951a9cdff467"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953abb638992e412250d2dd6951a9cdff467">RTSP_STATUS_TRANSPORT</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00067">rtspcodes.h:67</a></div></div>
<div class="ttc" id="ffserver_8c_html_af9cf34e0db252791157d1860a412381a"><div class="ttname"><a href="ffserver_8c.html#af9cf34e0db252791157d1860a412381a">PATH_LENGTH</a></div><div class="ttdeci">#define PATH_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00069">ffserver.c:69</a></div></div>
<div class="ttc" id="tests_2des_8c_html_ae9a986282b2908caa6e018751ead8ade"><div class="ttname"><a href="tests_2des_8c.html#ae9a986282b2908caa6e018751ead8ade">tmp</a></div><div class="ttdeci">static uint8_t tmp[8]</div><div class="ttdef"><b>Definition:</b> <a href="tests_2des_8c_source.html#l00038">des.c:38</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a1260f9bf593961ef3237e2a8bfe249c8"><div class="ttname"><a href="rtspcodes_8h.html#a1260f9bf593961ef3237e2a8bfe249c8">RTSP_STATUS_CODE2STRING</a></div><div class="ttdeci">#define RTSP_STATUS_CODE2STRING(x)</div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00125">rtspcodes.h:125</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a486f87a5dc546879edf4c386dd6dd52a">RTSP_STATUS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00033">rtspcodes.h:33</a></div></div>
<div class="ttc" id="structAVFormatContext_html_ac4c0777e54085af2f3f1b27130e2b21b"><div class="ttname"><a href="structAVFormatContext.html#ac4c0777e54085af2f3f1b27130e2b21b">AVFormatContext::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdoc">Format private data. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01366">avformat.h:1366</a></div></div>
<div class="ttc" id="structFFServerStream_html_a3e8e798b58a35eefd2dd713f7412ede0"><div class="ttname"><a href="structFFServerStream.html#a3e8e798b58a35eefd2dd713f7412ede0">FFServerStream::multicast_port</a></div><div class="ttdeci">int multicast_port</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00099">ffserver_config.h:99</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a8f5979edd5bfabad258c8468517db060"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a8f5979edd5bfabad258c8468517db060">RTSP_STATUS_STATE</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00061">rtspcodes.h:61</a></div></div>
<div class="ttc" id="decoder__targeted_8c_html_acfe27e61edea06412363421f1a013e81"><div class="ttname"><a href="decoder__targeted_8c.html#acfe27e61edea06412363421f1a013e81">c</a></div><div class="ttdeci">static AVCodec * c</div><div class="ttdef"><b>Definition:</b> <a href="decoder__targeted_8c_source.html#l00059">decoder_targeted.c:59</a></div></div>
<div class="ttc" id="structAVFormatContext_html_a58422ed3d461b3440a15cf057ac5f5b7"><div class="ttname"><a href="structAVFormatContext.html#a58422ed3d461b3440a15cf057ac5f5b7">AVFormatContext::max_delay</a></div><div class="ttdeci">int max_delay</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01443">avformat.h:1443</a></div></div>
<div class="ttc" id="group__lavf__decoding_html_ga31d601155e9035d5b0e7efedc894ee49"><div class="ttname"><a href="group__lavf__decoding.html#ga31d601155e9035d5b0e7efedc894ee49">avformat_open_input</a></div><div class="ttdeci">int avformat_open_input(AVFormatContext **ps, const char *url, AVInputFormat *fmt, AVDictionary **options)</div><div class="ttdoc">Open an input stream and read the header. </div><div class="ttdef"><b>Definition:</b> <a href="libavformat_2utils_8c_source.html#l00511">utils.c:511</a></div></div>
<div class="ttc" id="ffserver_8c_html_a831f44bb99e162e3d316633555567cdd"><div class="ttname"><a href="ffserver_8c.html#a831f44bb99e162e3d316633555567cdd">new_connection</a></div><div class="ttdeci">static void new_connection(int server_fd, int is_rtsp)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00841">ffserver.c:841</a></div></div>
<div class="ttc" id="structAVCodecParameters_html_a4d418b807283607a231d2d8cdf559f00"><div class="ttname"><a href="structAVCodecParameters.html#a4d418b807283607a231d2d8cdf559f00">AVCodecParameters::channels</a></div><div class="ttdeci">int channels</div><div class="ttdoc">Audio only. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l04105">avcodec.h:4105</a></div></div>
<div class="ttc" id="structHTTPContext_html_ab4db6a0dd001bedfe1d01dc6e5487789"><div class="ttname"><a href="structHTTPContext.html#ab4db6a0dd001bedfe1d01dc6e5487789">HTTPContext::session_id</a></div><div class="ttdeci">char session_id[32]</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00180">ffserver.c:180</a></div></div>
<div class="ttc" id="structAVPacket_html_a85dbbd306b44b02390cd91c45e6a0f76"><div class="ttname"><a href="structAVPacket.html#a85dbbd306b44b02390cd91c45e6a0f76">AVPacket::dts</a></div><div class="ttdeci">int64_t dts</div><div class="ttdoc">Decompression timestamp in AVStream-&gt;time_base units; the time at which the packet is decompressed...</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01610">avcodec.h:1610</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757"><div class="ttname"><a href="ffserver_8c.html#a7aaa4b3467f7fc521cb2f1faf12f6af1a8e18a628223686faa90471785f351757">REDIR_SDP</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01423">ffserver.c:1423</a></div></div>
<div class="ttc" id="group__lavf__encoding_html_ga7f14007e7dc8f481f054b21614dfec13"><div class="ttname"><a href="group__lavf__encoding.html#ga7f14007e7dc8f481f054b21614dfec13">av_write_trailer</a></div><div class="ttdeci">int av_write_trailer(AVFormatContext *s)</div><div class="ttdoc">Write the stream trailer to an output media file and free the file private data. </div><div class="ttdef"><b>Definition:</b> <a href="mux_8c_source.html#l01295">mux.c:1295</a></div></div>
<div class="ttc" id="structURLContext_html_a929b2b6f142d146ff2df0970839d78ae"><div class="ttname"><a href="structURLContext.html#a929b2b6f142d146ff2df0970839d78ae">URLContext::max_packet_size</a></div><div class="ttdeci">int max_packet_size</div><div class="ttdoc">if non zero, the stream is packetized with this max packet size </div><div class="ttdef"><b>Definition:</b> <a href="url_8h_source.html#l00044">url.h:44</a></div></div>
<div class="ttc" id="ffserver_8c_html_adf12d52e6e8b868b43c702c20c9616d3"><div class="ttname"><a href="ffserver_8c.html#adf12d52e6e8b868b43c702c20c9616d3">rtsp_cmd_setup</a></div><div class="ttdeci">static void rtsp_cmd_setup(HTTPContext *c, const char *url, RTSPMessageHeader *h)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03132">ffserver.c:3132</a></div></div>
<div class="ttc" id="ffplay_8c_html_a591a324cad0ca94e4a84dbdf229e5a02"><div class="ttname"><a href="ffplay_8c.html#a591a324cad0ca94e4a84dbdf229e5a02">video_codec_name</a></div><div class="ttdeci">static const char * video_codec_name</div><div class="ttdef"><b>Definition:</b> <a href="ffplay_8c_source.html#l00343">ffplay.c:343</a></div></div>
<div class="ttc" id="rtsp_8h_html"><div class="ttname"><a href="rtsp_8h.html">rtsp.h</a></div></div>
<div class="ttc" id="tableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="avisynth__c_8h_html_aaa746f43957975c7273cc08bf006f747"><div class="ttname"><a href="avisynth__c_8h.html#aaa746f43957975c7273cc08bf006f747">count</a></div><div class="ttdeci">void INT64 INT64 count</div><div class="ttdef"><b>Definition:</b> <a href="avisynth__c_8h_source.html#l00690">avisynth_c.h:690</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a52540a11a69a3452fb4b967e1f4d3f2e"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a52540a11a69a3452fb4b967e1f4d3f2e">RTSP_STATUS_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00074">rtspcodes.h:74</a></div></div>
<div class="ttc" id="structHTTPContext_html_a72af6f56bcdecffee7765c47a71010b1"><div class="ttname"><a href="structHTTPContext.html#a72af6f56bcdecffee7765c47a71010b1">HTTPContext::pts_stream_index</a></div><div class="ttdeci">int pts_stream_index</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00151">ffserver.c:151</a></div></div>
<div class="ttc" id="avisynth__c_8h_html_a8fc0b8ec0a1ff0e9ffb827a29083d895"><div class="ttname"><a href="avisynth__c_8h.html#a8fc0b8ec0a1ff0e9ffb827a29083d895">start</a></div><div class="ttdeci">void INT64 start</div><div class="ttdef"><b>Definition:</b> <a href="avisynth__c_8h_source.html#l00690">avisynth_c.h:690</a></div></div>
<div class="ttc" id="structAVInputFormat_html_a850db3eb225e22b64f3304d72134ca0c"><div class="ttname"><a href="structAVInputFormat.html#a850db3eb225e22b64f3304d72134ca0c">AVInputFormat::name</a></div><div class="ttdeci">const char * name</div><div class="ttdoc">A comma separated list of short names for the format. </div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00664">avformat.h:664</a></div></div>
<div class="ttc" id="ffserver_8c_html_af301f17ab4a386346807e0a0f8324bc2"><div class="ttname"><a href="ffserver_8c.html#af301f17ab4a386346807e0a0f8324bc2">ctime1</a></div><div class="ttdeci">static char * ctime1(char *buf2, size_t buf_size)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00385">ffserver.c:385</a></div></div>
<div class="ttc" id="group__lavu__misc_html_gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5"><div class="ttname"><a href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a></div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00201">avutil.h:201</a></div></div>
<div class="ttc" id="group__lavu__crypto_html_ga4fe662789c7e05a6b63e0c675dbbd7ed"><div class="ttname"><a href="group__lavu__crypto.html#ga4fe662789c7e05a6b63e0c675dbbd7ed">av_get_random_seed</a></div><div class="ttdeci">uint32_t av_get_random_seed(void)</div><div class="ttdoc">Get a seed to use in conjunction with random functions. </div><div class="ttdef"><b>Definition:</b> <a href="random__seed_8c_source.html#l00120">random_seed.c:120</a></div></div>
<div class="ttc" id="structFFServerStream_html_a47a664cde8fc184519b309e41fe6dc84"><div class="ttname"><a href="structFFServerStream.html#a47a664cde8fc184519b309e41fe6dc84">FFServerStream::multicast_ip</a></div><div class="ttdeci">struct in_addr multicast_ip</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00098">ffserver_config.h:98</a></div></div>
<div class="ttc" id="structAVStream_html_a12826d21779289356722971d362c583c"><div class="ttname"><a href="structAVStream.html#a12826d21779289356722971d362c583c">AVStream::codecpar</a></div><div class="ttdeci">AVCodecParameters * codecpar</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01241">avformat.h:1241</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953aee353d512fe871f945de042d1fa3c442"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953aee353d512fe871f945de042d1fa3c442">RTSP_STATUS_INTERNAL</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00069">rtspcodes.h:69</a></div></div>
<div class="ttc" id="structFFServerConfig_html_ae53e34ece5497235814cec4735562c87"><div class="ttname"><a href="structFFServerConfig.html#ae53e34ece5497235814cec4735562c87">FFServerConfig::first_stream</a></div><div class="ttdeci">FFServerStream * first_stream</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00120">ffserver_config.h:120</a></div></div>
<div class="ttc" id="structHTTPContext_html_a3647bf1e116d5550642356b8e3fb56fa"><div class="ttname"><a href="structHTTPContext.html#a3647bf1e116d5550642356b8e3fb56fa">HTTPContext::state</a></div><div class="ttdeci">enum HTTPState state</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00127">ffserver.c:127</a></div></div>
<div class="ttc" id="rtspcodes_8h_html_a5d7a49060418fc68de2e6ae781e91953a2a558cd7b6864129ce14e18e566b3f4e"><div class="ttname"><a href="rtspcodes_8h.html#a5d7a49060418fc68de2e6ae781e91953a2a558cd7b6864129ce14e18e566b3f4e">RTSP_STATUS_SESSION</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspcodes_8h_source.html#l00060">rtspcodes.h:60</a></div></div>
<div class="ttc" id="structAVPacket_html_a0d1cb9b5a32b00fb6edc81ea3aae2a49"><div class="ttname"><a href="structAVPacket.html#a0d1cb9b5a32b00fb6edc81ea3aae2a49">AVPacket::stream_index</a></div><div class="ttdeci">int stream_index</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01613">avcodec.h:1613</a></div></div>
<div class="ttc" id="structAVStream_html_a9db755451f14e2bf590d4b85d82b32e6"><div class="ttname"><a href="structAVStream.html#a9db755451f14e2bf590d4b85d82b32e6">AVStream::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdoc">This is the fundamental unit of time (in seconds) in terms of which frame timestamps are represented...</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00926">avformat.h:926</a></div></div>
<div class="ttc" id="avresample_8c_html_a93e9c44560169ed9b03a575e07aad136"><div class="ttname"><a href="avresample_8c.html#a93e9c44560169ed9b03a575e07aad136">rates</a></div><div class="ttdeci">static const int rates[]</div><div class="ttdef"><b>Definition:</b> <a href="avresample_8c_source.html#l00176">avresample.c:176</a></div></div>
<div class="ttc" id="ffserver_8c_html_a6fa60ea5086e24e4484ed12216df3fff"><div class="ttname"><a href="ffserver_8c.html#a6fa60ea5086e24e4484ed12216df3fff">handle_child_exit</a></div><div class="ttdeci">static void handle_child_exit(int sig)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03907">ffserver.c:3907</a></div></div>
<div class="ttc" id="ffserver_8c_html_a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26"><div class="ttname"><a href="ffserver_8c.html#a85bc073e02073ef3c1a2d4665512f811a6ac3489df94976238ae6d9b0d587bc26">HTTPSTATE_SEND_HEADER</a></div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00078">ffserver.c:78</a></div></div>
<div class="ttc" id="structAVOutputFormat_html_ad94e0c8bd362cb9ffbfc44514481fc75"><div class="ttname"><a href="structAVOutputFormat.html#ad94e0c8bd362cb9ffbfc44514481fc75">AVOutputFormat::mime_type</a></div><div class="ttdeci">const char * mime_type</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l00531">avformat.h:531</a></div></div>
<div class="ttc" id="structAVPacket_html"><div class="ttname"><a href="structAVPacket.html">AVPacket</a></div><div class="ttdoc">This structure stores compressed data. </div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01588">avcodec.h:1588</a></div></div>
<div class="ttc" id="group__lavf__core_html_ga917265caec45ef5a0646356ed1a507e3"><div class="ttname"><a href="group__lavf__core.html#ga917265caec45ef5a0646356ed1a507e3">av_register_all</a></div><div class="ttdeci">void av_register_all(void)</div><div class="ttdoc">Initialize libavformat and register all the muxers, demuxers and protocols. </div><div class="ttdef"><b>Definition:</b> <a href="allformats_8c_source.html#l00044">allformats.c:44</a></div></div>
<div class="ttc" id="avio_8h_html_ae118a1f37f1e48617609ead9910aac15"><div class="ttname"><a href="avio_8h.html#ae118a1f37f1e48617609ead9910aac15">avio_closep</a></div><div class="ttdeci">int avio_closep(AVIOContext **s)</div><div class="ttdoc">Close the resource accessed by the AVIOContext *s, free it and set the pointer pointing to it to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="aviobuf_8c_source.html#l01092">aviobuf.c:1092</a></div></div>
<div class="ttc" id="ffserver_8c_html_ae893dc1719ef4bc12147848d129f3efa"><div class="ttname"><a href="ffserver_8c.html#ae893dc1719ef4bc12147848d129f3efa">unlayer_stream</a></div><div class="ttdeci">static void unlayer_stream(AVStream *st, LayeredAVStream *lst)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00258">ffserver.c:258</a></div></div>
<div class="ttc" id="structFFServerConfig_html_a981210a0cd86d965b5f67ecf9c8a7fb1"><div class="ttname"><a href="structFFServerConfig.html#a981210a0cd86d965b5f67ecf9c8a7fb1">FFServerConfig::nb_max_http_connections</a></div><div class="ttdeci">unsigned int nb_max_http_connections</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00121">ffserver_config.h:121</a></div></div>
<div class="ttc" id="ffserver_8c_html_aa742c9952e658cc18600e326da6ada2f"><div class="ttname"><a href="ffserver_8c.html#aa742c9952e658cc18600e326da6ada2f">build_feed_streams</a></div><div class="ttdeci">static int build_feed_streams(void)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03726">ffserver.c:3726</a></div></div>
<div class="ttc" id="structFFServerIPAddressACL_html_a61cf4b39e0ee09fe6350acf374d7df41"><div class="ttname"><a href="structFFServerIPAddressACL.html#a61cf4b39e0ee09fe6350acf374d7df41">FFServerIPAddressACL::first</a></div><div class="ttdeci">struct in_addr first</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00048">ffserver_config.h:48</a></div></div>
<div class="ttc" id="ffserver_8c_html_a201963d8def1c404f24a6fba89ffc7a8"><div class="ttname"><a href="ffserver_8c.html#a201963d8def1c404f24a6fba89ffc7a8">fmt_bytecount</a></div><div class="ttdeci">static void fmt_bytecount(AVIOContext *pb, int64_t count)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l01868">ffserver.c:1868</a></div></div>
<div class="ttc" id="structFFServerIPAddressACL_html_acef0e4a596da963ec6d0267950bc522b"><div class="ttname"><a href="structFFServerIPAddressACL.html#acef0e4a596da963ec6d0267950bc522b">FFServerIPAddressACL::action</a></div><div class="ttdeci">enum FFServerIPAddressAction action</div><div class="ttdef"><b>Definition:</b> <a href="ffserver__config_8h_source.html#l00046">ffserver_config.h:46</a></div></div>
<div class="ttc" id="structAVPacket_html_a73bde0a37f3b1efc839f11295bfbf42a"><div class="ttname"><a href="structAVPacket.html#a73bde0a37f3b1efc839f11295bfbf42a">AVPacket::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdoc">Presentation timestamp in AVStream-&gt;time_base units; the time at which the decompressed packet will b...</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01604">avcodec.h:1604</a></div></div>
<div class="ttc" id="group__lavu__time_html_ga2eaefe702f95f619ea6f2d08afa01be1"><div class="ttname"><a href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a></div><div class="ttdeci">#define AV_NOPTS_VALUE</div><div class="ttdoc">Undefined timestamp value. </div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00248">avutil.h:248</a></div></div>
<div class="ttc" id="ffserver_8c_html_a8a43d39903bea9a3f2ec7fc04ec9e22f"><div class="ttname"><a href="ffserver_8c.html#a8a43d39903bea9a3f2ec7fc04ec9e22f">HTTP_REQUEST_TIMEOUT</a></div><div class="ttdeci">#define HTTP_REQUEST_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00110">ffserver.c:110</a></div></div>
<div class="ttc" id="ffserver_8c_html_a7331da272261ee3cca96d5a325fc652d"><div class="ttname"><a href="ffserver_8c.html#a7331da272261ee3cca96d5a325fc652d">http_prepare_data</a></div><div class="ttdeci">static int http_prepare_data(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02296">ffserver.c:2296</a></div></div>
<div class="ttc" id="avio_8h_html_a79127cec97b09a308b549253119ff38f"><div class="ttname"><a href="avio_8h.html#a79127cec97b09a308b549253119ff38f">avio_printf</a></div><div class="ttdeci">int avio_printf(AVIOContext *s, const char *fmt,...) av_printf_format(2</div></div>
<div class="ttc" id="structRTSPTransportField_html_a2cd6f1575b6ece5bd645b70677561e76"><div class="ttname"><a href="structRTSPTransportField.html#a2cd6f1575b6ece5bd645b70677561e76">RTSPTransportField::client_port_min</a></div><div class="ttdeci">int client_port_min</div><div class="ttdoc">UDP client ports; these should be the local ports of the UDP RTP (and RTCP) sockets over which we rec...</div><div class="ttdef"><b>Definition:</b> <a href="rtsp_8h_source.html#l00101">rtsp.h:101</a></div></div>
<div class="ttc" id="structHTTPContext_html_adbaee6660773715d28aca88435aa3cfd"><div class="ttname"><a href="structHTTPContext.html#adbaee6660773715d28aca88435aa3cfd">HTTPContext::cur_frame_duration</a></div><div class="ttdeci">int64_t cur_frame_duration</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00147">ffserver.c:147</a></div></div>
<div class="ttc" id="ffserver_8c_html_aac30c1abd86159649faf9a15a0963261"><div class="ttname"><a href="ffserver_8c.html#aac30c1abd86159649faf9a15a0963261">remove_stream</a></div><div class="ttdeci">static void remove_stream(FFServerStream *stream)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l03620">ffserver.c:3620</a></div></div>
<div class="ttc" id="ffserver_8c_html_a40262be785bc90444c79e1145cc6f5c9"><div class="ttname"><a href="ffserver_8c.html#a40262be785bc90444c79e1145cc6f5c9">http_start_receive_data</a></div><div class="ttdeci">static int http_start_receive_data(HTTPContext *c)</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l02657">ffserver.c:2657</a></div></div>
<div class="ttc" id="ffserver_8c_html_a9b94fed195a0fde46da68d2d0034ecbe"><div class="ttname"><a href="ffserver_8c.html#a9b94fed195a0fde46da68d2d0034ecbe">no_launch</a></div><div class="ttdeci">static int no_launch</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00243">ffserver.c:243</a></div></div>
<div class="ttc" id="structHTTPContext_html_a75798a8e71585fb402566fe33985358f"><div class="ttname"><a href="structHTTPContext.html#a75798a8e71585fb402566fe33985358f">HTTPContext::feed_fd</a></div><div class="ttdeci">int feed_fd</div><div class="ttdef"><b>Definition:</b> <a href="ffserver_8c_source.html#l00141">ffserver.c:141</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 2 2017 22:46:42 for FFmpeg by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
